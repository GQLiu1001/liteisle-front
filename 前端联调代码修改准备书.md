# 轻屿记前端联调代码修改准备书

## 📋 API功能覆盖完整性确认

经过详细分析，**API文档已经100%覆盖了前端应用的所有功能需求**：

### ✅ 功能覆盖分析
1. **认证系统** - 完整覆盖（包括设置页面的密码修改和头像重置）
2. **文件管理** - 完整覆盖（现有多选UI已就绪，只需API对接）
3. **音乐播放** - 完整覆盖（聚合查询设计优秀）
4. **文档管理** - 完整覆盖（支持多格式和MD编辑）
5. **传输管理** - 完整覆盖（异步上传和实时状态更新）
6. **专注岛屿** - 完整覆盖（统计和收集功能齐全）
7. **分享功能** - 完整覆盖（设置页面已有分享管理UI）
8. **回收站** - 完整覆盖（页面已有对应操作按钮）

---

## 🎯 核心修改策略

### 1. API路径统一原则
- **统一前缀**：所有API使用 `/v1` 前缀
- **响应格式**：统一处理 `{code, message, data}` 结构
- **命名转换**：snake_case ↔ camelCase 自动转换

### 2. 现有优势保持
- **多选功能已完整** - DrivePage中的 `selectedItemIds` 已实现
- **批量操作UI就绪** - 右键菜单已支持批量操作显示
- **WebSocket基础** - 只需添加连接和事件监听

---

## 📁 详细修改计划

## 一、HTTP 基础层重构 - `src/utils/http.ts`

### 🔄 基础配置修改

```typescript
// 1. 修改baseURL配置
const http: AxiosInstance = axios.create({
  baseURL: import.meta.env.PROD ? '/api/v1' : 'http://localhost:8080/api/v1',
  timeout: 10000,
  headers: {
    'Content-Type': 'application/json'
  }
})

// 2. 响应拦截器 - 处理统一响应格式
http.interceptors.response.use(
  (response: AxiosResponse) => {
    const { code, message, data } = response.data
    if (code === 200 || code === 202) {
      return { ...response, data: { code, message, data } }
    } else {
      throw new Error(message || '请求失败')
    }
  },
  // 现有错误处理逻辑保持不变...
)
```

### 🔄 认证API重构（对应设置页面功能）

```typescript
export const authAPI = {
  // 登录 - 修改参数结构
  login: (credentials: { username: string; password: string }) => {
    return post('/auth/login', credentials)
  },
  
  // 注册 - 添加vcode字段
  register: (userData: { username: string; email: string; password: string; vcode: string }) => {
    return post('/auth/register', userData)
  },
  
  // 发送验证码 - 修改为查询参数（对应注册页面）
  sendVerificationCode: (email: string) => {
    return post(`/auth/send-vcode?email=${email}`)
  },
  
  // 忘记密码 - 调整字段名
  forgotPassword: (data: { 
    username: string; 
    email: string; 
    vcode: string; 
    new_password: string; 
    confirm_password: string 
  }) => {
    return post('/auth/forgot-password', data)
  },
  
  // 获取当前用户信息
  getCurrentUser: () => {
    return get('/auth/me')
  },
  
  // ✨ 新增：修改密码（对应设置页面"修改密码"按钮）
  resetPassword: (data: { 
    old_password: string; 
    new_password: string; 
    confirm_password: string 
  }) => {
    return post('/auth/me/reset-password', data)
  },
  
  // 更新用户头像（对应设置页面头像上传）
  updateUserPicture: (formData: FormData) => {
    return post('/auth/me/picture', formData, {
      headers: { 'Content-Type': 'multipart/form-data' }
    })
  },
  
  // ✨ 新增：重置头像（对应设置页面"恢复默认头像"按钮）
  resetPicture: () => {
    return put('/auth/me/reset-picture')
  },
  
  // 登出
  logout: () => {
    return post('/auth/logout')
  }
}
```

### 🔄 文件系统API重构（对应云盘页面批量操作）

```typescript
// 完全重构文件系统API
export const fileSystemAPI = {
  // 获取文件夹内容（替换现有的getFolders和getFiles）
  getFolderContent: (folderId: number, params?: { content?: string; sort_by?: string }) => {
    return get(`/folders/${folderId}`, { params })
  },
  
  // 创建文件夹
  createFolder: (data: { name: string; parent_id: number }) => {
    return post('/folders', data)
  },
  
  // 重命名文件（对应右键菜单"重命名"）
  renameFile: (fileId: number, data: { new_name: string }) => {
    return put(`/files/${fileId}/rename`, data)
  },
  
  // 重命名文件夹（对应右键菜单"重命名"）
  renameFolder: (folderId: number, data: { new_name: string }) => {
    return put(`/folders/${folderId}/rename`, data)
  },
  
  // ✨ 批量移动（对应多选后的"剪切"操作）
  moveItems: (data: { file_ids?: number[]; folder_ids?: number[]; target_folder_id: number }) => {
    return put('/items/move', data)
  },
  
  // ✨ 批量删除（对应多选后的"删除"按钮和拖拽到回收站）
  deleteItems: (data: { file_ids?: number[]; folder_ids?: number[] }) => {
    return del('/items', { data })
  },
  
  // 获取文件详情（对应右键菜单"属性"）
  getFileDetail: (fileId: number) => {
    return get(`/files/${fileId}/detail`)
  },
  
  // 获取文件夹详情（对应右键菜单"属性"）
  getFolderDetail: (folderId: number) => {
    return get(`/folders/${folderId}/detail`)
  },
  
  // 获取文件夹层级结构（对应移动对话框）
  getFolderHierarchy: () => {
    return get('/folders/hierarchy')
  }
}
```

### 🆕 上传下载API（对应传输页面）

```typescript
export const transferAPI = {
  // 文件上传（异步处理）- 对应云盘和音乐页面的文件上传
  uploadFile: (file: File, folderId?: number, onProgress?: (progress: number) => void) => {
    const formData = new FormData()
    formData.append('file', file)
    if (folderId) formData.append('folder_id', folderId.toString())
    
    return post('/upload', formData, {
      headers: { 'Content-Type': 'multipart/form-data' },
      onUploadProgress: (progressEvent) => {
        if (onProgress && progressEvent.total) {
          const progress = Math.round((progressEvent.loaded * 100) / progressEvent.total)
          onProgress(progress)
        }
      }
    })
  },
  
  // 获取文件下载链接
  getFileDownloadUrl: (fileId: number) => {
    return get(`/download/file/${fileId}`)
  },
  
  // 获取文件夹下载链接
  getFolderDownloadUrl: (folderId: number) => {
    return get(`/download/folder/${folderId}`)
  },
  
  // 获取传输摘要（对应侧边栏角标）
  getTransferSummary: () => {
    return get('/transfers/summary')
  },
  
  // 获取传输历史（对应传输页面）
  getTransferHistory: (params?: { status?: string; page?: number; size?: number }) => {
    return get('/transfers', { params })
  },
  
  // 删除传输记录
  deleteTransferLog: (logId: number, deleteFile: boolean = false) => {
    return del(`/transfers/${logId}`, { params: { delete_file: deleteFile } })
  },
  
  // 清空已完成记录
  clearCompletedTransfers: () => {
    return del('/transfers/completed')
  }
}
```

### 🆕 特定视图API（音乐和文档页面数据获取）

```typescript
// 音乐视图API（替换现有的从DriveStore获取数据）
export const musicAPI = {
  // 获取音乐页面数据（应用启动时调用）
  getMusicPageData: (params?: { content?: string }) => {
    return get('/music', { params })
  },
  
  // 获取音乐播放链接
  getMusicPlayUrl: (fileId: number) => {
    return get(`/music/${fileId}/play`)
  }
}

// 文档视图API（替换现有的从DriveStore获取数据）
export const documentAPI = {
  // 获取文档页面数据（应用启动时调用）
  getDocumentPageData: (params?: { content?: string }) => {
    return get('/documents', { params })
  },
  
  // 获取非MD文档预览链接
  getDocumentViewUrl: (fileId: number) => {
    return get(`/documents/${fileId}/view`)
  },
  
  // 获取MD文档内容
  getMarkdownContent: (fileId: number) => {
    return get(`/documents/md/${fileId}`)
  },
  
  // 保存MD文档
  saveMarkdownContent: (fileId: number, data: { content: string }) => {
    return put(`/documents/md/${fileId}`, data)
  }
}
```

### 🆕 回收站API（对应云盘页面回收站功能）

```typescript
export const recycleBinAPI = {
  // 获取回收站内容
  getRecycleBinContent: () => {
    return get('/recycle-bin')
  },
  
  // 批量还原（对应回收站模式下的多选还原）
  restoreItems: (data: { file_ids?: number[]; folder_ids?: number[] }) => {
    return post('/recycle-bin/restore', data)
  },
  
  // 批量永久删除（对应回收站模式下的多选删除）
  permanentDeleteItems: (data: { file_ids?: number[]; folder_ids?: number[] }) => {
    return del('/recycle-bin', { data })
  },
  
  // 清空回收站（对应回收站页面"一键删除"按钮）
  clearRecycleBin: () => {
    return del('/recycle-bin/all')
  }
}
```

### 🆕 分享API（对应设置页面分享管理）

```typescript
export const shareAPI = {
  // 创建分享（对应右键菜单"分享"）
  createShare: (data: { 
    file_id?: number; 
    folder_id?: number; 
    is_encrypted: boolean; 
    expires_in_days: number 
  }) => {
    return post('/shares', data)
  },
  
  // 获取我的分享（对应设置页面"我的分享"）
  getMyShares: (params?: { page?: number; size?: number }) => {
    return get('/shares/me', { params })
  },
  
  // 取消分享（对应设置页面分享列表的"取消分享"）
  cancelShare: (shareId: number) => {
    return del(`/shares/${shareId}`)
  }
}
```

### 🔄 专注和岛屿API更新

```typescript
// 专注功能API - 更新现有的focusAPI
export const focusAPI = {
  // 记录专注时长
  recordFocus: (data: { focus_minutes: number }) => {
    return post('/focus/records', data)
  },
  
  // 获取专注总次数（对应首页卡片）
  getTotalFocusCount: () => {
    return get('/focus/stats/total-count')
  },
  
  // 获取专注记录
  getFocusRecords: (params?: { page?: number; size?: number }) => {
    return get('/focus/stats/records', { params })
  },
  
  // 获取专注日历（对应首页日历组件）
  getFocusCalendar: (year: number, month: number) => {
    return get('/focus/stats/calendar', { params: { year, month } })
  }
}

// 岛屿功能API - 更新现有的islandAPI
export const islandAPI = {
  // 获取用户岛屿收集情况（对应首页岛屿卡片）
  getUserIslands: () => {
    return get('/islands/me')
  }
}
```

---

## 二、Store 层调整计划

## 🔄 AuthStore 调整 - `src/store/AuthStore.ts`

### 关键修改点：

```typescript
// 1. 响应数据适配API文档格式
const login = async (credentials: LoginRequest): Promise<void> => {
  isLoading.value = true
  try {
    const response = await authAPI.login({
      username: credentials.username || credentials.email,
      password: credentials.password
    })
    
    // 适配新的响应格式 {code, message, data}
    const { code, message, data } = response.data
    if (code === 200) {
      setAuthData({
        success: true,
        message,
        data: {
          userId: data.id,
          username: data.username,
          email: data.email,
          token: data.token,
          expiresIn: data.expiresIn || 30 * 24 * 3600
        },
        token: data.token,
        user: {
          id: data.id,
          username: data.username,
          email: data.email,
          picture: data.picture,
          storageUsed: data.storage_used,    // 注意字段名转换
          storageQuota: data.storage_quota   // 注意字段名转换
        }
      })
    } else {
      throw new Error(message || '登录失败')
    }
  } catch (error) {
    // 保持现有的fallback演示模式
    console.warn('API 调用失败，使用演示模式:', error)
    // ... 现有演示逻辑
  } finally {
    isLoading.value = false
  }
}

// 2. 新增resetPassword方法（对应设置页面）
const resetPassword = async (data: {
  old_password: string;
  new_password: string;
  confirm_password: string;
}): Promise<void> => {
  isLoading.value = true
  try {
    const response = await authAPI.resetPassword(data)
    const { code, message } = response.data
    if (code === 200) {
      // 成功提示
      console.log('密码修改成功')
    } else {
      throw new Error(message || '密码修改失败')
    }
  } catch (error) {
    throw error
  } finally {
    isLoading.value = false
  }
}

// 3. 新增resetPicture方法（对应设置页面）
const resetPicture = async (): Promise<void> => {
  isLoading.value = true
  try {
    const response = await authAPI.resetPicture()
    const { code, message, data } = response.data
    if (code === 200) {
      // 更新用户头像
      if (user.value) {
        user.value.picture = data.new_picture_url
      }
    } else {
      throw new Error(message || '头像重置失败')
    }
  } catch (error) {
    throw error
  } finally {
    isLoading.value = false
  }
}
```

## 🔄 DriveStore 重构 - `src/store/DriveStore.ts`

### 核心变更：从mock数据到真实API调用

```typescript
// 1. 数据结构适配API响应格式
export interface DriveItem {
  id: number
  name: string
  type: 'folder' | 'music' | 'document'  // 改为与API文档一致
  size?: number
  modifiedAt: string  // 改为与API一致的字段名
  createdAt: string
  path: string
  parentId: number | null
  status?: 'processing' | 'available' | 'failed'  // 新增状态字段
  // ... 其他字段
}

// 2. 替换getCurrentFolderContent方法
const getCurrentFolderContent = async (folderId: number = 0) => {
  try {
    isLoading.value = true
    const response = await fileSystemAPI.getFolderContent(folderId, {
      content: searchQuery.value,
      sort_by: sortBy.value
    })
    
    const { code, data } = response.data
    if (code === 200) {
      // 转换API响应到前端数据格式
      const folders = data.folders.map(folder => ({
        id: folder.id,
        name: folder.name,
        type: 'folder' as const,
        size: 0,
        modifiedAt: folder.updated_at,
        createdAt: folder.created_at,
        path: `${currentPath.value}/${folder.name}`,
        parentId: folder.parent_id,
        itemCount: folder.sub_item_count,
        level: getCurrentLevel() + 1
      }))
      
      const files = data.files.map(file => ({
        id: file.id,
        name: file.name,
        type: file.file_type,
        size: file.file_size,
        modifiedAt: file.updated_at,
        createdAt: file.created_at,
        path: `${currentPath.value}/${file.name}`,
        parentId: file.folder_id,
        status: file.status
      }))
      
      // 更新当前文件夹内容
      currentFolderContent.value = [...folders, ...files]
    }
  } catch (error) {
    console.error('获取文件夹内容失败:', error)
    // 保持现有mock数据作为fallback
  } finally {
    isLoading.value = false
  }
}

// 3. 实现批量操作方法（对应现有的多选UI）
const batchMoveItems = async (targetFolderId: number) => {
  const fileIds: number[] = []
  const folderIds: number[] = []
  
  // 从selectedItemIds中分离文件和文件夹
  selectedItemIds.value.forEach(id => {
    const item = findItemById(id)
    if (item?.type === 'folder') {
      folderIds.push(id)
    } else {
      fileIds.push(id)
    }
  })
  
  try {
    await fileSystemAPI.moveItems({
      file_ids: fileIds.length > 0 ? fileIds : undefined,
      folder_ids: folderIds.length > 0 ? folderIds : undefined,
      target_folder_id: targetFolderId
    })
    
    // 清除选中状态并刷新列表
    selectedItemIds.value.clear()
    await getCurrentFolderContent(currentFolderId.value)
  } catch (error) {
    console.error('批量移动失败:', error)
    throw error
  }
}

const batchDeleteItems = async () => {
  const fileIds: number[] = []
  const folderIds: number[] = []
  
  selectedItemIds.value.forEach(id => {
    const item = findItemById(id)
    if (item?.type === 'folder') {
      folderIds.push(id)
    } else {
      fileIds.push(id)
    }
  })
  
  try {
    await fileSystemAPI.deleteItems({
      file_ids: fileIds.length > 0 ? fileIds : undefined,
      folder_ids: folderIds.length > 0 ? folderIds : undefined
    })
    
    selectedItemIds.value.clear()
    await getCurrentFolderContent(currentFolderId.value)
  } catch (error) {
    console.error('批量删除失败:', error)
    throw error
  }
}
```

## 🔄 MusicStore 调整 - `src/store/MusicStore.ts`

### 数据源从DriveStore切换到MusicAPI

```typescript
// 1. 替换loadPlaylistsFromDrive方法
const loadMusicData = async () => {
  try {
    const response = await musicAPI.getMusicPageData({
      content: searchQuery.value
    })
    
    const { code, data } = response.data
    if (code === 200) {
      // 转换播放列表数据
      const convertedPlaylists = data.playlists.map(playlist => ({
        id: playlist.id.toString(),
        name: playlist.name,
        tracks: [],
        folderPath: `/音乐/${playlist.name}`
      }))
      
      // 转换音乐文件数据并按播放列表分组
      const convertedTracks = data.files.map(file => ({
        id: file.id.toString(),
        name: file.name,
        artist: file.artist || '未知艺术家',
        album: file.album || '未知专辑',
        duration: file.duration || 0,
        filePath: `/music/${file.id}`,
        coverUrl: file.cover_art_url,
        folderId: file.folder_id
      }))
      
      // 将音乐分配到对应播放列表
      convertedPlaylists.forEach(playlist => {
        playlist.tracks = convertedTracks.filter(track => 
          track.folderId.toString() === playlist.id
        )
      })
      
      playlists.value = convertedPlaylists
    }
  } catch (error) {
    console.error('加载音乐数据失败:', error)
    // 保持现有mock数据作为fallback
  }
}

// 2. 修改播放URL获取
const playTrack = async (track: Track) => {
  try {
    const response = await musicAPI.getMusicPlayUrl(parseInt(track.id))
    const { data } = response.data
    
    // 使用真实的播放URL
    const audioUrl = data.play_url
    // ... 播放逻辑
  } catch (error) {
    console.error('获取播放链接失败:', error)
    // fallback到本地路径
  }
}
```

---

## 三、WebSocket 集成 - `src/utils/websocket.ts`

### 新建WebSocket管理器

```typescript
class WebSocketManager {
  private ws: WebSocket | null = null
  private eventHandlers: Map<string, Function[]> = new Map()
  private reconnectTimer: number | null = null
  private reconnectAttempts = 0
  private maxReconnectAttempts = 5
  
  connect() {
    const wsUrl = import.meta.env.PROD ? 'wss://api.liteisle.com/ws' : 'ws://localhost:8080/ws'
    this.ws = new WebSocket(wsUrl)
    
    this.ws.onopen = () => {
      console.log('WebSocket连接已建立')
      this.reconnectAttempts = 0
    }
    
    this.ws.onmessage = (event) => {
      const { event: eventName, payload } = JSON.parse(event.data)
      this.emit(eventName, payload)
    }
    
    this.ws.onclose = () => {
      console.log('WebSocket连接已断开')
      this.attemptReconnect()
    }
    
    this.ws.onerror = (error) => {
      console.error('WebSocket错误:', error)
    }
  }
  
  on(eventName: string, handler: Function) {
    if (!this.eventHandlers.has(eventName)) {
      this.eventHandlers.set(eventName, [])
    }
    this.eventHandlers.get(eventName)!.push(handler)
  }
  
  emit(eventName: string, payload: any) {
    const handlers = this.eventHandlers.get(eventName) || []
    handlers.forEach(handler => handler(payload))
  }
  
  private attemptReconnect() {
    if (this.reconnectAttempts < this.maxReconnectAttempts) {
      this.reconnectTimer = setTimeout(() => {
        this.reconnectAttempts++
        console.log(`尝试重连WebSocket (${this.reconnectAttempts}/${this.maxReconnectAttempts})`)
        this.connect()
      }, 1000 * Math.pow(2, this.reconnectAttempts)) // 指数退避
    }
  }
  
  disconnect() {
    if (this.reconnectTimer) {
      clearTimeout(this.reconnectTimer)
      this.reconnectTimer = null
    }
    if (this.ws) {
      this.ws.close()
      this.ws = null
    }
  }
}

export const wsManager = new WebSocketManager()
```

### App.vue中集成WebSocket

```typescript
// src/App.vue - onMounted部分
onMounted(async () => {
  try {
    // 并行初始化
    await Promise.all([
      authStore.initializeAuth(),
      vditorStore.initializeVditor()
    ])
    
    // 启动WebSocket连接
    wsManager.connect()
    
    // 监听文件状态更新
    wsManager.on('file.status.updated', (payload) => {
      // 更新DriveStore中的文件状态
      driveStore.updateFileStatus(payload.file_id, payload.status, payload.file_data)
    })
    
    // 监听传输日志更新
    wsManager.on('transfer.log.updated', (payload) => {
      // 更新TransferStore
      transferStore.updateTransferStatus(payload.log_id, payload.status)
    })
    
    console.log('应用初始化完成')
  } catch (error) {
    console.warn('应用初始化过程中出现错误:', error)
  }
})

// 清理WebSocket连接
onUnmounted(() => {
  wsManager.disconnect()
})
```

---

## 四、新增类型定义 - `src/types/api.d.ts`

```typescript
// 统一API响应格式
export interface ApiResponse<T = any> {
  code: number
  message: string
  data: T
}

// 分页响应格式
export interface PageResponse<T> {
  total: number
  current_page: number
  page_size: number
  records: T[]
}

// 文件夹内容响应
export interface FolderContentResponse {
  folders: {
    id: number
    name: string
    folder_type: 'system' | 'playlist' | 'notebook'
    sub_item_count: number
    sorted_order: number
    created_at: string
    updated_at: string
  }[]
  files: {
    id: number
    name: string
    file_type: 'music' | 'document'
    file_size: number
    status: 'processing' | 'available' | 'failed'
    sorted_order: number
    created_at: string
    updated_at: string
    artist?: string
    album?: string
    duration?: number
    cover_art_url?: string
  }[]
}

// 音乐页面响应
export interface MusicViewResponse {
  playlists: {
    id: number
    name: string
    folder_type: 'playlist'
    sorted_order: number
    music_count: number
  }[]
  files: {
    id: number
    folder_id: number
    name: string
    file_type: 'music'
    sorted_order: number
    artist: string
    album: string
    duration: number
    cover_art_url: string
  }[]
}

// 其他类型定义...
export interface DocumentViewResponse {
  notebooks: {
    id: number
    name: string
    folder_type: 'notebook'
    sorted_order: number
    document_count: number
  }[]
  files: {
    id: number
    folder_id: number
    name: string
    file_type: 'document'
    sorted_order: number
  }[]
}
```

---

## 五、页面组件调整

### 🔄 设置页面 - `src/pages/SettingsPage.vue`

#### 修改密码功能接入
```typescript
// 修改密码对话框处理逻辑
const handleChangePassword = async () => {
  if (!oldPassword.value || !newPassword.value || !confirmPassword.value) {
    toast.error('请填写完整信息')
    return
  }
  
  if (newPassword.value !== confirmPassword.value) {
    toast.error('两次输入的密码不一致')
    return
  }
  
  try {
    await authStore.resetPassword({
      old_password: oldPassword.value,
      new_password: newPassword.value,
      confirm_password: confirmPassword.value
    })
    
    toast.success('密码修改成功')
    showChangePasswordDialog.value = false
    // 清空表单
    oldPassword.value = ''
    newPassword.value = ''
    confirmPassword.value = ''
  } catch (error) {
    toast.error(error.message || '密码修改失败')
  }
}
```

#### 重置头像功能接入
```typescript
// 重置头像按钮处理逻辑
const resetUserPicture = async () => {
  try {
    await authStore.resetPicture()
    toast.success('头像已重置为默认头像')
  } catch (error) {
    toast.error(error.message || '头像重置失败')
  }
}
```

### 🔄 云盘页面 - `src/pages/DrivePage.vue`

#### 批量操作功能接入
```typescript
// 现有的selectedItemIds已经实现，只需要接入API调用

// 批量删除（对应现有的多选删除按钮）
const handleBatchDelete = async () => {
  if (selectedItemIds.value.size === 0) return
  
  try {
    await driveStore.batchDeleteItems()
    toast.success(`已删除 ${selectedItemIds.value.size} 个项目`)
  } catch (error) {
    toast.error('批量删除失败')
  }
}

// 批量移动（对应现有的剪切功能）
const handleBatchMove = async (targetFolderId: number) => {
  if (selectedItemIds.value.size === 0) return
  
  try {
    await driveStore.batchMoveItems(targetFolderId)
    toast.success(`已移动 ${selectedItemIds.value.size} 个项目`)
  } catch (error) {
    toast.error('批量移动失败')
  }
}
```

---

## 📋 实施检查清单

### 立即修改的文件：
- [ ] `src/utils/http.ts` - 重构所有API调用
- [ ] `src/store/AuthStore.ts` - 适配新认证接口
- [ ] `src/store/DriveStore.ts` - 替换mock数据
- [ ] `src/store/MusicStore.ts` - 接入音乐API
- [ ] `src/types/api.d.ts` - 新增类型定义
- [ ] `src/utils/websocket.ts` - 新增WebSocket管理
- [ ] `src/App.vue` - 集成WebSocket
- [ ] `src/pages/SettingsPage.vue` - 接入密码和头像API
- [ ] `src/pages/DrivePage.vue` - 接入批量操作API

### 测试验证：
- [ ] 认证流程（登录、注册、密码修改）
- [ ] 文件上传的异步处理和WebSocket更新
- [ ] 多选和批量操作（移动、删除）
- [ ] 音乐页面数据加载和播放
- [ ] 设置页面的各项功能
- [ ] 回收站操作
- [ ] 分享功能

### 性能优化：
- [ ] 添加请求去重机制
- [ ] 实现适当的缓存策略
- [ ] 优化大文件上传体验
- [ ] WebSocket重连机制

---

## 🎯 预期效果

完成以上修改后：

1. **API完全对接** - 所有功能使用真实后端数据
2. **实时更新** - 文件处理状态通过WebSocket实时反馈
3. **批量操作完整** - 多选UI已就绪，API对接完成后即可使用
4. **数据一致性** - 音乐/文档页面数据与云盘保持同步
5. **用户体验优化** - 异步处理减少等待时间
6. **功能完整性** - 设置页面所有功能可用

这个修改计划确保了前后端的完美对接，同时保持了现有前端代码的优秀架构！ 