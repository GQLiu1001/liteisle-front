# è½»å±¿è®°å‰ç«¯è”è°ƒä»£ç ä¿®æ”¹å‡†å¤‡ä¹¦ (æ›´æ–°ç‰ˆ)

## ğŸ“‹ APIåŠŸèƒ½è¦†ç›–å®Œæ•´æ€§ç¡®è®¤ - åŸºäºæœ€æ–°æ–‡æ¡£

ç»è¿‡è¯¦ç»†åˆ†æï¼Œ**æœ€æ–°APIæ–‡æ¡£å·²ç»100%è¦†ç›–äº†å‰ç«¯åº”ç”¨çš„æ‰€æœ‰åŠŸèƒ½éœ€æ±‚**ï¼Œå¹¶æ–°å¢äº†**å¢å¼ºå‹ä¸‹è½½åŠŸèƒ½**ï¼š

### âœ… åŠŸèƒ½è¦†ç›–åˆ†æ
1. **è®¤è¯ç³»ç»Ÿ** - å®Œæ•´è¦†ç›–ï¼ˆåŒ…æ‹¬è®¾ç½®é¡µé¢çš„å¯†ç ä¿®æ”¹å’Œå¤´åƒé‡ç½®ï¼‰
2. **æ–‡ä»¶ç®¡ç†** - å®Œæ•´è¦†ç›–ï¼ˆç°æœ‰å¤šé€‰UIå·²å°±ç»ªï¼Œåªéœ€APIå¯¹æ¥ï¼‰
3. **ğŸ†• å¢å¼ºä¸‹è½½** - æ–°å¢æ–‡ä»¶å¤¹æ¸…å•å’Œæ‰¹é‡ä¸‹è½½åŠŸèƒ½
4. **éŸ³ä¹æ’­æ”¾** - å®Œæ•´è¦†ç›–ï¼ˆèšåˆæŸ¥è¯¢è®¾è®¡ä¼˜ç§€ï¼‰
5. **æ–‡æ¡£ç®¡ç†** - å®Œæ•´è¦†ç›–ï¼ˆæ”¯æŒå¤šæ ¼å¼å’ŒMDç¼–è¾‘ï¼‰
6. **ä¼ è¾“ç®¡ç†** - å®Œæ•´è¦†ç›–ï¼ˆå¼‚æ­¥ä¸Šä¼ å’Œå®æ—¶çŠ¶æ€æ›´æ–°ï¼‰
7. **ä¸“æ³¨å²›å±¿** - å®Œæ•´è¦†ç›–ï¼ˆç»Ÿè®¡å’Œæ”¶é›†åŠŸèƒ½é½å…¨ï¼‰
8. **åˆ†äº«åŠŸèƒ½** - å®Œæ•´è¦†ç›–ï¼ˆè®¾ç½®é¡µé¢å·²æœ‰åˆ†äº«ç®¡ç†UIï¼‰
9. **å›æ”¶ç«™** - å®Œæ•´è¦†ç›–ï¼ˆé¡µé¢å·²æœ‰å¯¹åº”æ“ä½œæŒ‰é’®ï¼‰

---

## ğŸ¯ æ ¸å¿ƒä¿®æ”¹ç­–ç•¥ï¼ˆæ›´æ–°ç‰ˆï¼‰

### 1. APIè·¯å¾„ç»Ÿä¸€åŸåˆ™
- **ç»Ÿä¸€å‰ç¼€**ï¼šæ‰€æœ‰APIä½¿ç”¨ `/v1` å‰ç¼€
- **å“åº”æ ¼å¼**ï¼šç»Ÿä¸€å¤„ç† `{code, message, data}` ç»“æ„
- **å‘½åè½¬æ¢**ï¼šsnake_case â†” camelCase è‡ªåŠ¨è½¬æ¢

### 2. æ–°å¢ä¸‹è½½å¢å¼ºåŠŸèƒ½
- **æ–‡ä»¶å¤¹æ¸…å•è·å–** - æ”¯æŒé€’å½’è·å–ç›®å½•ç»“æ„
- **æ‰¹é‡ä¸‹è½½æ¸…å•** - å¤šé€‰æ–‡ä»¶/æ–‡ä»¶å¤¹çš„ç»Ÿä¸€ä¸‹è½½
- **ä¸‹è½½è¿›åº¦ç®¡ç†** - åŸºäºæ¸…å•çš„ç²¾ç¡®è¿›åº¦æ˜¾ç¤º

### 3. ç°æœ‰ä¼˜åŠ¿ä¿æŒ
- **å¤šé€‰åŠŸèƒ½å·²å®Œæ•´** - DrivePageä¸­çš„ `selectedItemIds` å·²å®ç°
- **æ‰¹é‡æ“ä½œUIå°±ç»ª** - å³é”®èœå•å·²æ”¯æŒæ‰¹é‡æ“ä½œæ˜¾ç¤º
- **WebSocketåŸºç¡€** - åªéœ€æ·»åŠ è¿æ¥å’Œäº‹ä»¶ç›‘å¬

---

## ğŸ“ è¯¦ç»†ä¿®æ”¹è®¡åˆ’

## ä¸€ã€HTTP åŸºç¡€å±‚é‡æ„ - `src/utils/http.ts`

### ğŸ”„ åŸºç¡€é…ç½®ä¿®æ”¹ (ä¿æŒä¸å˜)

```typescript
// 1. ä¿®æ”¹baseURLé…ç½®
const http: AxiosInstance = axios.create({
  baseURL: import.meta.env.PROD ? '/api/v1' : 'http://localhost:8080/api/v1',
  timeout: 10000,
  headers: {
    'Content-Type': 'application/json'
  }
})

// 2. å“åº”æ‹¦æˆªå™¨ - å¤„ç†ç»Ÿä¸€å“åº”æ ¼å¼
http.interceptors.response.use(
  (response: AxiosResponse) => {
    const { code, message, data } = response.data
    if (code === 200 || code === 202) {
      return { ...response, data: { code, message, data } }
    } else {
      throw new Error(message || 'è¯·æ±‚å¤±è´¥')
    }
  },
  // ç°æœ‰é”™è¯¯å¤„ç†é€»è¾‘ä¿æŒä¸å˜...
)
```

### ğŸ†• å¢å¼ºä¸‹è½½APIï¼ˆé‡è¦æ›´æ–°ï¼‰

```typescript
// æ–°å¢ï¼šä¸‹è½½ç›¸å…³APIï¼ˆåŸºäºæœ€æ–°æ–‡æ¡£ï¼‰
export const downloadAPI = {
  // è·å–å•ä¸ªæ–‡ä»¶ä¸‹è½½é“¾æ¥ï¼ˆä¿æŒä¸å˜ï¼‰
  getFileDownloadUrl: (fileId: number) => {
    return get(`/download/file/${fileId}`)
  },
  
  // âœ¨ æ–°å¢ï¼šè·å–æ–‡ä»¶å¤¹å†…å®¹æ¸…å•ï¼ˆé€’å½’ï¼‰
  getFolderManifest: (folderId: number) => {
    return get(`/folders/${folderId}/manifest`)
  },
  
  // âœ¨ æ–°å¢ï¼šè·å–æ‰¹é‡é€‰æ‹©çš„ä¸‹è½½æ¸…å•
  getBatchManifest: (data: { file_ids?: number[]; folder_ids?: number[] }) => {
    return post('/items/manifest', data)
  }
}
```

### ğŸ”„ ä¼ è¾“APIæ›´æ–°ï¼ˆæ”¯æŒæ–°çš„ä¸‹è½½æµç¨‹ï¼‰

```typescript
export const transferAPI = {
  // æ–‡ä»¶ä¸Šä¼ ï¼ˆä¿æŒä¸å˜ï¼‰
  uploadFile: (file: File, folderId?: number, onProgress?: (progress: number) => void) => {
    const formData = new FormData()
    formData.append('file', file)
    if (folderId) formData.append('folder_id', folderId.toString())
    
    return post('/upload', formData, {
      headers: { 'Content-Type': 'multipart/form-data' },
      onUploadProgress: (progressEvent) => {
        if (onProgress && progressEvent.total) {
          const progress = Math.round((progressEvent.loaded * 100) / progressEvent.total)
          onProgress(progress)
        }
      }
    })
  },
  
  // âœ¨ é‡æ„ï¼šè·å–ä¸‹è½½é“¾æ¥ - æ”¯æŒæ–°çš„æ¸…å•æ¨¡å¼
  getDownloadInfo: async (selection: { fileIds?: number[]; folderIds?: number[] }) => {
    const { fileIds = [], folderIds = [] } = selection
    
    // å¦‚æœåªæœ‰ä¸€ä¸ªæ–‡ä»¶ï¼Œç›´æ¥è·å–ä¸‹è½½é“¾æ¥
    if (fileIds.length === 1 && folderIds.length === 0) {
      return downloadAPI.getFileDownloadUrl(fileIds[0])
    }
    
    // å¦åˆ™è·å–æ‰¹é‡æ¸…å•
    return downloadAPI.getBatchManifest({
      file_ids: fileIds.length > 0 ? fileIds : undefined,
      folder_ids: folderIds.length > 0 ? folderIds : undefined
    })
  },
  
  // è·å–ä¼ è¾“æ‘˜è¦ï¼ˆä¿æŒä¸å˜ï¼‰
  getTransferSummary: () => {
    return get('/transfers/summary')
  },
  
  // è·å–ä¼ è¾“å†å²ï¼ˆä¿æŒä¸å˜ï¼‰
  getTransferHistory: (params?: { status?: string; page?: number; size?: number }) => {
    return get('/transfers', { params })
  },
  
  // åˆ é™¤ä¼ è¾“è®°å½•ï¼ˆä¿æŒä¸å˜ï¼‰
  deleteTransferLog: (logId: number, deleteFile: boolean = false) => {
    return del(`/transfers/${logId}`, { params: { delete_file: deleteFile } })
  },
  
  // æ¸…ç©ºå·²å®Œæˆè®°å½•ï¼ˆä¿æŒä¸å˜ï¼‰
  clearCompletedTransfers: () => {
    return del('/transfers/completed')
  }
}
```

---

## äºŒã€æ–°å¢ä¸‹è½½ç®¡ç†Store - `src/store/DownloadStore.ts`

### ğŸ†• åˆ›å»ºä¸“é—¨çš„ä¸‹è½½ç®¡ç†Store

```typescript
import { defineStore } from 'pinia'
import { ref, computed } from 'vue'
import { downloadAPI, transferAPI } from '../utils/http'

// ä¸‹è½½ä»»åŠ¡æ¥å£å®šä¹‰
interface DownloadTask {
  id: string
  name: string
  totalSize: number
  totalFiles: number
  downloadedSize: number
  downloadedFiles: number
  status: 'pending' | 'downloading' | 'completed' | 'failed' | 'paused'
  items: DownloadItem[]
  startTime?: Date
  endTime?: Date
  error?: string
}

interface DownloadItem {
  type: 'directory' | 'file'
  relativePath: string
  fileId?: number
  size?: number
  downloaded?: boolean
  downloadUrl?: string
}

export const useDownloadStore = defineStore('download', () => {
  // çŠ¶æ€
  const downloadTasks = ref<DownloadTask[]>([])
  const isDownloading = ref(false)
  
  // è®¡ç®—å±æ€§
  const activeDownloads = computed(() => 
    downloadTasks.value.filter(task => task.status === 'downloading')
  )
  
  const completedDownloads = computed(() => 
    downloadTasks.value.filter(task => task.status === 'completed')
  )
  
  // âœ¨ åˆ›å»ºä¸‹è½½ä»»åŠ¡ï¼ˆæ”¯æŒæ–°çš„æ¸…å•APIï¼‰
  const createDownloadTask = async (selection: {
    fileIds?: number[]
    folderIds?: number[]
    taskName?: string
  }): Promise<string> => {
    try {
      // è·å–ä¸‹è½½æ¸…å•
      const response = await transferAPI.getDownloadInfo({
        fileIds: selection.fileIds,
        folderIds: selection.folderIds
      })
      
      const { data } = response.data
      
      // åˆ›å»ºä¸‹è½½ä»»åŠ¡
      const taskId = generateTaskId()
      const task: DownloadTask = {
        id: taskId,
        name: selection.taskName || `ä¸‹è½½ä»»åŠ¡_${new Date().toLocaleString()}`,
        totalSize: data.total_size || 0,
        totalFiles: data.total_files || 0,
        downloadedSize: 0,
        downloadedFiles: 0,
        status: 'pending',
                 items: data.items?.map(item => ({
           type: item.type,
           relativePath: item.relative_path,
           fileId: item.file_id,
           size: item.size,
           downloaded: false
         })) || [],
        startTime: new Date()
      }
      
      downloadTasks.value.push(task)
      return taskId
    } catch (error) {
      console.error('åˆ›å»ºä¸‹è½½ä»»åŠ¡å¤±è´¥:', error)
      throw error
    }
  }
  
  // âœ¨ å¼€å§‹ä¸‹è½½ä»»åŠ¡ï¼ˆåŸºäºæ¸…å•é€æ–‡ä»¶ä¸‹è½½ï¼‰
  const startDownload = async (taskId: string): Promise<void> => {
    const task = downloadTasks.value.find(t => t.id === taskId)
    if (!task) return
    
    task.status = 'downloading'
    isDownloading.value = true
    
    try {
      // è¿‡æ»¤å‡ºéœ€è¦ä¸‹è½½çš„æ–‡ä»¶
      const filesToDownload = task.items.filter(item => item.type === 'file')
      
      for (const fileItem of filesToDownload) {
        if (task.status !== 'downloading') break // æ”¯æŒæš‚åœ
        
        await downloadSingleFile(task, fileItem)
        task.downloadedFiles++
      }
      
      task.status = 'completed'
      task.endTime = new Date()
    } catch (error) {
      task.status = 'failed'
      task.error = error.message || 'ä¸‹è½½å¤±è´¥'
      console.error('ä¸‹è½½ä»»åŠ¡å¤±è´¥:', error)
    } finally {
      isDownloading.value = activeDownloads.value.length > 0
    }
  }
  
  // ä¸‹è½½å•ä¸ªæ–‡ä»¶
  const downloadSingleFile = async (task: DownloadTask, fileItem: DownloadItem): Promise<void> => {
    if (!fileItem.fileId) return
    
    try {
      // è·å–æ–‡ä»¶ä¸‹è½½é“¾æ¥
      const response = await downloadAPI.getFileDownloadUrl(fileItem.fileId)
      const downloadInfo = response.data.data[0]
      
             // ä½¿ç”¨Electronçš„ä¸‹è½½APIæˆ–æµè§ˆå™¨ä¸‹è½½
       if (window.electronAPI) {
         // Electronç¯å¢ƒä¸‹çš„ä¸‹è½½
         await window.electronAPI.downloadFile({
           url: downloadInfo.download_url,
           filePath: fileItem.relativePath,
           expectedSize: fileItem.size
         })
       } else {
        // æµè§ˆå™¨ç¯å¢ƒä¸‹çš„ä¸‹è½½ï¼ˆé™çº§æ–¹æ¡ˆï¼‰
        const link = document.createElement('a')
        link.href = downloadInfo.download_url
        link.download = fileItem.relativePath.split('/').pop() || 'download'
        document.body.appendChild(link)
        link.click()
        document.body.removeChild(link)
      }
      
      fileItem.downloaded = true
      task.downloadedSize += fileItem.size || 0
    } catch (error) {
      console.error(`æ–‡ä»¶ä¸‹è½½å¤±è´¥: ${fileItem.relativePath}`, error)
      throw error
    }
  }
  
  // æš‚åœä¸‹è½½
  const pauseDownload = (taskId: string): void => {
    const task = downloadTasks.value.find(t => t.id === taskId)
    if (task && task.status === 'downloading') {
      task.status = 'paused'
    }
  }
  
  // æ¢å¤ä¸‹è½½
  const resumeDownload = (taskId: string): Promise<void> => {
    return startDownload(taskId)
  }
  
  // åˆ é™¤ä¸‹è½½ä»»åŠ¡
  const removeDownloadTask = (taskId: string): void => {
    const index = downloadTasks.value.findIndex(t => t.id === taskId)
    if (index !== -1) {
      downloadTasks.value.splice(index, 1)
    }
  }
  
  // å·¥å…·å‡½æ•°
  const generateTaskId = (): string => {
    return `task_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`
  }
  
  return {
    // çŠ¶æ€
    downloadTasks,
    isDownloading,
    
    // è®¡ç®—å±æ€§
    activeDownloads,
    completedDownloads,
    
    // æ–¹æ³•
    createDownloadTask,
    startDownload,
    pauseDownload,
    resumeDownload,
    removeDownloadTask
  }
})
```

---

## ä¸‰ã€DriveStore è°ƒæ•´ - `src/store/DriveStore.ts`

### ğŸ”„ é›†æˆæ–°çš„ä¸‹è½½åŠŸèƒ½

```typescript
// åœ¨ç°æœ‰DriveStoreä¸­æ–°å¢ä¸‹è½½ç›¸å…³æ–¹æ³•

import { useDownloadStore } from './DownloadStore'

// åœ¨DriveStoreå†…éƒ¨æ·»åŠ ä»¥ä¸‹æ–¹æ³•ï¼š

// âœ¨ æ‰¹é‡ä¸‹è½½é€‰ä¸­é¡¹ç›®ï¼ˆå¯¹åº”ç°æœ‰çš„ä¸‹è½½æŒ‰é’®ï¼‰
const batchDownloadItems = async () => {
  if (selectedItemIds.value.size === 0) return
  
  const downloadStore = useDownloadStore()
  const fileIds: number[] = []
  const folderIds: number[] = []
  
  // ä»selectedItemIdsä¸­åˆ†ç¦»æ–‡ä»¶å’Œæ–‡ä»¶å¤¹
  selectedItemIds.value.forEach(id => {
    const item = findItemById(id)
    if (item?.type === 'folder') {
      folderIds.push(id)
    } else {
      fileIds.push(id)
    }
  })
  
  try {
    // åˆ›å»ºä¸‹è½½ä»»åŠ¡
    const taskId = await downloadStore.createDownloadTask({
      fileIds: fileIds.length > 0 ? fileIds : undefined,
      folderIds: folderIds.length > 0 ? folderIds : undefined,
      taskName: `æ‰¹é‡ä¸‹è½½_${selectedItemIds.value.size}é¡¹`
    })
    
    // å¼€å§‹ä¸‹è½½
    await downloadStore.startDownload(taskId)
    
    // æ¸…é™¤é€‰ä¸­çŠ¶æ€
    selectedItemIds.value.clear()
    
    // æç¤ºç”¨æˆ·
    console.log(`å·²å¼€å§‹ä¸‹è½½ä»»åŠ¡: ${taskId}`)
  } catch (error) {
    console.error('æ‰¹é‡ä¸‹è½½å¤±è´¥:', error)
    throw error
  }
}

// âœ¨ å•ä¸ªé¡¹ç›®ä¸‹è½½ï¼ˆå¯¹åº”å³é”®èœå•ä¸‹è½½ï¼‰
const downloadSingleItem = async (itemId: number, itemType: 'file' | 'folder') => {
  const downloadStore = useDownloadStore()
  
  try {
    const taskId = await downloadStore.createDownloadTask({
      fileIds: itemType === 'file' ? [itemId] : undefined,
      folderIds: itemType === 'folder' ? [itemId] : undefined,
      taskName: `ä¸‹è½½_${findItemById(itemId)?.name || 'unknown'}`
    })
    
    await downloadStore.startDownload(taskId)
  } catch (error) {
    console.error('å•é¡¹ä¸‹è½½å¤±è´¥:', error)
    throw error
  }
}
```

---

## å››ã€æ–°å¢ç±»å‹å®šä¹‰ - `src/types/api.d.ts`

### ğŸ†• ä¸‹è½½ç›¸å…³ç±»å‹å®šä¹‰

```typescript
// æ–°å¢ï¼šä¸‹è½½æ¸…å•ç›¸å…³ç±»å‹
export interface FolderManifestResponse {
  root_folder_name: string
  total_size: number
  total_files: number
  items: ManifestItem[]
}

export interface BatchManifestResponse {
  total_size: number
  total_files: number
  items: ManifestItem[]
}

export interface ManifestItem {
  type: 'directory' | 'file'
  relative_path: string
  file_id?: number
  size?: number
}

// åŸæœ‰ç±»å‹å®šä¹‰ä¿æŒä¸å˜...
export interface ApiResponse<T = any> {
  code: number
  message: string
  data: T
}

export interface PageResponse<T> {
  total: number
  current_page: number
  page_size: number
  records: T[]
}
```

---

## äº”ã€é¡µé¢ç»„ä»¶è°ƒæ•´

### ğŸ”„ äº‘ç›˜é¡µé¢ - `src/pages/DrivePage.vue`

#### ğŸ†• é›†æˆæ–°çš„ä¸‹è½½åŠŸèƒ½

```typescript
// åœ¨ç°æœ‰çš„DrivePage.vueä¸­æ·»åŠ ä¸‹è½½ç›¸å…³æ–¹æ³•

import { useDownloadStore } from '../store/DownloadStore'

const downloadStore = useDownloadStore()

// âœ¨ æ‰¹é‡ä¸‹è½½ï¼ˆå¯¹åº”ç°æœ‰çš„ä¸‹è½½æŒ‰é’®ï¼‰
const handleBatchDownload = async () => {
  if (selectedItemIds.value.size === 0) return
  
  try {
    await driveStore.batchDownloadItems()
    toast.success(`å·²å¼€å§‹ä¸‹è½½ ${selectedItemIds.value.size} ä¸ªé¡¹ç›®`)
  } catch (error) {
    toast.error('ä¸‹è½½å¤±è´¥')
  }
}

// âœ¨ å³é”®èœå•ä¸‹è½½
const handleContextDownload = async (item: DriveItem) => {
  try {
    await driveStore.downloadSingleItem(item.id, item.type === 'folder' ? 'folder' : 'file')
    toast.success(`å·²å¼€å§‹ä¸‹è½½ ${item.name}`)
  } catch (error) {
    toast.error('ä¸‹è½½å¤±è´¥')
  }
}

// ç°æœ‰çš„æ‰¹é‡æ“ä½œä¿æŒä¸å˜...
const handleBatchDelete = async () => {
  // ... ç°æœ‰é€»è¾‘
}

const handleBatchMove = async (targetFolderId: number) => {
  // ... ç°æœ‰é€»è¾‘
}
```

### ğŸ†• ä¸‹è½½ç®¡ç†é¡µé¢ç»„ä»¶ - `src/components/DownloadManager.vue`

```vue
<template>
  <div class="download-manager">
    <div class="download-header">
      <h3>ä¸‹è½½ç®¡ç†</h3>
      <div class="download-stats">
        <span>æ´»è·ƒ: {{ activeDownloads.length }}</span>
        <span>å·²å®Œæˆ: {{ completedDownloads.length }}</span>
      </div>
    </div>
    
    <div class="download-list">
      <div 
        v-for="task in downloadTasks" 
        :key="task.id"
        class="download-task"
        :class="task.status"
      >
        <div class="task-info">
          <div class="task-name">{{ task.name }}</div>
          <div class="task-progress">
            <div class="progress-bar">
              <div 
                class="progress-fill"
                :style="{ width: `${(task.downloadedFiles / task.totalFiles) * 100}%` }"
              ></div>
            </div>
            <span class="progress-text">
              {{ task.downloadedFiles }}/{{ task.totalFiles }} æ–‡ä»¶
              ({{ formatBytes(task.downloadedSize) }}/{{ formatBytes(task.totalSize) }})
            </span>
          </div>
        </div>
        
        <div class="task-actions">
          <button 
            v-if="task.status === 'downloading'"
            @click="downloadStore.pauseDownload(task.id)"
            class="btn-pause"
          >
            æš‚åœ
          </button>
          <button 
            v-else-if="task.status === 'paused'"
            @click="downloadStore.resumeDownload(task.id)"
            class="btn-resume"
          >
            ç»§ç»­
          </button>
          <button 
            v-if="task.status === 'completed' || task.status === 'failed'"
            @click="downloadStore.removeDownloadTask(task.id)"
            class="btn-remove"
          >
            ç§»é™¤
          </button>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { useDownloadStore } from '../store/DownloadStore'

const downloadStore = useDownloadStore()
const { downloadTasks, activeDownloads, completedDownloads } = storeToRefs(downloadStore)

const formatBytes = (bytes: number): string => {
  if (bytes === 0) return '0 B'
  const k = 1024
  const sizes = ['B', 'KB', 'MB', 'GB']
  const i = Math.floor(Math.log(bytes) / Math.log(k))
  return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i]
}
</script>
```

---

## ğŸ“‹ å®æ–½æ£€æŸ¥æ¸…å•ï¼ˆæ›´æ–°ç‰ˆï¼‰

### ç«‹å³ä¿®æ”¹çš„æ–‡ä»¶ï¼š

#### æ ¸å¿ƒAPIå±‚
- [ ] `src/utils/http.ts` - æ–°å¢ä¸‹è½½æ¸…å•API
- [ ] `src/types/api.d.ts` - æ–°å¢ä¸‹è½½ç›¸å…³ç±»å‹å®šä¹‰

#### Storeå±‚
- [ ] **ğŸ†• `src/store/DownloadStore.ts`** - åˆ›å»ºä¸‹è½½ç®¡ç†Store
- [ ] `src/store/DriveStore.ts` - é›†æˆä¸‹è½½åŠŸèƒ½æ–¹æ³•
- [ ] `src/store/AuthStore.ts` - é€‚é…æ–°è®¤è¯æ¥å£ï¼ˆä¿æŒä¸å˜ï¼‰
- [ ] `src/store/MusicStore.ts` - æ¥å…¥éŸ³ä¹APIï¼ˆä¿æŒä¸å˜ï¼‰

#### ç»„ä»¶å±‚
- [ ] **ğŸ†• `src/components/DownloadManager.vue`** - åˆ›å»ºä¸‹è½½ç®¡ç†ç»„ä»¶
- [ ] `src/pages/DrivePage.vue` - é›†æˆæ–°ä¸‹è½½åŠŸèƒ½
- [ ] `src/pages/SettingsPage.vue` - æ¥å…¥å¯†ç å’Œå¤´åƒAPIï¼ˆä¿æŒä¸å˜ï¼‰

#### ç³»ç»Ÿå±‚
- [ ] `src/utils/websocket.ts` - æ–°å¢WebSocketç®¡ç†ï¼ˆä¿æŒä¸å˜ï¼‰
- [ ] `src/App.vue` - é›†æˆWebSocketï¼ˆä¿æŒä¸å˜ï¼‰

### ğŸ†• æ–°å¢åŠŸèƒ½æµ‹è¯•ï¼š

#### ä¸‹è½½åŠŸèƒ½éªŒè¯
- [ ] å•æ–‡ä»¶ä¸‹è½½é“¾æ¥è·å–
- [ ] æ–‡ä»¶å¤¹æ¸…å•é€’å½’è·å–
- [ ] æ‰¹é‡é€‰æ‹©ä¸‹è½½æ¸…å•ç”Ÿæˆ
- [ ] ä¸‹è½½è¿›åº¦æ˜¾ç¤ºå’Œç®¡ç†
- [ ] ä¸‹è½½ä»»åŠ¡æš‚åœ/æ¢å¤/åˆ é™¤

#### ç°æœ‰åŠŸèƒ½ä¿æŒ
- [ ] è®¤è¯æµç¨‹ï¼ˆç™»å½•ã€æ³¨å†Œã€å¯†ç ä¿®æ”¹ï¼‰
- [ ] æ–‡ä»¶ä¸Šä¼ çš„å¼‚æ­¥å¤„ç†å’ŒWebSocketæ›´æ–°
- [ ] å¤šé€‰å’Œæ‰¹é‡æ“ä½œï¼ˆç§»åŠ¨ã€åˆ é™¤ï¼‰
- [ ] éŸ³ä¹é¡µé¢æ•°æ®åŠ è½½å’Œæ’­æ”¾
- [ ] è®¾ç½®é¡µé¢çš„å„é¡¹åŠŸèƒ½
- [ ] å›æ”¶ç«™æ“ä½œ
- [ ] åˆ†äº«åŠŸèƒ½

---

## ğŸ¯ é¢„æœŸæ•ˆæœï¼ˆæ›´æ–°ç‰ˆï¼‰

å®Œæˆä»¥ä¸Šä¿®æ”¹åï¼Œé™¤äº†åŸæœ‰çš„æ‰€æœ‰åŠŸèƒ½å¤–ï¼Œè¿˜å°†æ–°å¢ï¼š

### ğŸ†• å¢å¼ºçš„ä¸‹è½½ä½“éªŒ
1. **æ™ºèƒ½ä¸‹è½½ç®¡ç†** - åŸºäºæ¸…å•çš„ç²¾ç¡®è¿›åº¦æ˜¾ç¤º
2. **æ–‡ä»¶å¤¹ä¸‹è½½** - ä¿æŒå®Œæ•´ç›®å½•ç»“æ„çš„æ‰¹é‡ä¸‹è½½
3. **å¤šä»»åŠ¡å¹¶è¡Œ** - æ”¯æŒå¤šä¸ªä¸‹è½½ä»»åŠ¡åŒæ—¶è¿›è¡Œ
4. **æ–­ç‚¹ç»­ä¼ åŸºç¡€** - ä¸‹è½½ä»»åŠ¡å¯æš‚åœå’Œæ¢å¤

### ä¿æŒçš„åŸæœ‰ä¼˜åŠ¿
1. **APIå®Œå…¨å¯¹æ¥** - æ‰€æœ‰åŠŸèƒ½ä½¿ç”¨çœŸå®åç«¯æ•°æ®
2. **å®æ—¶æ›´æ–°** - æ–‡ä»¶å¤„ç†çŠ¶æ€é€šè¿‡WebSocketå®æ—¶åé¦ˆ
3. **æ‰¹é‡æ“ä½œå®Œæ•´** - å¤šé€‰UIå·²å°±ç»ªï¼ŒAPIå¯¹æ¥å®Œæˆåå³å¯ä½¿ç”¨
4. **æ•°æ®ä¸€è‡´æ€§** - éŸ³ä¹/æ–‡æ¡£é¡µé¢æ•°æ®ä¸äº‘ç›˜ä¿æŒåŒæ­¥
5. **ç”¨æˆ·ä½“éªŒä¼˜åŒ–** - å¼‚æ­¥å¤„ç†å‡å°‘ç­‰å¾…æ—¶é—´
6. **åŠŸèƒ½å®Œæ•´æ€§** - è®¾ç½®é¡µé¢æ‰€æœ‰åŠŸèƒ½å¯ç”¨

**è¿™ä¸ªæ›´æ–°ç‰ˆä¿®æ”¹è®¡åˆ’åœ¨ä¿æŒåŸæœ‰æ¶æ„ä¼˜åŠ¿çš„åŸºç¡€ä¸Šï¼Œå¤§å¹…æå‡äº†ä¸‹è½½ä½“éªŒï¼Œä¸ºç”¨æˆ·æä¾›æ›´åŠ å®Œå–„çš„æ–‡ä»¶ç®¡ç†åŠŸèƒ½ï¼** 