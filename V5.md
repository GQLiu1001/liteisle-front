轻屿记
一、产品定位
轻屿记是一款功能丰富的桌面端应用，集成了云盘、音乐播放器、Markdown 编辑器、文档查看器和专注记录等多种功能，为用户提供便捷的文件管理、音乐播放、文档编辑和记录专注时间等服务。注意！严格遵守二级文件夹格式，根目录下只能存在四个系统文件夹（创建用户时一起创建）！主要功能模块为音乐与文档！

系统严格要求文件在第三集目录，自定义文件夹在第二级目录下，然后根目录只能有系统文件夹！ 

☁️ 云盘 (这是一个虚拟的根，可以认为它的 parent_id 是 0)
│
├─📁 歌单 (id=1, parent_id=0, type=system)
│  │
│  ├─📁 我喜欢的音乐 (id=101, parent_id=1, type=playlist)
│  │  │
│  │  ├─🎵 晴天.mp3 (id=201, folder_id=101)
│  │  └─🎵 七里香.mp3 (id=202, folder_id=101)
│  │
│  └─📁 纯音乐 (id=102, parent_id=1, type=playlist)
│     │
│     └─🎵 克罗地亚狂想曲.mp3 (id=203, folder_id=102)
│
├─📁 文档 (id=2, parent_id=0, type=system)
│  │
│  └─📁 工作笔记 (id=103, parent_id=2, type=booklist)
│     │
│     └─📄 周会纪要.md (id=204, folder_id=103)
│
├─📁 分享 (id=3, parent_id=0, type=system)
│
└─📁 上传 (id=4, parent_id=0, type=system)
（一）技术架构
前端：使用 Vue 编写，结合 Electron 进行打包，为用户提供流畅的桌面端交互体验。

后端：SpringBoot 、SpringTask 、SpringAI 、MyBatis-Plus 、MySQL 、Redis 、MinIO 、RabbitMQ  、WebSocket 、FFmpeg 

数据存储与检索：以 MySQL 作为主业务数据库，Redis 作为高性能缓存，MINIO 作为对象存储，共同构成了多层次、高性能的数据解决方案。MinIO存储音乐、pdf等文件通过文件哈希实现秒传和去重。md文档存Redis与MySQL 。

二、功能模块说明
（一）云盘文件页面
1. 文件夹结构规则
云盘的文件夹结构严格遵循特定规则，旨在为音乐与文档的云同步服务提供支持。

根目录下的一级文件夹（歌单、文档、分享、上传）为固定文件夹，不可进行创建、修改或删除操作。

说明：当第一次点开云盘页面时，传递parent_id为0的请求，后端通过parent_id为0判断用户请求为根目录，即通过folder_type和user_id返回当前用户的歌单、文档、分享、上传文件夹信息。

新用户初始化：当一个新用户通过 POST /auth/register 注册时，后端服务需要在创建用户记录后，自动为其创建四个根目录下的系统文件夹（歌单、文档、分享、上传）。这个逻辑属于后端注册流程的一部分，API层面无需变动，但在实现时需要确保。

一级目录下的二级文件夹可自定义，如歌单（playlist）和文档分类（booklist）等（前后端双重鉴定，防止文件夹嵌套和结构混乱）。二级文件夹中可以存在文件，但如果文件未放入二级文件夹，将无法在音乐页面和文档页面中被识别。

二级目录下仅允许存放文件，禁止文件夹嵌套。

字段说明：数据库中folder_type有三类：system、playlist、booklist，分别对应系统的文件夹内：歌单文档上传分享，自定义的歌单文件夹内，自定义的图书分类文件夹内，存放上传任务结果的上传文件内，存放分享链接下载任务结果的分享文件夹内（可以自定文件夹）。

2. 导航栏与面包屑
云盘页面顶部设有面包屑导航栏，方便用户在不同目录间进行导航。当用户拖拽文件夹或文件到面包屑上时，会显示目标目录的下拉框，确保操作符合文件夹结构规则。拖拽 文件夹 时仅显示根目录四大类，拖拽 文件 时可显示二级文件夹 。

拖拽面包屑的下拉框信息请求复用API”获取所有文件夹层级“ 。

在默认根目录下，导航栏仅显示 “云盘” 一项。

3. 工具栏功能
当前页面信息：显示当前页面的名称（如根目录为 “云盘”）以及该页面包含的项目数量。

刷新按钮：点击后可获取云盘的所有最新信息。

搜索功能：支持对文件名、文件夹名、音乐元数据（歌手/专辑）乃至Markdown笔记正文的毫秒级快速搜索，并提供搜索结果高亮显示。

排序按钮：提供按名称、创建时间、修改时间、大小和默认自定义排序(sorted_order)五种排序方式。

视图按钮：可在方块视图和列表视图之间进行切换。

回收站按钮：支持拖拽文件或文件夹进行软删除操作，点击该按钮可进入回收站页面。

4. 回收站页面
回收站工具栏提供一键恢复和删除功能。

页面中的文件和文件夹右键菜单仅提供恢复和删除选项。

在列表视图下，显示文件或文件夹的大小、删除时间和清除时间（硬编码为 30 天）。

面包屑显示为 “云盘> 回收站”，点击可返回云盘根目录。

5. 根目录操作
右键空白处：仅提供刷新功能。

右键文件夹（歌单、文档、分享、上传）：提供刷新、打开、下载和详细信息功能。根目录禁止出现其他文件夹和文件。

6. 一级目录操作
一级目录的云盘界面有新建文件夹框。

右键空白处：提供刷新和新建文件夹功能。

右键文件夹与文件：提供刷新、打开、下载、分享、复制、剪切、删除、重命名、移动到和详细信息功能。

下载：触发传输页面的下载任务，用户可在设置页面自行修改下载目录（客户端设置，与后端无关）。

分享：用户可选择分享时间和是否加密，点击生成链接后，后端将生成并返回 “链接 & 密码” 格式的信息，自动复制到剪贴板。

移动到：文件夹移动时仅显示根目录的四个大类文件夹；文件移动时可显示二级文件夹。

详细信息：显示名称、类型、大小、修改时间和路径。

7. 二级目录操作
二级目录的云盘界面有上传文件框。

右键空白处：提供刷新和上传文件功能，上传文件将自动触发传输页面的上传任务。

右键文件：提供刷新、打开、下载、分享、复制、剪切、删除、重命名、移动到和详细信息功能。

（二）云盘传输页面
采用两栏布局，左栏为切换上传和下载视图的按钮，显示当前相应的任务数量。

右栏为任务框，提供 “上传文件” 按钮，可快速上传文件（硬编码放到根目录下的上传文件夹）。用户可取消任务，切换到已完成框进行文件或记录的删除操作，支持一键删除，也可选择单独删除文件、记录或两者同时删除。

提供 “分享链接” 按钮，用户输入别人分享的链接后，将自动触发上传任务（硬编码放到根目录下的分享文件夹）。应用的所有上传和下载相关操作都会经过该页面，并生成记录。

注意，上传任务和分享任务存储位置不能变！可以后期拖拽！

（三）音乐页面
1. 文件存储位置
云盘根目录下的歌单文件夹：歌单文件夹内的子文件夹相当于一个个歌单。

应用底边栏的歌曲栏：显示当前播放信息，点击左侧专辑封面可跳转至音乐页面。提供一般音乐播放器功能，如播放、暂停、下一首、调节音量、静音、改变播放逻辑（顺序播放、单曲循环、随机播放）以及快速切换歌单与音乐。

2. 页面布局与功能
左边栏：为可自定义顺序的歌单列表，会自动选中当前播放的歌单，提供 “+ 新建歌单” 按钮，相当于在云盘一级目录下右键创建文件夹。(自定义排序需要传入新位置的前一个id和后一个id)

中间栏：显示当前选中歌单的歌曲列表（可自定义顺序），会自动选中当前播放的歌曲，提供 “添加” 按钮，相当于在云盘二级目录下上传文件。(自定义排序需要传入新位置的前一个id和后一个id)

右边栏：为可折叠的当前播放音乐的详细信息栏，显示歌曲名字、专辑名、作者名以及一个可拖拽进度条。底部音乐栏与音乐页面同步，应用启动时会单独获取相应的全部元信息。

（四）文档页面
文档页面与音乐页面逻辑相似，但提供 “新建 MD” 按钮，可快速新建文件夹。

双击文件可进入对应渲染视图，对 PPT、doc、pdf 等文件只进行渲染，不支持编辑。

在 MD 视图中，提供 “保存” 按钮或使用 “Ctrl + S” 快捷键进行保存，支持一般快捷键操作。进入 MD 视图时，音乐栏自动收起，为编辑页面最大化让步，用户可自行展开，左上角提供返回目录的按钮。

md文档里粘贴图片：1.没设置picgo 保存本地 2.设置picgo 自动上传

（五）设置页面
采用两栏视图，左栏显示大类系统设置，右栏显示具体设置选项。

1. 通用设置
开机自启：可设置应用是否在开机时自动启动，由客户端实现。

下载目录：用户可自行修改下载目录，客户端设置，与后端无关。

2. 账户与云盘
显示用户头像（可点击上传修改）、用户名、邮箱和云盘容量。

提供 “修改密码” 按钮，用户需输入当前密码、新密码和确认新密码。

提供 “恢复默认头像” 按钮，可恢复系统默认头像。

提供 “退出登录” 按钮，与系统栏的头像点击下拉框注销功能相同，删除 token 后退出登录。

3. 我的分享
显示分享记录，支持懒加载数据，默认请求 10 条数据，下拉框触发更多数据加载。

显示分享文件名、分享类型（文件夹 / 文件、有效期）、分享链接与密码、有效期和分享时间。

提供 “一键复制” 按钮，可将 “链接 & 密码” 复制到剪贴板；提供 “取消分享” 按钮。

4. 专注记录
显示专注记录，支持原子性和懒加载，默认请求 10 条数据，下拉框触发更多数据加载。

显示时间和专注时长。

5. 关于
显示应用的版本号。

三、SQL文件
CREATE DATABASE IF NOT EXISTS `liteisle_db`
    CHARACTER SET utf8mb4
    COLLATE utf8mb4_general_ci;
​
USE `liteisle_db`;
​
-- =================================================================
-- 用户核心模块 (User Core Module)
-- 作用: 管理所有与用户账户、身份、配置和游戏化激励相关的数据。
-- =================================================================
​
-- ----------------------------
-- 1. 用户表 (users)
-- 描述: 存储用户的核心账户信息、认证凭据和云盘空间配额。
-- ----------------------------
CREATE TABLE `users` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '用户唯一标识ID (主键)',
  `username` varchar(50) NOT NULL COMMENT '用户名，用于登录，全系统唯一',
  `email` varchar(100) NOT NULL COMMENT '用户邮箱，用于登录和接收通知，全系统唯一',
  `password` varchar(255) NOT NULL COMMENT '加密后的用户密码 (例如使用BCrypt)',
  `avatar` varchar(512) DEFAULT NULL COMMENT '用户头像的URL地址',
  `storage_quota` bigint DEFAULT 5368709120 COMMENT '用户总存储空间配额，单位：字节 (Bytes)，默认5GB',
  `storage_used` bigint DEFAULT 0 COMMENT '用户已使用的存储空间，单位：字节 (Bytes)，通过异步消息队列在文件操作后更新',
  `create_time` timestamp DEFAULT CURRENT_TIMESTAMP COMMENT '账户创建时间',
  `update_time` timestamp DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '账户信息最后更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_username` (`username`),
  UNIQUE KEY `uk_email` (`email`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='用户账户与基本信息表';
​
-- ----------------------------
-- 2. 用户专注记录表 (user_focus_records)
-- 描述: 记录用户的每一次专注会话。
-- ----------------------------
CREATE TABLE `user_focus_records` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '专注记录唯一ID (主键)',
  `user_id` bigint NOT NULL COMMENT '外键，关联到 users.id，标识该记录所属的用户',
  `focus_minutes` int DEFAULT 0 COMMENT '单次完整专注会话的时长（单位：分钟）',
  `create_time` timestamp DEFAULT CURRENT_TIMESTAMP COMMENT '专注完成并记录的时间点',
  PRIMARY KEY (`id`),
  KEY `idx_user_focus_time` (`user_id`, `create_time` DESC),
  CONSTRAINT `fk_focus_user` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='用户单次专注会话记录表';
​
-- ----------------------------
-- 3. 用户岛屿收集表 (user_islands)
-- 描述: 记录用户通过专注等行为解锁收集到的所有岛屿。
-- ----------------------------
CREATE TABLE `user_islands` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '收集记录的唯一ID (主键)',
  `user_id` bigint NOT NULL COMMENT '外键，关联到 users.id，标识该岛屿的拥有者',
  `island_url` varchar(255) NOT NULL COMMENT '岛屿的唯一业务代码，与后端代码中的岛屿配置相对应',
  `create_time` timestamp DEFAULT CURRENT_TIMESTAMP COMMENT '岛屿的获取时间',
  PRIMARY KEY (`id`),
  CONSTRAINT `fk_user_islands_user` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='记录用户已解锁的岛屿表';
​
​
​
-- =================================================================
-- 文件系统模块 (File System Module)
-- 作用: 管理所有与文件、文件夹相关的物理存储和逻辑结构。
-- =================================================================
​
-- ----------------------------
-- 4. 物理文件存储表 (storages)
-- 描述: 存储物理文件的唯一实体信息。通过文件哈希实现秒传和存储去重。
-- ----------------------------
CREATE TABLE `storages` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '物理存储记录ID (主键)',
  `file_hash` varchar(64) NOT NULL COMMENT '文件内容的哈希值 (SHA-256)，用于秒传功能的核心校验',
  `file_size` bigint NOT NULL COMMENT '文件大小，单位：字节 (Bytes)',
  `mime_type` varchar(100) NOT NULL COMMENT '文件的MIME类型，例如 "audio/mpeg", "application/pdf"',
  `storage_path` varchar(512) NOT NULL COMMENT '文件在对象存储服务(如R2)中的唯一路径或Key',
  `reference_count` int DEFAULT 1 COMMENT '引用计数。当计数值为0时，可由后台垃圾回收任务安全删除物理文件',
  `create_time` timestamp DEFAULT CURRENT_TIMESTAMP COMMENT '该物理文件首次被上传到系统的时间',
  `update_time` timestamp DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '记录的最后更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_file_hash` (`file_hash`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='存储唯一文件实体，实现秒传功能';
​
-- ----------------------------
-- 5. 文件夹表 (folders)
-- 描述: 存储用户可见的逻辑文件夹结构。
-- ----------------------------
CREATE TABLE `folders` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '文件夹唯一ID (主键)',
  `user_id` bigint NOT NULL COMMENT '外键，关联到 users.id，标识此文件夹的拥有者',
  `parent_id` bigint DEFAULT 0 COMMENT '父文件夹ID。值为0表示根目录下的文件夹',
  `folder_name` varchar(255) NOT NULL COMMENT '文件夹在UI上显示的名称',
  `folder_type` enum('system', 'playlist', 'booklist') NOT NULL COMMENT '只有 system, playlist, booklist 三类。',
  `sorted_order` decimal(30, 10) DEFAULT 0 COMMENT '用于用户自定义排序的浮点数值',
  `delete_time` timestamp NULL DEFAULT NULL COMMENT '软删除标记。非NULL表示已移入回收站',
  `create_time` timestamp DEFAULT CURRENT_TIMESTAMP COMMENT '文件夹创建时间',
  `update_time` timestamp DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '文件夹最后更新时间（如重命名）',
  PRIMARY KEY (`id`),
  KEY `idx_user_parent` (`user_id`, `parent_id`),
  CONSTRAINT `fk_folders_user` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='用户逻辑文件夹结构表';
​
-- ----------------------------
-- 6. 文件基础信息表 (files)
-- 描述: 存储所有文件的通用基础信息，作为文件实体的核心。
-- ----------------------------
CREATE TABLE `files` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '文件唯一ID (主键)',
  `user_id` bigint NOT NULL COMMENT '外键，关联到 users.id，标识此文件的拥有者',
  `folder_id` bigint NOT NULL COMMENT '外键，关联到 folders.id，标识文件所在的文件夹',
  `storage_id` bigint DEFAULT NULL COMMENT '外键，关联到 storages.id，文件处理成功后填充',
  `file_name` varchar(255) NOT NULL COMMENT '文件名（通常包含扩展名）',
  `file_extension` varchar(20) DEFAULT NULL COMMENT '文件扩展名，如 "mp3", "pdf", 用于前端显示',
  `file_type` enum('music', 'document') NOT NULL COMMENT '文件的业务大类，用于甄别应关联哪个元数据表',
  `file_status` enum('processing', 'available', 'failed') NOT NULL DEFAULT 'processing' COMMENT '文件状态。processing:后台处理中; available:完全可用; failed:处理失败',
  `sorted_order` decimal(30, 10) DEFAULT 0 COMMENT '用于用户自定义排序的浮点数值',
  `delete_time` timestamp NULL DEFAULT NULL COMMENT '软删除标记。非NULL表示已移入回收站',
  `create_time` timestamp DEFAULT CURRENT_TIMESTAMP COMMENT '文件逻辑记录的创建时间',
  `update_time` timestamp DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '文件元数据的最后更新时间',
  PRIMARY KEY (`id`),
  KEY `idx_user_folder_status` (`user_id`, `folder_id`, `file_status`),
  CONSTRAINT `fk_files_user` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE,
  CONSTRAINT `fk_files_folder` FOREIGN KEY (`folder_id`) REFERENCES `folders` (`id`) ON DELETE CASCADE,
  CONSTRAINT `fk_files_storage` FOREIGN KEY (`storage_id`) REFERENCES `storages` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='文件通用基础信息表';
​
-- ----------------------------
-- 7. 音乐文件元数据表 (music_metadata)
-- 描述: 存储音乐文件专属的元数据。
-- ----------------------------
CREATE TABLE `music_metadata` (
  `file_id` bigint NOT NULL COMMENT '主键，同时也是外键，关联到 files.id',
  `artist` varchar(255) DEFAULT NULL COMMENT '歌手名，由后台FFmpeg等工具解析填充',
  `album` varchar(255) DEFAULT NULL COMMENT '专辑名',
  `duration` int NOT NULL COMMENT '时长，单位：秒',
  CONSTRAINT `fk_music_file` FOREIGN KEY (`file_id`) REFERENCES `files` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='音乐文件专属元数据表';
​
-- ----------------------------
-- 8. 文档文件元数据表 (document_metadata)
-- 描述: 存储文档文件专属的元数据。
-- ----------------------------
CREATE TABLE `document_metadata` (
  `file_id` bigint NOT NULL COMMENT '主键，同时也是外键，关联到 files.id',
  `content` longtext COMMENT 'Markdown文件的纯文本内容，用于全文搜索',
  `version` bigint NOT NULL DEFAULT 1 COMMENT '用于Markdown文件的乐观锁版本号',
  PRIMARY KEY (`file_id`),
  CONSTRAINT `fk_document_file` FOREIGN KEY (`file_id`) REFERENCES `files` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='文档文件专属元数据表';
​
-- =================================================================
-- 分享与传输模块 (Sharing & Transfer Module)
-- 作用: 管理所有与文件分享、上传下载任务相关的业务数据和日志。
-- =================================================================
​
-- ----------------------------
-- 9. 分享表 (share_links)
-- 描述: 管理用户创建的所有公开分享链接。
-- ----------------------------
CREATE TABLE `share_links` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '分享记录唯一ID (主键)',
  `owner_id` bigint NOT NULL COMMENT '外键，关联到 users.id，标识分享的创建者',
  `share_token` varchar(64) NOT NULL COMMENT '分享链接的唯一公开凭证，是URL的一部分',
  `share_password` varchar(255) DEFAULT NULL COMMENT '加密后的分享提取码（如果分享是加密的）',
  `file_id` bigint DEFAULT NULL COMMENT '外键，关联到 files.id，当分享目标是单个文件时填充',
  `folder_id` bigint DEFAULT NULL COMMENT '外键，关联到 folders.id，当分享目标是文件夹时填充',
  `expire_time` timestamp NULL DEFAULT NULL COMMENT '分享链接的过期时间，NULL表示永久有效',
  `create_time` timestamp DEFAULT CURRENT_TIMESTAMP COMMENT '分享创建时间',
  `update_time` timestamp DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '分享信息更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_share_token` (`share_token`),
  CONSTRAINT `fk_share_user` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE,
  CONSTRAINT `chk_share_target` CHECK ((`file_id` IS NOT NULL AND `folder_id` IS NULL) OR (`file_id` IS NULL AND `folder_id` IS NOT NULL))
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='管理公开分享链接';
​
-- ----------------------------
-- 10. 传输日志表 (transfer_log)
-- 描述: 记录每一次上传和下载操作，为“传输列表”页面提供数据。
-- ----------------------------
CREATE TABLE `transfer_log` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '传输日志唯一ID (主键)',
  `user_id` bigint NOT NULL COMMENT '外键，关联到 users.id，标识操作用户',
  `transfer_type` enum('upload', 'download') NOT NULL COMMENT '传输类型：上传或下载',
  `file_id` bigint DEFAULT NULL COMMENT '外键，关联到 files.id (如果传输对象是单个文件)',
  `folder_id` bigint DEFAULT NULL COMMENT '外键，关联到 folders.id (如果传输对象是文件夹)',
  `item_name` varchar(255) NOT NULL COMMENT '被传输项目（文件/文件夹）的名称，做冗余以备查询',
  `item_size` bigint NOT NULL COMMENT '被传输项目的总大小，单位：字节 (Bytes)',
  `log_status` enum('processing','paused', 'success', 'failed', 'canceled') NOT NULL DEFAULT 'processing' COMMENT '传输行为状态: 处理中, 暂停，成功, 失败, 已取消',
  `error_message` varchar(512) DEFAULT NULL COMMENT '当status为failed或canceled时，记录相关信息',
  `transfer_duration_ms` bigint DEFAULT NULL COMMENT '传输总耗时，单位：毫秒 (ms)',
  `client_ip` varchar(45) DEFAULT NULL COMMENT '发起传输的客户端IP地址，用于安全审计',
  `delete_time` timestamp NULL DEFAULT NULL COMMENT '软删除标记，非NULL表示已对用户隐藏',
  `create_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '传输任务创建时间',
  `update_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '传输任务状态的最后更新时间',
  PRIMARY KEY (`id`),
  KEY `idx_user_status_time` (`user_id`, `log_status`, `create_time` DESC),
  CONSTRAINT `fk_tlog_user` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE,
  CONSTRAINT `fk_tlog_file` FOREIGN KEY (`file_id`) REFERENCES `files` (`id`) ON DELETE SET NULL,
  CONSTRAINT `fk_tlog_folder` FOREIGN KEY (`folder_id`) REFERENCES `folders` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='文件上传下载行为日志表';
API文档
1. 通用规范
1.1. 基础 URL
所有API的根路径为 https://api.liteisle.com/v1 (示例)。

1.2. JSON 命名规范
API 层面: 所有通过 API 传输的 JSON 对象的键（key）均采用蛇形命名法 (snake_case)。

后端实现: 后端 Spring Boot 应用通过 Jackson 配置，自动将 API 接口的 snake_case 与 Java 代码中的 camelCase 进行转换，后端开发者在代码中应使用驼峰命名法。

1.3. 统一响应格式
所有API在成功或失败时均返回以下结构的JSON对象。

{
  "code": 200,
  "message": "操作成功",
  "data": {}
}
字段	类型	描述
code	Integer	业务状态码。200: 成功, 202: 已接收(用于异步), 400: 客户端错误, 401: 未认证, 403: 无权限, 500: 服务器内部错误。
message	String	对操作结果的文字描述，用于调试或前端提示。
data	Object / Array / null	接口返回的核心业务数据。
通用成功响应示例

当接口没有特定业务数据返回时（如删除、更新操作），data 字段为 null。

{
  "code": 200,
  "message": "操作成功",
  "data": null
}
1.4. 实时通信 (WebSocket)
本应用采用 WebSocket 进行实时双向通信，以提供即时的数据更新和通知。

连接端点: WS /ws

消息格式:

{ 
    "event": "event_name", 
    "payload": { ... } 
}
核心服务端推送事件 (S2C - Server to Client):

file.status.updated: 文件后台处理状态更新。当文件从 processing 变为 available 时推送。

transfer.log.updated: 传输日志状态更新。

notification.new: 新通知。

1.5 项目要点
桌面端应用，使用electron打包。

涉及到下载、上传都会在传输页面创建任务。

ShareLinks 和 取消上传任务都是硬删除。

md文件不占用户空间 md里的图片保存在客户端

2. 认证 (Authentication)
2.1. 用户登录
POST /auth/login

描述: 用户通过用户名和密码进行登录，成功后返回用户信息和Token。

请求体: @RequestBody AuthLoginReq

{
  "username": "john_doe",
  "password": "your_strong_password"
}
响应: AuthInfoResp

{
  "code": 200,
  "message": "登录成功",
  "data": {
    "username": "john_doe",
    "email": "john@example.com",
    "avatar": "https://r2.liteisle.com/pictures/default.png",
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c"
  }
}
2.2. 用户注册
POST /auth/register

描述: 用户注册新账号，注册成功后即为登录状态。

请求体: @RequestBody AuthRegisterReq

{
  "username": "new_user",
  "email": "new_user@example.com",
  "password": "your_strong_password",
  "vcode": "123456"
}
响应: AuthInfoResp (与登录成功响应结构相同)

{
  "code": 200,
  "message": "注册成功",
  "data": {
    "username": "new_user",
    "email": "new_user@example.com",
    "picture": "https://r2.liteisle.com/pictures/default.png",
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6Ik5ldyBVc2VyIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c"
  }
}
2.3. 发送验证码
POST /auth/send-vcode

描述: 向指定邮箱发送验证码，用于注册或忘记密码。

查询参数:

参数	类型	是否必须	描述
email	String	是	接收验证码的邮箱地址。
响应:

{
  "code": 200,
  "message": "验证码已发送，请注意查收",
  "data": null
}
2.4. 忘记密码
POST /auth/forgot-password

描述: 用户通过邮箱验证码重置密码。

请求体: @RequestBody AuthForgotPasswordReq

{
  "username": "john_doe",
  "email": "john@example.com",
  "vcode": "123456",
  "new_password": "new_secure_password",
  "confirm_password": "new_secure_password"
}
响应:

{
  "code": 200,
  "message": "密码重置成功",
  "data": null
}
2.5. 获取当前用户信息
GET /auth/me

描述: 获取当前登录用户的信息，用于“设置”页面展示。

响应: AuthCurrentUserResp

{
  "code": 200,
  "message": "获取用户信息成功",
  "data": {
    "username": "john_doe",
    "email": "john@example.com",
    "avatar": "https://r2.liteisle.com/pictures/12345.jpg",
    "storage_used": 2147483648,
    "storage_quota": 5368709120
  }
}
备注: storage_used 和 storage_quota 单位为字节 (bytes)。

2.6. 修改当前用户密码
POST /auth/me/reset-password

描述: 登录状态下，用户通过旧密码修改新密码。

请求体: @RequestBody AuthResetPasswordReq

{
  "old_password": "your_strong_password",
  "new_password": "new_secure_password",
  "confirm_password": "new_secure_password"
}
响应:

{
  "code": 200,
  "message": "密码修改成功",
  "data": null
}
2.7. 上传当前用户头像
POST /auth/me/picture

描述: 上传并更新当前用户的头像。

请求体: multipart/form-data

字段名	类型	描述
file	File	用户选择的头像图片文件。
响应: 

{
  "code": 200,
  "message": "头像上传成功",
  "data": "https://r2.liteisle.com/pictures/67890.jpg"
}
2.8. 重置当前用户头像
PUT /auth/me/reset-picture

描述: 将当前用户的头像重置为系统默认头像。

请求体: 无

响应: 

{
  "code": 200,
  "message": "头像已重置",
  "data": "https://r2.liteisle.com/pictures/default.png"
}
2.9. 退出登录
POST /auth/logout

描述: 后端清除用户认证凭证。前端应配合删除本地存储的Token。

请求体: 无

响应:

{
  "code": 200,
  "message": "已成功退出登录",
  "data": null
}
3. 文件与文件夹 (File & Folder)
3.1. 获取指定文件夹内容
GET /folders/{folder_id}

描述: 获取指定文件夹下的所有文件夹和文件列表。这是云盘主界面的核心接口。

路径参数:

参数	类型	描述
folder_id	Long	文件夹ID。特别地，0 代表根目录。
查询参数:

参数	类型	是否必须	描述
sort_by	String	否	排序字段，可选值: name, file_size, create_time, update_time, sorted_order (默认)
sort_order	String	否	排序选项，可选ASC,DEC默认DEC
content	String	否	匹配文件/文件夹名字字段
响应: FolderContentResp

{
  "code": 200,
  "message": "获取列表成功",
  "data": {
      "breadcrumb": [
    { 
        "id": 1, 
        "name": "文档" 
    }
    ],
    "folders": [
      {
        "id": 101,
        "folder_name": "我的文档",
        "folder_type": "booklist",//枚举 FolderTypeEnum
        "sub_count": 3,
        "sorted_order": 1704186000000.123124124124,
        "create_time": "2024-01-02T09:00:00Z",
        "update_time": "2024-01-02T10:30:00Z"
      }
    ],
    "files": [
      {
        "id": 201,
        "file_name": "项目报告.pdf",
        "file_type": "document",//枚举 FileTypeEnum
        "file_size": 2097152,
        "file_status": "available",//枚举 FileStatusEnum
        "sorted_order": 1704186000321000.123124124124,
        "create_time": "2024-01-02T09:00:00Z",
        "update_time": "2024-01-02T09:00:00Z"
      },
      {
        "id": 202,
        "file_name": "临时录音.mp3",
        "file_type": "music",
        "file_size": 0,
        "file_status": "processing",
        "sorted_order": 1704186002140000.123124124124,
        "create_time": "2024-01-02T09:10:00Z",
        "update_time": "2024-01-02T09:10:00Z"
      }
    ]
  }
}
备注:

folder_type: 枚举 system(系统), playlist(歌单), booklist(笔记本)。

file_type: 枚举 music, document 等。

status: 文件状态，available (可用), processing (处理中)。前端应根据此状态显示不同UI。

sub_item_count: 文件夹下子项目的数量（文件+文件夹）。

WebSocket 交互: 当 status 为 processing 的文件处理完成时，服务器将通过WebSocket推送 file.status.updated 事件，前端应监听此事件并更新对应文件的UI，无需重新拉取整个列表。

3.2. 创建文件夹
POST /folders

描述: 在指定的父文件夹下创建新文件夹。

请求体: @RequestBody FolderCreateReq

{
  "name": "新建文件夹",
  "parent_id": 101,
  "folder_type": "playlist" // 明确指定类型 FolderTypeEnum
}
注意: parent_id 不能为 0，根目录下不允许用户直接创建文件夹，系统文件夹由系统管理。

响应: 

{
  "code": 200,
  "message": "文件夹创建成功",
  "data": null
}
3.3. 重命名项目 (文件/文件夹)
PUT /items/rename

描述:
重命名一个指定类型（文件或文件夹）的项目。

请求体: @RequestBody ItemsRenameReq

{
  //前端发送id
  "file_id": null,
  "folder_id": 3,
  "new_name": "新的项目名称.mp3" 
}
响应:

{
  "code": 200,
  "message": "重命名成功",
  "data": null
}
3.4. 移动项目 (文件/文件夹)
PUT /items/move

描述: 将一个或多个文件/文件夹移动到新的目标文件夹。

请求体: @RequestBody ItemsOperationReq

{
  "file_ids": [201],
  "folder_ids": [102],
  "target_folder_id": 3
}
响应:

{
  "code": 200,
  "message": "移动成功",
  "data": null
}
3.5. 删除项目 (移入回收站)
DELETE /items

描述: 将一个或多个文件/文件夹移入回收站（软删除 不影响用户额度）。

请求体: @RequestBody ItemsDeleteReq 

{
  "file_ids": [201],
  "folder_ids": [102]
}
响应:

{
  "code": 200,
  "message": "已将 2 个项目移入回收站",
  "data": null
}
3.6. 获取项目详情 (文件/文件夹)
GET /items/{item_id}/detail

描述: 获取单个文件或文件夹的详细信息。

路径参数:

参数	类型	描述
item_id	Long	文件或文件夹的 ID。
请求参数:

参数	类型	描述
item_type	String	file或者folder
响应: ItemDetailResp (返回统一结构，通过 item_type 区分)

{
  "code": 200,
  "message": "获取详情成功",
  "data": {
    "id": 201,
    "name": "项目报告.pdf",
    "item_type": "file", // "file" 或 "folder" ItemType枚举类
    "size": 2097152, // 文件夹此项为 0 或其内容个数
    "path": "/我的文档/项目报告.pdf",
    "create_time": "2024-01-02T09:00:00Z",
    "update_time": "2024-01-02T09:00:00Z"
  }
}
3.7. 获取所有文件夹层级 (用于移动对话框)
GET /folders/hierarchy

描述: 获取用户所有文件夹的树状层级结构，用于“移动到...”功能的对话框。

响应: List<FolderHierarchyResp>

{
  "code": 200,
  "message": "获取文件夹层级成功",
  "data": [
    {
      "id": 1,
      "folder_name": "音乐",
      "folder_type": "system", //FolderTypeEnum
      "parent_id": 0
    },
    {
      "id": 3,
      "folder_name": "我喜欢的音乐",
      "folder_type": "playlist",
      "parent_id": 1
    },
    {
      "id": 101,
      "folder_name": "我的文档",
      "folder_type": "booklist",
      "parent_id": 0
    }
  ]
}
备注: parent_id 为 0 代表根目录下的文件夹。

3.8. 复制项目 (文件/文件夹)
POST /items/copy

描述: 将一个或多个文件/文件夹复制到新的目标文件夹（影响用户额度）。

请求体: @RequestBody ItemsOperationReq

{
  "file_ids": [201],
  "folder_ids": [102],
  "target_folder_id": 3
}
响应:

{
  "code": 200,
  "message": "复制成功",
  "data": null
}
3.9. 自定义排序 (文件/文件夹)
PUT /items/{item_id}/set-order 

描述: 在特定视图（如音乐页面、文档页面）中拖拽项目（歌曲、文档、歌单、笔记本）进行排序。

请求参数:

参数	类型	描述
item_type	String	file或者folder
路径参数:

参数	类型	描述
item_id	Long	要移动的文件或文件夹的 ID。
请求体: @RequestBody SetOrderReq

{
  // 提供被移动到的位置，其前一个和后一个项目的sorted_order值
  // 如果移到最前，after_order为null；如果移到最后，before_order为null
  "before_id": 3,
  "after_id": 6
}
响应:

{
  "code": 200,
  "message": "排序已更新",
  "data": null
}
4. 文件上传与下载
4.1. 上传文件 (异步处理)
POST /upload

说明: 如果folder_id为0则是为传输页面的上传任务，后端自动获取当前用户的上传系统文件夹id存入

描述: 接收文件并立即返回，将耗时的文件处理（如元数据提取）交由后台异步完成。.md 文档将直接存储文本内容到数据库，无需上传到对象存储（影响用户额度）。

请求体: multipart/form-data

字段名	类型	是否必须	描述
file	File	是	要上传的文件。
请求参数

字段名	类型	是否必须	描述
folder_id	Long	是	用户自定义要上传到的文件夹id。
响应 (快速返回): FileUploadAsyncResp

{
  "code": 202,
  "message": "文件已接收，正在后台处理",
  "data": {
    "log_id": 123, // ✨ 新增
    "file_id": 203,
    "log_status": "processing",//枚举 log状态TransferStatusEnum
    "initial_file_data": {
        "id": 203,
        "name": "晴天.mp3",
        "file_type": "music",//枚举 文件类型 
        "file_status": "processing",  //
        "sorted_order": 1704186900000.19712414,
        "create_time": "2024-01-02T09:15:00Z",
        "update_time": "2024-01-02T09:15:00Z"
    }
  }
}
流程说明:

前端收到此 202 Accepted 响应后，应立即使用 initial_file_data 在UI中渲染出文件条目，并显示为“处理中”状态。

后端Worker处理完毕后，会通过 WebSocket 推送一个 file.status.updated 事件。

前端监听此事件，根据 file_id 找到对应的UI元素，并使用事件 payload 中的完整数据更新该文件，将其状态更新为 available。

后端职责说明:
服务器在文件处理完毕后（如元数据提取完成），应自动更新关联的传输日志(transfer_log)状态从 processing 到 success 或 failed。前端无需再次调用接口来更新上传任务的状态。状态变更会通过 WebSocket (transfer.log.updated) 推送给客户端。

4.2. 下载文件 (全新简化流程)
POST /download/create

注意：下载根目录文件夹如歌单，需要前端提供多个子文件夹，后端实现：一级文件夹/二级文件如：歌单/我喜欢的 以及 歌单/我喜欢的/东风破.mp3 

描述: 所有下载到本地操作的唯一入口。客户端提交要下载的项目，后端负责：

递归解析所有文件。

为每个下载任务自动创建传输日志记录。

为每个文件生成带签名的下载URL。

将包含所有必要信息的完整清单一次性返回给客户端。

请求体: @RequestBody ItemsSelectionReq

// 下载单个文件、多个文件、一个文件夹
// 例：前端框选 文件夹3、文件夹4、文件6，触发三次请求分别为文件夹3、文件夹4、文件6.
//  如果前端选择 文件456则触发一次请求
{
  "file_ids": [201, 202, 203],
  "folder_id": null  // 单个文件夹ID
}
响应: DownloadSessionResp

{
  "code": 200,
  "message": "下载会话创建成功",
  "data": {
    "total_size": 31457280,
    "total_files": 5,
    "folder_d": {
        "folder_id": 3,
        "folder_name": "文档",
        "relative_path": "我的项目/文档" 
    },
    "files_d": [
      {
        "log_id": 123, // ✨ 后端创建的日志ID
        "file_id": 202,
        "file_name": "会议记录.docx",
        "relative_path": "我的项目/文档/会议记录.docx",
        "size": 20480,
        "download_url": "https://r2.liteisle.com/downloads/a1b2...?token=..." // ✨ 直接返回URL
      },
      {
        "log_id": 124,
        "file_id": 201,
        "file_name": "封面图.pdf",
        "relative_path": "我的项目/文档/封面图.pdf",
        "size": 512000,
        "download_url": "https://r2.liteisle.com/downloads/b2c3...?token=..."
      }
      // ...更多文件
    ]
  }
}
{
  "code": 200,
  "message": "下载会话创建成功",
  "data": {
    "total_size": 512000,
    "total_files": 1,
    "folder_d": null,  // 单个文件下载时无文件夹信息
    "files_d": [
      {
        "log_id": 124,
        "file_id": 201,
        "relative_path": "封面图.jpg",  // 无父文件夹，直接为文件名
        "size": 512000,
        "download_url": "https://r2.liteisle.com/downloads/b2c3...?token=..."
      }
    ]
  }
}
前端请求：分为单个文件夹/文件请求。

执行下载：客户端收到 DownloadSessionResp 后，遍历 items 数组。

如果 type 是 directory，则在本地创建对应目录。

如果 type 是 file，则使用提供的 download_url 下载文件到 relative_path。

更新状态：在每个文件下载结束时（成功、失败、取消），客户端调用 PUT /transfers/{log_id}/status (见 5.5 节) 来更新该任务的最终状态。

5. 传输管理 (Transfer Management)
5.1. 获取传输任务摘要
GET /transfers/summary

描述: 获取正在进行中的上传和下载任务总数，用于侧边栏角标显示。

响应: TransferSummaryResp

{
  "code": 200,
  "message": "获取摘要成功",
  "data": {
    "upload_count": 2,
    "download_count": 1
  }
}
5.2. 获取传输历史记录
GET /transfers

描述: 分页获取传输记录，用于“传输列表”页面。

查询参数:

参数	类型	是否必须	描述
status	String	是	processing: 进行中, completed: 已完成(含成功和失败)对应两个页面（进行中和已完成）。
page	Integer	否	页码，默认 1。
size	Integer	否	每页数量，默认 20。
响应: TransferLogPageResp

{
  "code": 200,
  "message": "获取传输记录成功",
  "data": {
    "total": 25,
    "current_page": 1,
    "page_size": 20,
    "records": [
      {
        "log_id": 1,
        "item_name": "项目报告.pdf",
        "item_size": 2097152,
        "transfer_type": "upload", //TransferTypeEnum
        "create_time": "2024-07-25T10:00:00Z"
      },
      {
        "log_id": 2,
        "item_name": "晴天.mp3",
        "item_size": 5242880,
        "transfer_type": "upload",//TransferTypeEnum
        "create_time": "2024-07-25T09:55:00Z"
      }
    ]
  }
}
5.3. 删除已完成的单条传输记录
DELETE /transfers/{log_id}

描述: 从传输列表中删除一条记录（如果选择删除文件也是软删除 不影响用户额度）。

路径参数:

参数	类型	描述
log_id	Long	要删除的传输记录ID。
查询参数:

参数	类型	是否必须	描述
delete_file	Boolean	否	是否同时将关联的文件移入回收站。默认为 false。
响应:

{
  "code": 200,
  "message": "传输记录已删除",
  "data": null
}
5.4. 清空已完成的传输记录
DELETE /transfers/completed

描述: 清空所有已完成（成功或失败）的传输记录。此操作仅删除日志，不影响实际文件（可选）。注意对于下载记录只删除记录（如果选择删除文件也是软删除 不影响用户额度）。

查询参数:

参数	类型	是否必须	描述
delete_file	Boolean	否	是否同时将关联的文件移入回收站。默认为 false。
响应:

{
  "code": 200,
  "message": "已清空23条已完成的记录",
  "data": null
}
！5.5. 取消上传任务
POST /transfers/upload/{log_id}/cancel

描述: 取消一个正在进行的上传任务。此操作会中断文件传输，并清理服务器上已接收的该文件的临时数据（恢复用户额度）。

路径参数:

参数	类型	描述
log_id	Long	要取消的上传任务的传输日志ID。这个ID在调用POST /upload或POST /shares/save时，可以随initial_file_data一起返回，或者通过查询传输列表GET /transfers获取。
响应:

{
  "code": 200,
  "message": "上传任务已取消",
  "data": null
}
5.6. 更新下载任务状态 (职责明确)
PUT /transfers/{log_id}/status

描述: 由客户端在下载任务结束（成功、失败、取消）后，或任何由客户端发起的取消操作后调用，以更新其在后端的日志状态。

路径参数:

参数	类型	描述
log_id	Long	要更新的日志ID。
请求体: @RequestBody TransferStatusUpdateReq

{
  "log_status": "success", // "success", "failed", "canceled"
  "error_message": null,
  "transfer_duration_ms": 15000
}
响应:

{ 
    "code": 200, 
    "message": "状态更新成功", 
    "data": null 
}
6. 特定视图 (Special Views)
此部分API专为特定的前端视图（如音乐播放器、文档管理器）提供聚合数据，以优化性能和简化前端逻辑。

6.1. 音乐视图 (Music View)
6.1.1. 获取音乐页面信息
GET /music

描述: 获取音乐页面所需的所有数据，包括所有播放列表（Playlist）和对应播放列表的音乐文件。此接口用于页面初始化，前端可将数据存入状态管理库（Store）。

查询参数:

参数	类型	是否必须	描述
content	String	否	搜索关键词。如果提供，将返回与关键词匹配的播放列表和歌曲。
响应: MusicViewResp

{
  "code": 200,
  "message": "获取音乐列表成功",
  "data": {
    "playlists": [
      {
        "id": 101,
        "name": "我喜欢的音乐",
        "folder_type": "playlist",//enum
        "sorted_order": 1704186000000,
        "sub_count": 2
      }
    ],
    "files": [
      {
        "id": 205,
        "folder_id": 101,
        "file_name": "晴天.mp3",
        "file_type": "music",//enum
        "sorted_order": 1704186100000,
        "artist": "周杰伦",
        "album": "叶惠美",
        "duration": 269,
        "cover_art_url": "https://r2.liteisle.com/covers/yehuimei.jpg"
      },
      {
        "id": 206,
        "folder_id": 101,
        "file_name": "稻香.mp3",
        "file_type": "music",
        "sorted_order": 1704186200000,
        "artist": "周杰伦",
        "album": "魔杰座",
        "duration": 223,
        "cover_art_url": "https://r2.liteisle.com/covers/mojiezuo.jpg"
      }
    ]
  }
}
备注: duration 单位为秒 (seconds)。

6.1.2. 获取音乐播放链接
GET /music/{file_id}/play

描述: 获取指定音乐文件的临时、安全的播放流链接。

路径参数:

参数	类型	描述
file_id	Long	音乐文件的ID。
响应: 

{
  "code": 200,
  "message": "获取音乐链接成功",
  "data": "https://r2.liteisle.com/music/asdqwd.mp3?token=..."
}
6.2. 文档视图 (Document View)
6.2.1. 获取文档页面信息
GET /documents

描述: 获取文档页面所需的所有数据，包括所有笔记本（booklist）和所有文档文件。

查询参数:

参数	类型	是否必须	描述
content	String	否	搜索关键词。如果提供，将返回与关键词匹配的笔记本和文档。
响应: DocumentViewResp

{
  "code": 200,
  "message": "获取文档列表成功",
  "data": {
    "booklists": [
      {
        "id": 301,
        "folder_name": "会议纪要",
        "folder_type": "booklist",//enum
        "sorted_order": 1704187000000.83278441,
        "sub_count": 1
      }
    ],
    "files": [
      {
        "id": 401,
        "folder_id": 301,
        "file_name": "3-18周会.md",
        "file_type": "document",//enum
        "sorted_order": 1704187100000.8712367812412
      },
      {
        "id": 402,
        "folder_id": 301,
        "file_name": "产品需求文档.pdf",
        "file_type": "document",
        "sorted_order": 170134187200000.123124
      }
    ]
  }
}
6.2.2. 获取非 MD 文档预览/下载链接
GET /documents/{file_id}/view

描述: 获取非 Markdown 文档（如 PDF, DOCX）的预览或下载链接。

路径参数:

参数	类型	描述
file_id	Long	文档文件的ID
响应: 

{
  "code": 200,
  "message": "获取文档链接成功",
  "data": "https://r2.liteisle.com/docs/asdqwd.pdf?token=..."
}
6.2.3. 获取 MD 文档内容
GET /documents/md/{file_id}

描述: 获取指定 Markdown 文件的原始内容，用于在线编辑器加载。

路径参数:

参数	类型	描述
file_id	Long	Markdown 文件的ID。
响应: MarkdownContentResp

{
  "code": 200,
  "message": "获取Markdown文档成功",
  "data": {
    "content": "# 周会纪要\n\n- 讨论了Q2季度目标。\n- 分配了新功能开发任务。",
    "version": 5 // 版本号
  }
}
6.2.4. 更新并保存 MD 文档
PUT /documents/md/{file_id}

描述: 更新并保存在线编辑器中修改后的 Markdown 文档内容（md文件不影响用户额度）。

路径参数:

参数	类型	描述
file_id	Long	要保存的 Markdown 文件的ID。
请求体: @RequestBody MarkdownUpdateReq

{
    "content": "# 周会纪要 (更新)\n\n- 讨论了Q2季度目标。\n- 分配了新功能开发任务。\n- **补充：** 下周三进行演示。",
    "version": 5 // ✨ 前端从GET请求中获取并回传的版本号
}
响应:

{
  "code": 200,
  "message": "文档保存成功",
  "data": null
}
6.2.5. 新建 MD 文档
POST /documents/md

描述: 在指定的笔记本下创建一个新的、空的 Markdown 文档（md文件不影响用户额度）。

请求体: @RequestBody MarkdownCreateReq

{
  "name": "未命名文档.md",
  "folder_id": 301 // 要放入的笔记本ID
}
响应:

{
  "code": 200,
  "message": "文档新建成功",
  "data": 31
}
备注: 返回参数为新创建文档的id。

7. 回收站 (Recycle Bin)
7.1. 获取回收站内容
GET /recycle-bin

描述: 获取当前用户回收站中的所有文件和文件夹。

请求参数：

参数	类型	描述
content	String	字段
响应: RecycleBinContentResp

{
  "code": 200,
  "message": "获取回收站列表成功",
  "data": {
    "folders": [
      {
        "original_id": 102,
        "original_name": "旧项目",
        "original_type": "playlist", //FolderTypeEnum
        "sub_count": 3,
        "delete_time": "2024-07-20T11:00:00Z",
        "expire_time": "2024-08-19T11:00:00Z"
      }
    ],
    "files": [
      {
        "original_id": 208,
        "original_name": "草稿.txt",
        "original_type": "document", //FileTypeEnum
        "file_size": 1024,
        "delete_time": "2024-07-21T15:30:00Z",
        "expire_time": "2024-08-20T15:30:00Z"
      }
    ]
  }
}
备注: expire_time 表示项目将被系统自动永久删除的时间。

7.2. 还原项目
POST /recycle-bin/restore

描述: 将回收站中的一个或多个项目还原到其原始位置（不影响用户额度）。

请求体: @RequestBody RecycleBinReq

{
  "file_ids": [208],
  "folder_ids": [102]
}
备注: 请求体中明确区分 file_ids 和 folder_ids 数组，两者至少提供一个。

响应:

{
  "code": 200,
  "message": "已成功还原 2 个项目",
  "data": null
}
7.3. 彻底删除项目
DELETE /recycle-bin/items

描述: 从回收站中永久删除一个或多个项目。此操作不可恢复（恢复用户额度）。

请求体: @RequestBody RecycleBinReq

{
  "file_ids": [208],
  "folder_ids": [102]
}
响应:

{
  "code": 200,
  "message": "已彻底删除 2 个项目",
  "data": null
}
7.4. 清空回收站
DELETE /recycle-bin/all

描述: 永久删除回收站中的所有项目。此操作不可恢复（恢复用户额度）。

响应:

{
  "code": 200,
  "message": "回收站已清空",
  "data": null
}
8. 分享 (Share)
8.1. 创建分享链接
POST /shares

描述: 为指定的文件或文件夹创建公开的分享链接。

请求体: @RequestBody ShareCreateReq

{
  "file_id": 201,
  "folder_id": null,
  "is_encrypted": true,
  "expires_in_days": 7 //1 7 30 永久(0)
}
字段	类型	描述
file_id	Long	(可选) 要分享的文件ID。
folder_id	Long	(可选) 要分享的文件夹ID。
is_encrypted	Boolean	是否加密。true则会生成提取码。
expires_in_days	Integer	有效期天数。0 表示永久有效。
备注:  file_id 和 folder_id 必须且只能提供一个。

响应: ShareCreateResp

{
  "code": 200,
  "message": "创建分享成功",
  "data": {
    "share_token": "a1b2c3d4e5",
    "share_password": "abcd"
  }
}
8.2. 获取我的分享记录
GET /shares/me

描述: 分页获取当前用户创建的所有分享记录。

查询参数:

参数	类型	是否必须	描述
page	Integer	否	页码，默认 1。
size	Integer	否	每页数量，默认 10。
响应: ShareRecordPageResp

{
  "code": 200,
  "message": "获取我的分享列表成功",
  "data": {
    "total": 1,
    "current_page": 1,
    "page_size": 10,
    "records": [
      {
        "id": 15,
        "file_id": 201,
        "folder_id": null,
        "share_item_name": "项目报告.pdf",
        "share_token": "a1b2c3d4e5",
        "share_password": "abcd",
        "create_time": "2024-07-25T12:00:00Z",
        "expire_time": "2024-08-01T12:00:00Z"
      }
    ]
  }
}
8.3. 取消分享
DELETE /shares/{share_id}

描述: 取消一个分享，使其链接和提取码失效。

路径参数:

参数	类型	描述
share_id	Long	分享记录的ID (来自获取分享记录列表中的 id)。
响应:

{
  "code": 200,
  "message": "分享已取消",
  "data": null
}
8.4. 验证分享信息 (用于转存前确认)
POST /shares/verify

描述: 在用户执行“转存到我的网盘”操作之前，通过 share_token 和可选的密码来验证分享链接，并获取分享项目的基本信息。这用于向用户展示一个确认界面（例如：“您要保存文件 ‘xxx.pdf’ (15MB) 吗？”）。

请求体: @RequestBody ShareVerifyReq

{
  "share_token": "a1b2c3d4e5",
  "share_password": "abcd"
}
响应: ShareInfoResp

{
  "code": 200,
  "message": "验证成功",
  "data": {
    "item_type": "file", // "file" 或 "folder" ItemType枚举类
    "item_name": "项目报告.pdf",
    "item_size": 15728640, // 如果是文件，为文件大小；如果是文件夹，为文件夹总大小
    "total_files": 1 // 如果是文件夹，为包含的文件总数
  }
}
前端流程:

用户输入分享链接，前端解析出 share_token 和 share_password。

调用本接口。

若成功，根据返回的 data 弹出确认框，并让用户选择要保存到的目标文件夹。

！8.5. 转存分享内容到我的网盘 (异步)
POST /shares/save

描述: 将一个分享链接中的所有文件异步地“复制”到当前用户的指定文件夹中。由于是服务端操作，此接口会立即返回，并在后台处理。

请求体: @RequestBody ShareSaveReq

{
  "share_token": "a1b2c3d4e5",
  "share_password": "abcd",
  "target_folder_id": 41
}
响应 (快速返回): ShareSaveAsyncResp

{
  "code": 202,
  "message": "转存任务已创建，正在后台处理 3 个文件",
  "data": {
    "total_files_to_save": 3,
    "initial_file_data_list": [ // 返回一个初始文件对象列表！
      {
        "id": 210, // 在用户文件表中为“文件A”新创建的条目ID
        "name": "文件A.pdf", 
        "file_type": "document", //FileTypeEnum
        "status": "processing", //FileStatusEnum
        "create_time": "...",
        "update_time": "..."
      },
      {
        "id": 211, // 在用户文件表中为“文件B.mp3”新创建的条目ID
        "name": "文件B.mp3",
        "file_type": "music",
        "status": "processing",
        "create_time": "...",
        "update_time": "..."
      },
      {
        "id": 212, 
        "name": "文件C.mp3",
        "file_type": "music",
        "status": "processing",
        "create_time": "...",
        "update_time": "..."
      }
    ]
  }
}
9. 专注 (Focus)
9.1. 记录专注时长
POST /focus/records

描述: 记录一次完成的专注会话。

查询参数:

参数	类型	是否必须	描述
focus_minutes	Integer	是	专注时长，整分钟
响应: 

{
  "code": 200,
  "message": "专注记录已保存，恭喜您获得新岛屿！",
  "data": "https://r2.liteisle.com/islands/island_05.png"
}
备注: 如果本次专注没有获得新岛屿，data 字段将为 null，message 也会相应变化。

9.2. 获取专注总次数
GET /focus/stats/total-count

描述: 获取用户累计的专注总次数，用于仪表盘卡片展示。

响应: 

{
  "code": 200,
  "message": "获取成功",
  "data": 32
}
9.3. 获取专注记录
GET /focus/stats/records

描述: 分页获取用户的专注历史记录。

查询参数:

参数	类型	是否必须	描述
page	Integer	否	页码，默认 1。
size	Integer	否	每页数量，默认 10。
响应: FocusStatsPageResp

{
  "code": 200,
  "message": "获取专注统计成功",
  "data": {
    "total": 32,
    "current_page": 1,
    "page_size": 10,
    "records": [
      {
        "id": 105, // 记录的ID
        "focus_minutes": 50,
        "create_time": "...."
      },
      {
        "id": 106, // 记录的ID
        "focus_minutes": 75,
        "create_time": "...."
      }
    ]
  }
}
9.4. 获取专注日历数据
GET /focus/stats/calendar

描述: 获取指定月份的专注日历数据，用于渲染类似 GitHub 的贡献图。

查询参数:

参数	类型	是否必须	描述
year	Integer	是	年份，例如 2024。
month	Integer	是	月份，例如 7。
响应: FocusCalendarResp

{
  "code": 200,
  "message": "获取专注日历成功",
  "data": {
    "year_month": "2024-7",
    "check_in_days": [1, 3, 5, 7, 24, 25],
    "total_check_in_count": 6,
    "total_focus_minutes": 480
  }
}
备注: total_focus_minutes 是当月的总专注分钟数。

10. 岛屿 (Island)
10.1. 获取用户岛屿收集情况
GET /islands/me

描述: 获取当前用户已经收集到的所有岛屿信息，用于仪表盘展示。

响应: 

{
  "code": 200,
  "message": "获取岛屿收集情况成功",
  "data": ["https://r2.liteisle.com/islands/island_01.png",
"https://r2.liteisle.com/islands/island_02.png"]
}
备注:

data 数组中可能包含重复的岛屿。

11. 实用工具 (Utilities)
此部分API提供跨模块的通用辅助功能，以增强核心用户体验。

11.1. 划词翻译
POST /translate

描述: 接收一段文本及其文档id，并返回其翻译结果。上下文的提供可以显著提升翻译的准确性和专业性。

请求体: @RequestBody TranslateReq

{
  "text": "The framework uses a stack to manage states.",
  "target_lang": "zh-CN",
  "file_name": "401.pdf"
}
字段	类型	是否必须	描述
text	String	是	用户划词选中的核心文本。
target_lang	String	否	目标语言代码 默认中文。
file_name	String	是	当前正在阅读或编辑的文件名。
响应: TranslateResp

{
  "code": 200,
  "message": "翻译成功",
  "data": {
    "original_text": "Hello, this is a sentence to be translated.",
    "translated_text": "你好，这是一个需要被翻译的句子。"
  }
}
字段	类型	描述
original_text	String	原始请求的文本，便于前端核对。
translated_text	String	翻译后的文本。
LiteIsle 前后端接口操作对应表格
概述
本文档详细记录了LiteIsle项目中所有前后端接口的操作对应关系，包括API端点、HTTP方法、功能描述、涉及的数据库表操作、业务逻辑等详细信息。

数据库表说明
核心业务表
users: 用户账户与基本信息表

folders: 用户逻辑文件夹结构表

files: 用户文件逻辑记录表

storages: 存储唯一文件实体表（实现秒传功能）

元数据表
document_metadata: 文档文件专属元数据表

music_metadata: 音乐文件专属元数据表

功能扩展表
share_links: 管理公开分享链接表

user_focus_records: 用户单次专注会话记录表

user_islands: 记录用户已解锁的岛屿表

transfer_log: 文件上传下载行为日志表

缓存存储
Redis: 签到功能Bitmap、验证码缓存、JWT token缓存

接口操作对应表格
1. 用户认证模块 (AuthController)
接口路径	HTTP方法	功能描述	数据库操作	涉及表	业务逻辑
/auth/login	POST	用户登录	查询用户信息，验证密码	users	1. 根据用户名查询用户<br>2. 验证密码<br>3. 生成JWT token<br>4. 返回用户信息和token
/auth/register	POST	用户注册	插入新用户记录，创建默认文件夹	users, folders	1. 验证邮箱格式和验证码<br>2. 检查用户名唯一性<br>3. 创建用户记录<br>4. 创建默认系统文件夹<br>5. 生成JWT token
/auth/send-vcode	POST	发送验证码	Redis缓存验证码	Redis	1. 生成6位随机验证码<br>2. 存储到Redis（5分钟过期）<br>3. 发送邮件
/auth/forgot-password	POST	忘记密码	更新用户密码	users	1. 验证用户名、邮箱、验证码<br>2. 加密新密码<br>3. 更新用户密码字段
/auth/current-user	GET	获取当前用户信息	查询用户信息	users	根据JWT token中的用户ID查询用户信息
/auth/reset-password	PUT	修改密码	更新用户密码	users	1. 验证旧密码<br>2. 加密新密码<br>3. 更新密码字段
/auth/upload-picture	POST	上传头像	更新用户头像URL	users	1. 上传图片到MinIO<br>2. 更新用户avatar字段
/auth/reset-picture	DELETE	重置头像	更新用户头像为默认值	users	将用户avatar字段设为默认头像URL
/auth/logout	POST	退出登录	Redis删除token	Redis	将JWT token加入黑名单
2. 文件夹管理模块 (ItemController)
接口路径	HTTP方法	功能描述	数据库操作	涉及表	业务逻辑
/items/folders	POST	创建文件夹	插入文件夹记录	folders	1. 验证父文件夹存在性<br>2. 验证文件夹类型兼容性<br>3. 插入新文件夹记录
/items/folders/{folder_id}	GET	获取文件夹内容	查询文件夹和文件信息	folders, files, storages	1. 异步查询文件夹信息<br>2. 异步查询文件列表<br>3. 关联存储信息获取文件大小<br>4. 支持排序和搜索
/items/folders/{folder_id}	PUT	重命名文件夹	更新文件夹名称	folders	1. 验证文件夹所有权<br>2. 更新folder_name字段
/items/folders/{folder_id}	DELETE	删除文件夹	软删除文件夹和其中文件	folders, files	1. 设置文件夹delete_time<br>2. 设置文件夹内所有文件delete_time
/items/files/{file_id}	PUT	重命名文件	更新文件名称	files	1. 验证文件所有权<br>2. 更新file_name字段
/items/files/{file_id}	DELETE	删除文件	软删除文件	files	设置文件delete_time字段
/items/set-order	POST	设置排序	更新排序字段	folders, files	1. 计算新的sorted_order值<br>2. 更新对应记录的排序字段
/items/copy	POST	复制项目	复制文件/文件夹记录	files, folders, storages, users	1. 验证复制规则<br>2. 创建新的文件/文件夹记录<br>3. 更新存储引用计数<br>4. 更新用户存储使用量
3. 音乐模块 (MusicController)
接口路径	HTTP方法	功能描述	数据库操作	涉及表	业务逻辑
/music	GET	获取音乐页面信息	查询播放列表和音乐文件	folders, files, music_metadata	1. 异步查询playlist类型文件夹<br>2. 异步查询音乐文件<br>3. 关联音乐元数据<br>4. 支持搜索功能
/music/{file_id}/play	GET	获取音乐播放URL	查询文件和存储信息	files, storages	1. 验证文件所有权<br>2. 获取存储路径<br>3. 生成预签名URL
4. 文档模块 (DocumentController)
接口路径	HTTP方法	功能描述	数据库操作	涉及表	业务逻辑
/documents	GET	获取文档页面信息	查询书单和文档文件	folders, files	1. 异步查询booklist类型文件夹<br>2. 异步查询文档文件<br>3. 支持搜索功能
/documents/{file_id}/view	GET	获取文档预览链接	查询文件和存储信息	files, storages	1. 验证文件所有权<br>2. 获取存储路径<br>3. 生成预签名URL
/documents/md	POST	创建Markdown文档	插入文件和文档元数据	files, document_metadata	1. 创建文件记录<br>2. 创建文档元数据记录<br>3. 设置初始版本号
/documents/md/{file_id}	GET	获取Markdown内容	查询文档元数据	document_metadata	根据文件ID查询Markdown内容和版本
/documents/md/{file_id}	PUT	更新Markdown内容	更新文档元数据	document_metadata	1. 验证版本号（乐观锁）<br>2. 更新内容和版本号
5. 回收站模块 (RecycleBinController)
接口路径	HTTP方法	功能描述	数据库操作	涉及表	业务逻辑
/recycle-bin	GET	获取回收站内容	查询已删除的文件和文件夹	files, folders	1. 异步查询软删除的文件<br>2. 异步查询软删除的文件夹<br>3. 支持搜索功能
/recycle-bin/restore	POST	恢复项目	清空删除时间	files, folders	1. 恢复选中的文件和文件夹<br>2. 恢复文件夹内的所有文件<br>3. 清空delete_time字段
/recycle-bin/items	DELETE	永久删除选中项目	物理删除记录，更新引用计数	files, folders, storages, users	1. 计算释放的存储空间<br>2. 物理删除文件和文件夹记录<br>3. 减少存储引用计数<br>4. 更新用户存储使用量
/recycle-bin/all	DELETE	清空回收站	物理删除所有已删除项目	files, folders, storages, users	1. 查询用户所有已删除项目<br>2. 批量物理删除<br>3. 更新存储引用计数<br>4. 更新用户存储使用量
6. 文件上传模块 (UploadController)
接口路径	HTTP方法	功能描述	数据库操作	涉及表	业务逻辑
/upload	POST	异步文件上传	插入文件和存储记录	files, storages, users, transfer_log	1. 计算文件哈希值<br>2. 检查是否已存在（秒传）<br>3. 上传到MinIO<br>4. 创建文件和存储记录<br>5. 更新用户存储使用量<br>6. 记录传输日志
7. 分享模块 (ShareController)
接口路径	HTTP方法	功能描述	数据库操作	涉及表	业务逻辑
/shares	POST	创建分享链接	插入分享记录	share_links	1. 生成唯一分享token<br>2. 加密分享密码<br>3. 创建分享记录
/shares/verify	POST	验证分享链接	查询分享信息	share_links, files, folders	1. 验证分享token<br>2. 验证分享密码<br>3. 检查过期时间<br>4. 返回分享内容
/shares/save	POST	保存分享内容	复制文件到用户空间	files, storages, users	1. 复制分享的文件<br>2. 更新存储引用计数<br>3. 更新用户存储使用量
/shares/me	GET	获取我的分享记录	查询用户分享记录	share_links, files, folders	分页查询用户创建的分享记录
/shares/{share_id}	DELETE	删除分享链接	删除分享记录	share_links	物理删除分享记录
8. 专注模块 (FocusController)
接口路径	HTTP方法	功能描述	数据库操作	涉及表	业务逻辑
/focus/records	POST	创建专注记录	插入专注记录，可能奖励岛屿	user_focus_records, user_islands, Redis	1. 创建专注记录<br>2. 执行签到逻辑（Redis Bitmap）<br>3. 执行奖励责任链<br>4. 可能获得岛屿奖励
/focus/stats/total-count	GET	获取总专注次数	查询专注记录总数	user_focus_records	统计用户专注记录总数
/focus/stats/records	GET	获取专注记录列表	分页查询专注记录	user_focus_records	分页查询用户专注记录
/focus/stats/calendar	GET	获取专注日历数据	查询月度专注数据	user_focus_records, Redis	1. 查询月度专注时长<br>2. 获取签到日期（Redis Bitmap）<br>3. 返回日历数据
9. 岛屿模块 (IslandController)
接口路径	HTTP方法	功能描述	数据库操作	涉及表	业务逻辑
/islands/me	GET	获取我的岛屿收藏	查询用户岛屿记录	user_islands	查询用户已获得的岛屿URL列表
10. 翻译模块 (TranslateController)
接口路径	HTTP方法	功能描述	数据库操作	涉及表	业务逻辑
/translate	POST	文本翻译	无数据库操作	无	调用AI服务进行文本翻译
11. 传输日志模块 (TransferController)
接口路径	HTTP方法	功能描述	数据库操作	涉及表	业务逻辑
/transfer	GET	获取传输历史记录	查询传输日志	transfer_log	分页查询用户传输记录
/transfer/summary	GET	获取传输统计摘要	统计传输数据	transfer_log	统计上传下载次数
/transfer/{log_id}/status	PUT	更新传输状态	更新传输日志状态	transfer_log	更新传输任务状态和错误信息
/transfer/{log_id}	DELETE	删除传输记录	软删除传输记录	transfer_log, files, folders	1. 软删除传输记录<br>2. 可选删除关联文件/文件夹
/transfer/completed/clean	DELETE	清空已完成传输	批量删除传输记录	transfer_log, files, folders	批量清理已完成的传输记录
/transfer/{log_id}/cancel	POST	取消上传任务	更新传输状态为取消	transfer_log	将上传任务状态设为已取消
技术架构特点
1. 数据库设计特性
软删除机制: 使用delete_time字段实现软删除，支持回收站功能

引用计数: storages表使用reference_count实现文件去重和垃圾回收

存储配额管理: users表管理用户存储空间配额和使用量

版本控制: document_metadata表实现Markdown文档的乐观锁版本控制

层级结构: folders表支持文件夹层级关系

自定义排序: 支持用户自定义文件和文件夹排序

2. 性能优化
异步处理: 使用CompletableFuture实现异步查询

批量操作: 支持批量文件复制、删除等操作

Redis缓存: 使用Redis进行验证码缓存、签到数据存储

虚拟线程池: 使用虚拟线程提高并发性能

3. 安全特性
JWT认证: 使用JWT token进行用户认证

密码加密: 使用BCrypt加密用户密码

权限验证: 所有操作都验证用户权限

预签名URL: 使用MinIO预签名URL安全访问文件

4. 业务特色
秒传功能: 基于文件哈希值实现秒传

专注奖励: 专注功能结合岛屿奖励机制

分享功能: 支持文件和文件夹的公开分享

传输日志: 详细记录文件上传下载行为

本文档涵盖了LiteIsle项目的所有前后端接口操作对应关系，为开发和维护提供了完整的参考资料。