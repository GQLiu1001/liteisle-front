# è½»å±¿è®°

## ä¸€ã€äº§å“å®šä½

è½»å±¿è®°æ˜¯ä¸€æ¬¾åŠŸèƒ½ä¸°å¯Œçš„æ¡Œé¢ç«¯åº”ç”¨ï¼Œé›†æˆäº†äº‘ç›˜ã€éŸ³ä¹æ’­æ”¾å™¨ã€Markdown ç¼–è¾‘å™¨ã€æ–‡æ¡£æŸ¥çœ‹å™¨å’Œä¸“æ³¨è®°å½•ç­‰å¤šç§åŠŸèƒ½ï¼Œä¸ºç”¨æˆ·æä¾›ä¾¿æ·çš„æ–‡ä»¶ç®¡ç†ã€éŸ³ä¹æ’­æ”¾ã€æ–‡æ¡£ç¼–è¾‘å’Œè®°å½•ä¸“æ³¨æ—¶é—´ç­‰æœåŠ¡ã€‚æ³¨æ„ï¼ä¸¥æ ¼éµå®ˆäºŒçº§æ–‡ä»¶å¤¹æ ¼å¼ï¼Œæ ¹ç›®å½•ä¸‹åªèƒ½å­˜åœ¨å››ä¸ªç³»ç»Ÿæ–‡ä»¶å¤¹ï¼ˆåˆ›å»ºç”¨æˆ·æ—¶ä¸€èµ·åˆ›å»ºï¼‰ï¼ä¸»è¦åŠŸèƒ½æ¨¡å—ä¸ºéŸ³ä¹ä¸æ–‡æ¡£ï¼

ç³»ç»Ÿä¸¥æ ¼è¦æ±‚æ–‡ä»¶åœ¨ç¬¬ä¸‰é›†ç›®å½•ï¼Œè‡ªå®šä¹‰æ–‡ä»¶å¤¹åœ¨ç¬¬äºŒçº§ç›®å½•ä¸‹ï¼Œç„¶åæ ¹ç›®å½•åªèƒ½æœ‰ç³»ç»Ÿæ–‡ä»¶å¤¹ï¼ 

```text
â˜ï¸ äº‘ç›˜ (è¿™æ˜¯ä¸€ä¸ªè™šæ‹Ÿçš„æ ¹ï¼Œå¯ä»¥è®¤ä¸ºå®ƒçš„ parent_id æ˜¯ 0)
â”‚
â”œâ”€ğŸ“ æ­Œå• (id=1, parent_id=0, type=system)
â”‚  â”‚
â”‚  â”œâ”€ğŸ“ æˆ‘å–œæ¬¢çš„éŸ³ä¹ (id=101, parent_id=1, type=playlist)
â”‚  â”‚  â”‚
â”‚  â”‚  â”œâ”€ğŸµ æ™´å¤©.mp3 (id=201, folder_id=101)
â”‚  â”‚  â””â”€ğŸµ ä¸ƒé‡Œé¦™.mp3 (id=202, folder_id=101)
â”‚  â”‚
â”‚  â””â”€ğŸ“ çº¯éŸ³ä¹ (id=102, parent_id=1, type=playlist)
â”‚     â”‚
â”‚     â””â”€ğŸµ å…‹ç½—åœ°äºšç‹‚æƒ³æ›².mp3 (id=203, folder_id=102)
â”‚
â”œâ”€ğŸ“ æ–‡æ¡£ (id=2, parent_id=0, type=system)
â”‚  â”‚
â”‚  â””â”€ğŸ“ å·¥ä½œç¬”è®° (id=103, parent_id=2, type=booklist)
â”‚     â”‚
â”‚     â””â”€ğŸ“„ å‘¨ä¼šçºªè¦.md (id=204, folder_id=103)
â”‚
â”œâ”€ğŸ“ åˆ†äº« (id=3, parent_id=0, type=system)
â”‚
â””â”€ğŸ“ ä¸Šä¼  (id=4, parent_id=0, type=system)
```

### ï¼ˆä¸€ï¼‰æŠ€æœ¯æ¶æ„

1. **å‰ç«¯**ï¼šä½¿ç”¨ **Vue** ç¼–å†™ï¼Œç»“åˆ **Electron** è¿›è¡Œæ‰“åŒ…ï¼Œä¸ºç”¨æˆ·æä¾›æµç•…çš„æ¡Œé¢ç«¯äº¤äº’ä½“éªŒã€‚

2. **åç«¯**ï¼šSpringBoot ã€SpringTask ã€SpringAI ã€MyBatis-Plus ã€MySQL ã€Redis ã€MinIO ã€RabbitMQ  ã€WebSocket ã€FFmpeg 

3. **æ•°æ®å­˜å‚¨ä¸æ£€ç´¢**ï¼šä»¥ **MySQL** ä½œä¸ºä¸»ä¸šåŠ¡æ•°æ®åº“ï¼Œ**Redis** ä½œä¸ºé«˜æ€§èƒ½ç¼“å­˜ï¼Œ**MINIO** ä½œä¸ºå¯¹è±¡å­˜å‚¨ï¼Œå…±åŒæ„æˆäº†å¤šå±‚æ¬¡ã€é«˜æ€§èƒ½çš„æ•°æ®è§£å†³æ–¹æ¡ˆã€‚MinIOå­˜å‚¨éŸ³ä¹ã€pdfç­‰æ–‡ä»¶é€šè¿‡æ–‡ä»¶å“ˆå¸Œå®ç°ç§’ä¼ å’Œå»é‡ã€‚mdæ–‡æ¡£å­˜Redisä¸MySQL ã€‚

## äºŒã€åŠŸèƒ½æ¨¡å—è¯´æ˜

### ï¼ˆä¸€ï¼‰äº‘ç›˜æ–‡ä»¶é¡µé¢

#### 1. æ–‡ä»¶å¤¹ç»“æ„è§„åˆ™

äº‘ç›˜çš„æ–‡ä»¶å¤¹ç»“æ„ä¸¥æ ¼éµå¾ªç‰¹å®šè§„åˆ™ï¼Œæ—¨åœ¨ä¸ºéŸ³ä¹ä¸æ–‡æ¡£çš„äº‘åŒæ­¥æœåŠ¡æä¾›æ”¯æŒã€‚

- æ ¹ç›®å½•ä¸‹çš„ä¸€çº§æ–‡ä»¶å¤¹ï¼ˆæ­Œå•ã€æ–‡æ¡£ã€åˆ†äº«ã€ä¸Šä¼ ï¼‰ä¸ºå›ºå®šæ–‡ä»¶å¤¹ï¼Œä¸å¯è¿›è¡Œåˆ›å»ºã€ä¿®æ”¹æˆ–åˆ é™¤æ“ä½œã€‚

> è¯´æ˜ï¼šå½“ç¬¬ä¸€æ¬¡ç‚¹å¼€äº‘ç›˜é¡µé¢æ—¶ï¼Œä¼ é€’parent_idä¸º0çš„è¯·æ±‚ï¼Œåç«¯é€šè¿‡parent_idä¸º0åˆ¤æ–­ç”¨æˆ·è¯·æ±‚ä¸ºæ ¹ç›®å½•ï¼Œå³é€šè¿‡folder_typeå’Œuser_idè¿”å›å½“å‰ç”¨æˆ·çš„æ­Œå•ã€æ–‡æ¡£ã€åˆ†äº«ã€ä¸Šä¼ æ–‡ä»¶å¤¹ä¿¡æ¯ã€‚
>
> æ–°ç”¨æˆ·åˆå§‹åŒ–ï¼šå½“ä¸€ä¸ªæ–°ç”¨æˆ·é€šè¿‡ POST /auth/register æ³¨å†Œæ—¶ï¼Œåç«¯æœåŠ¡éœ€è¦åœ¨åˆ›å»ºç”¨æˆ·è®°å½•åï¼Œ**è‡ªåŠ¨ä¸ºå…¶åˆ›å»ºå››ä¸ªæ ¹ç›®å½•ä¸‹çš„ç³»ç»Ÿæ–‡ä»¶å¤¹**ï¼ˆæ­Œå•ã€æ–‡æ¡£ã€åˆ†äº«ã€ä¸Šä¼ ï¼‰ã€‚è¿™ä¸ªé€»è¾‘å±äºåç«¯æ³¨å†Œæµç¨‹çš„ä¸€éƒ¨åˆ†ï¼ŒAPIå±‚é¢æ— éœ€å˜åŠ¨ï¼Œä½†åœ¨å®ç°æ—¶éœ€è¦ç¡®ä¿ã€‚

- ä¸€çº§ç›®å½•ä¸‹çš„äºŒçº§æ–‡ä»¶å¤¹å¯è‡ªå®šä¹‰ï¼Œå¦‚æ­Œå•ï¼ˆplaylistï¼‰å’Œæ–‡æ¡£åˆ†ç±»ï¼ˆbooklistï¼‰ç­‰ï¼ˆå‰åç«¯åŒé‡é‰´å®šï¼Œé˜²æ­¢æ–‡ä»¶å¤¹åµŒå¥—å’Œç»“æ„æ··ä¹±ï¼‰ã€‚äºŒçº§æ–‡ä»¶å¤¹ä¸­å¯ä»¥å­˜åœ¨æ–‡ä»¶ï¼Œä½†å¦‚æœæ–‡ä»¶æœªæ”¾å…¥äºŒçº§æ–‡ä»¶å¤¹ï¼Œå°†æ— æ³•åœ¨éŸ³ä¹é¡µé¢å’Œæ–‡æ¡£é¡µé¢ä¸­è¢«è¯†åˆ«ã€‚
- äºŒçº§ç›®å½•ä¸‹ä»…å…è®¸å­˜æ”¾æ–‡ä»¶ï¼Œç¦æ­¢æ–‡ä»¶å¤¹åµŒå¥—ã€‚

> å­—æ®µè¯´æ˜ï¼šæ•°æ®åº“ä¸­folder_typeæœ‰ä¸‰ç±»ï¼šsystemã€playlistã€booklistï¼Œåˆ†åˆ«å¯¹åº”ç³»ç»Ÿçš„æ–‡ä»¶å¤¹å†…ï¼šæ­Œå•æ–‡æ¡£ä¸Šä¼ åˆ†äº«ï¼Œè‡ªå®šä¹‰çš„æ­Œå•æ–‡ä»¶å¤¹å†…ï¼Œè‡ªå®šä¹‰çš„å›¾ä¹¦åˆ†ç±»æ–‡ä»¶å¤¹å†…ï¼Œå­˜æ”¾ä¸Šä¼ ä»»åŠ¡ç»“æœçš„ä¸Šä¼ æ–‡ä»¶å†…ï¼Œå­˜æ”¾åˆ†äº«é“¾æ¥ä¸‹è½½ä»»åŠ¡ç»“æœçš„åˆ†äº«æ–‡ä»¶å¤¹å†…ï¼ˆå¯ä»¥è‡ªå®šæ–‡ä»¶å¤¹ï¼‰ã€‚

#### 2. å¯¼èˆªæ ä¸é¢åŒ…å±‘

- äº‘ç›˜é¡µé¢é¡¶éƒ¨è®¾æœ‰é¢åŒ…å±‘å¯¼èˆªæ ï¼Œæ–¹ä¾¿ç”¨æˆ·åœ¨ä¸åŒç›®å½•é—´è¿›è¡Œå¯¼èˆªã€‚é¢åŒ…å±‘ä»…æä¾›å¯¼èˆªåŠŸèƒ½ï¼Œç”¨æˆ·å¯ä»¥ç‚¹å‡»é¢åŒ…å±‘ä¸­çš„ä»»æ„å±‚çº§å¿«é€Ÿè·³è½¬åˆ°å¯¹åº”ç›®å½•ã€‚

> æ‹–æ‹½é¢åŒ…å±‘çš„ä¸‹æ‹‰æ¡†ä¿¡æ¯è¯·æ±‚å¤ç”¨APIâ€è·å–æ‰€æœ‰æ–‡ä»¶å¤¹å±‚çº§â€œ ã€‚

- åœ¨é»˜è®¤æ ¹ç›®å½•ä¸‹ï¼Œå¯¼èˆªæ ä»…æ˜¾ç¤º â€œäº‘ç›˜â€ ä¸€é¡¹ã€‚

#### 3. å·¥å…·æ åŠŸèƒ½

- **å½“å‰é¡µé¢ä¿¡æ¯**ï¼šæ˜¾ç¤ºå½“å‰é¡µé¢çš„åç§°ï¼ˆå¦‚æ ¹ç›®å½•ä¸º â€œäº‘ç›˜â€ï¼‰ä»¥åŠè¯¥é¡µé¢åŒ…å«çš„é¡¹ç›®æ•°é‡ã€‚
- **åˆ·æ–°æŒ‰é’®**ï¼šç‚¹å‡»åå¯è·å–äº‘ç›˜çš„æ‰€æœ‰æœ€æ–°ä¿¡æ¯ã€‚
- **æœç´¢åŠŸèƒ½**ï¼šæ”¯æŒå¯¹**æ–‡ä»¶åã€æ–‡ä»¶å¤¹åã€éŸ³ä¹å…ƒæ•°æ®ï¼ˆæ­Œæ‰‹/ä¸“è¾‘ï¼‰ä¹ƒè‡³Markdownç¬”è®°æ­£æ–‡**çš„æ¯«ç§’çº§å¿«é€Ÿæœç´¢ï¼Œå¹¶æä¾›æœç´¢ç»“æœé«˜äº®æ˜¾ç¤ºã€‚
- **æ’åºæŒ‰é’®**ï¼šæä¾›æŒ‰åç§°ã€åˆ›å»ºæ—¶é—´ã€ä¿®æ”¹æ—¶é—´ã€å¤§å°å’Œé»˜è®¤è‡ªå®šä¹‰æ’åº(sorted_order)äº”ç§æ’åºæ–¹å¼ã€‚
- **è§†å›¾æŒ‰é’®**ï¼šå¯åœ¨æ–¹å—è§†å›¾å’Œåˆ—è¡¨è§†å›¾ä¹‹é—´è¿›è¡Œåˆ‡æ¢ã€‚
- **å›æ”¶ç«™æŒ‰é’®**ï¼šæ”¯æŒæ‹–æ‹½æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹è¿›è¡Œè½¯åˆ é™¤æ“ä½œï¼Œç‚¹å‡»è¯¥æŒ‰é’®å¯è¿›å…¥å›æ”¶ç«™é¡µé¢ã€‚

#### 4. å›æ”¶ç«™é¡µé¢

- å›æ”¶ç«™å·¥å…·æ æä¾›ä¸€é”®æ¢å¤å’Œåˆ é™¤åŠŸèƒ½ã€‚
- é¡µé¢ä¸­çš„æ–‡ä»¶å’Œæ–‡ä»¶å¤¹å³é”®èœå•ä»…æä¾›æ¢å¤å’Œåˆ é™¤é€‰é¡¹ã€‚
- åœ¨åˆ—è¡¨è§†å›¾ä¸‹ï¼Œæ˜¾ç¤ºæ–‡ä»¶æˆ–æ–‡ä»¶å¤¹çš„å¤§å°ã€åˆ é™¤æ—¶é—´å’Œæ¸…é™¤æ—¶é—´ï¼ˆç¡¬ç¼–ç ä¸º 30 å¤©ï¼‰ã€‚
- é¢åŒ…å±‘æ˜¾ç¤ºä¸º â€œäº‘ç›˜> å›æ”¶ç«™â€ï¼Œç‚¹å‡»å¯è¿”å›äº‘ç›˜æ ¹ç›®å½•ã€‚

#### 5. æ ¹ç›®å½•æ“ä½œ

- **å³é”®ç©ºç™½å¤„**ï¼šä»…æä¾›åˆ·æ–°åŠŸèƒ½ã€‚
- **å³é”®æ–‡ä»¶å¤¹ï¼ˆæ­Œå•ã€æ–‡æ¡£ã€åˆ†äº«ã€ä¸Šä¼ ï¼‰**ï¼šæä¾›åˆ·æ–°ã€æ‰“å¼€ã€ä¸‹è½½å’Œè¯¦ç»†ä¿¡æ¯åŠŸèƒ½ã€‚æ ¹ç›®å½•ç¦æ­¢å‡ºç°å…¶ä»–æ–‡ä»¶å¤¹å’Œæ–‡ä»¶ã€‚

#### 6. ä¸€çº§ç›®å½•æ“ä½œ

- ä¸€çº§ç›®å½•çš„äº‘ç›˜ç•Œé¢æœ‰æ–°å»ºæ–‡ä»¶å¤¹æ¡†ã€‚

- **å³é”®ç©ºç™½å¤„**ï¼šæä¾›åˆ·æ–°å’Œæ–°å»ºæ–‡ä»¶å¤¹åŠŸèƒ½ã€‚
- å³é”®æ–‡ä»¶å¤¹ä¸æ–‡ä»¶ï¼šæä¾›åˆ·æ–°ã€æ‰“å¼€ã€ä¸‹è½½ã€åˆ†äº«ã€å¤åˆ¶ã€å‰ªåˆ‡ã€åˆ é™¤ã€é‡å‘½åã€ç§»åŠ¨åˆ°å’Œè¯¦ç»†ä¿¡æ¯åŠŸèƒ½ã€‚
  - **ä¸‹è½½**ï¼šè§¦å‘ä¼ è¾“é¡µé¢çš„ä¸‹è½½ä»»åŠ¡ï¼Œç”¨æˆ·å¯åœ¨è®¾ç½®é¡µé¢è‡ªè¡Œä¿®æ”¹ä¸‹è½½ç›®å½•ï¼ˆå®¢æˆ·ç«¯è®¾ç½®ï¼Œä¸åç«¯æ— å…³ï¼‰ã€‚
  - **åˆ†äº«**ï¼šç”¨æˆ·å¯é€‰æ‹©åˆ†äº«æ—¶é—´å’Œæ˜¯å¦åŠ å¯†ï¼Œç‚¹å‡»ç”Ÿæˆé“¾æ¥åï¼Œåç«¯å°†ç”Ÿæˆå¹¶è¿”å› â€œé“¾æ¥ & å¯†ç â€ æ ¼å¼çš„ä¿¡æ¯ï¼Œè‡ªåŠ¨å¤åˆ¶åˆ°å‰ªè´´æ¿ã€‚
  - **ç§»åŠ¨åˆ°**ï¼šæ–‡ä»¶å¤¹ç§»åŠ¨æ—¶ä»…æ˜¾ç¤ºæ ¹ç›®å½•çš„å››ä¸ªå¤§ç±»æ–‡ä»¶å¤¹ï¼›æ–‡ä»¶ç§»åŠ¨æ—¶å¯æ˜¾ç¤ºäºŒçº§æ–‡ä»¶å¤¹ã€‚
  - **è¯¦ç»†ä¿¡æ¯**ï¼šæ˜¾ç¤ºåç§°ã€ç±»å‹ã€å¤§å°ã€ä¿®æ”¹æ—¶é—´å’Œè·¯å¾„ã€‚

#### 7. äºŒçº§ç›®å½•æ“ä½œ

- äºŒçº§ç›®å½•çš„äº‘ç›˜ç•Œé¢æœ‰ä¸Šä¼ æ–‡ä»¶æ¡†ã€‚

- **å³é”®ç©ºç™½å¤„**ï¼šæä¾›åˆ·æ–°å’Œä¸Šä¼ æ–‡ä»¶åŠŸèƒ½ï¼Œä¸Šä¼ æ–‡ä»¶å°†è‡ªåŠ¨è§¦å‘ä¼ è¾“é¡µé¢çš„ä¸Šä¼ ä»»åŠ¡ã€‚
- **å³é”®æ–‡ä»¶**ï¼šæä¾›åˆ·æ–°ã€æ‰“å¼€ã€ä¸‹è½½ã€åˆ†äº«ã€å¤åˆ¶ã€å‰ªåˆ‡ã€åˆ é™¤ã€é‡å‘½åã€ç§»åŠ¨åˆ°å’Œè¯¦ç»†ä¿¡æ¯åŠŸèƒ½ã€‚

### ï¼ˆäºŒï¼‰äº‘ç›˜ä¼ è¾“é¡µé¢

- é‡‡ç”¨ä¸¤æ å¸ƒå±€ï¼Œå·¦æ ä¸ºåˆ‡æ¢ä¸Šä¼ å’Œä¸‹è½½è§†å›¾çš„æŒ‰é’®ï¼Œæ˜¾ç¤ºå½“å‰ç›¸åº”çš„ä»»åŠ¡æ•°é‡ã€‚
- å³æ ä¸ºä»»åŠ¡æ¡†ï¼Œæä¾› â€œä¸Šä¼ æ–‡ä»¶â€ æŒ‰é’®ï¼Œå¯å¿«é€Ÿä¸Šä¼ æ–‡ä»¶ï¼ˆç¡¬ç¼–ç æ”¾åˆ°æ ¹ç›®å½•ä¸‹çš„ä¸Šä¼ æ–‡ä»¶å¤¹ï¼‰ã€‚ç”¨æˆ·å¯å–æ¶ˆä»»åŠ¡ï¼Œåˆ‡æ¢åˆ°å·²å®Œæˆæ¡†è¿›è¡Œæ–‡ä»¶æˆ–è®°å½•çš„åˆ é™¤æ“ä½œï¼Œæ”¯æŒä¸€é”®åˆ é™¤ï¼Œä¹Ÿå¯é€‰æ‹©å•ç‹¬åˆ é™¤æ–‡ä»¶ã€è®°å½•æˆ–ä¸¤è€…åŒæ—¶åˆ é™¤ã€‚
- æä¾› â€œåˆ†äº«é“¾æ¥â€ æŒ‰é’®ï¼Œç”¨æˆ·è¾“å…¥åˆ«äººåˆ†äº«çš„é“¾æ¥åï¼Œå°†è‡ªåŠ¨è§¦å‘ä¸Šä¼ ä»»åŠ¡ï¼ˆç¡¬ç¼–ç æ”¾åˆ°æ ¹ç›®å½•ä¸‹çš„åˆ†äº«æ–‡ä»¶å¤¹ï¼‰ã€‚åº”ç”¨çš„æ‰€æœ‰ä¸Šä¼ å’Œä¸‹è½½ç›¸å…³æ“ä½œéƒ½ä¼šç»è¿‡è¯¥é¡µé¢ï¼Œå¹¶ç”Ÿæˆè®°å½•ã€‚
- æ³¨æ„ï¼Œä¸Šä¼ ä»»åŠ¡å’Œåˆ†äº«ä»»åŠ¡å­˜å‚¨ä½ç½®ä¸èƒ½å˜ï¼å¯ä»¥åæœŸæ‹–æ‹½ï¼

### ï¼ˆä¸‰ï¼‰éŸ³ä¹é¡µé¢

#### 1. æ–‡ä»¶å­˜å‚¨ä½ç½®

- **äº‘ç›˜æ ¹ç›®å½•ä¸‹çš„æ­Œå•æ–‡ä»¶å¤¹**ï¼šæ­Œå•æ–‡ä»¶å¤¹å†…çš„å­æ–‡ä»¶å¤¹ç›¸å½“äºä¸€ä¸ªä¸ªæ­Œå•ã€‚
- **åº”ç”¨åº•è¾¹æ çš„æ­Œæ›²æ **ï¼šæ˜¾ç¤ºå½“å‰æ’­æ”¾ä¿¡æ¯ï¼Œç‚¹å‡»å·¦ä¾§ä¸“è¾‘å°é¢å¯è·³è½¬è‡³éŸ³ä¹é¡µé¢ã€‚æä¾›ä¸€èˆ¬éŸ³ä¹æ’­æ”¾å™¨åŠŸèƒ½ï¼Œå¦‚æ’­æ”¾ã€æš‚åœã€ä¸‹ä¸€é¦–ã€è°ƒèŠ‚éŸ³é‡ã€é™éŸ³ã€æ”¹å˜æ’­æ”¾é€»è¾‘ï¼ˆé¡ºåºæ’­æ”¾ã€å•æ›²å¾ªç¯ã€éšæœºæ’­æ”¾ï¼‰ä»¥åŠå¿«é€Ÿåˆ‡æ¢æ­Œå•ä¸éŸ³ä¹ã€‚

#### 2. é¡µé¢å¸ƒå±€ä¸åŠŸèƒ½

- **å·¦è¾¹æ **ï¼šä¸ºå¯è‡ªå®šä¹‰é¡ºåºçš„æ­Œå•åˆ—è¡¨ï¼Œä¼šè‡ªåŠ¨é€‰ä¸­å½“å‰æ’­æ”¾çš„æ­Œå•ï¼Œæä¾› â€œ+ æ–°å»ºæ­Œå•â€ æŒ‰é’®ï¼Œç›¸å½“äºåœ¨äº‘ç›˜ä¸€çº§ç›®å½•ä¸‹å³é”®åˆ›å»ºæ–‡ä»¶å¤¹ã€‚(è‡ªå®šä¹‰æ’åºéœ€è¦ä¼ å…¥æ–°ä½ç½®çš„å‰ä¸€ä¸ªidå’Œåä¸€ä¸ªid)
- **ä¸­é—´æ **ï¼šæ˜¾ç¤ºå½“å‰é€‰ä¸­æ­Œå•çš„æ­Œæ›²åˆ—è¡¨ï¼ˆå¯è‡ªå®šä¹‰é¡ºåºï¼‰ï¼Œä¼šè‡ªåŠ¨é€‰ä¸­å½“å‰æ’­æ”¾çš„æ­Œæ›²ï¼Œæä¾› â€œæ·»åŠ â€ æŒ‰é’®ï¼Œç›¸å½“äºåœ¨äº‘ç›˜äºŒçº§ç›®å½•ä¸‹ä¸Šä¼ æ–‡ä»¶ã€‚(è‡ªå®šä¹‰æ’åºéœ€è¦ä¼ å…¥æ–°ä½ç½®çš„å‰ä¸€ä¸ªidå’Œåä¸€ä¸ªid)
- **å³è¾¹æ **ï¼šä¸ºå¯æŠ˜å çš„å½“å‰æ’­æ”¾éŸ³ä¹çš„è¯¦ç»†ä¿¡æ¯æ ï¼Œæ˜¾ç¤ºæ­Œæ›²åå­—ã€ä¸“è¾‘åã€ä½œè€…åä»¥åŠä¸€ä¸ªå¯æ‹–æ‹½è¿›åº¦æ¡ã€‚åº•éƒ¨éŸ³ä¹æ ä¸éŸ³ä¹é¡µé¢åŒæ­¥ï¼Œåº”ç”¨å¯åŠ¨æ—¶ä¼šå•ç‹¬è·å–ç›¸åº”çš„å…¨éƒ¨å…ƒä¿¡æ¯ã€‚

### ï¼ˆå››ï¼‰æ–‡æ¡£é¡µé¢

- æ–‡æ¡£é¡µé¢ä¸éŸ³ä¹é¡µé¢é€»è¾‘ç›¸ä¼¼ï¼Œä½†æä¾› â€œæ–°å»º MDâ€ æŒ‰é’®ï¼Œå¯å¿«é€Ÿæ–°å»ºæ–‡ä»¶å¤¹ã€‚
- åŒå‡»æ–‡ä»¶å¯è¿›å…¥å¯¹åº”æ¸²æŸ“è§†å›¾ï¼Œå¯¹ PPTã€docã€pdf ç­‰æ–‡ä»¶åªè¿›è¡Œæ¸²æŸ“ï¼Œä¸æ”¯æŒç¼–è¾‘ã€‚
- åœ¨ MD è§†å›¾ä¸­ï¼Œæä¾› â€œä¿å­˜â€ æŒ‰é’®æˆ–ä½¿ç”¨ â€œCtrl + Sâ€ å¿«æ·é”®è¿›è¡Œä¿å­˜ï¼Œæ”¯æŒä¸€èˆ¬å¿«æ·é”®æ“ä½œã€‚è¿›å…¥ MD è§†å›¾æ—¶ï¼ŒéŸ³ä¹æ è‡ªåŠ¨æ”¶èµ·ï¼Œä¸ºç¼–è¾‘é¡µé¢æœ€å¤§åŒ–è®©æ­¥ï¼Œç”¨æˆ·å¯è‡ªè¡Œå±•å¼€ï¼Œå·¦ä¸Šè§’æä¾›è¿”å›ç›®å½•çš„æŒ‰é’®ã€‚
- mdæ–‡æ¡£é‡Œç²˜è´´å›¾ç‰‡ï¼š1.æ²¡è®¾ç½®picgo ä¿å­˜æœ¬åœ° 2.è®¾ç½®picgo è‡ªåŠ¨ä¸Šä¼ 

### ï¼ˆäº”ï¼‰è®¾ç½®é¡µé¢

é‡‡ç”¨ä¸¤æ è§†å›¾ï¼Œå·¦æ æ˜¾ç¤ºå¤§ç±»ç³»ç»Ÿè®¾ç½®ï¼Œå³æ æ˜¾ç¤ºå…·ä½“è®¾ç½®é€‰é¡¹ã€‚

#### 1. é€šç”¨è®¾ç½®

- **å¼€æœºè‡ªå¯**ï¼šå¯è®¾ç½®åº”ç”¨æ˜¯å¦åœ¨å¼€æœºæ—¶è‡ªåŠ¨å¯åŠ¨ï¼Œç”±å®¢æˆ·ç«¯å®ç°ã€‚
- **ä¸‹è½½ç›®å½•**ï¼šç”¨æˆ·å¯è‡ªè¡Œä¿®æ”¹ä¸‹è½½ç›®å½•ï¼Œå®¢æˆ·ç«¯è®¾ç½®ï¼Œä¸åç«¯æ— å…³ã€‚

#### 2. è´¦æˆ·ä¸äº‘ç›˜

- æ˜¾ç¤ºç”¨æˆ·å¤´åƒï¼ˆå¯ç‚¹å‡»ä¸Šä¼ ä¿®æ”¹ï¼‰ã€ç”¨æˆ·åã€é‚®ç®±å’Œäº‘ç›˜å®¹é‡ã€‚
- æä¾› â€œä¿®æ”¹å¯†ç â€ æŒ‰é’®ï¼Œç”¨æˆ·éœ€è¾“å…¥å½“å‰å¯†ç ã€æ–°å¯†ç å’Œç¡®è®¤æ–°å¯†ç ã€‚
- æä¾› â€œæ¢å¤é»˜è®¤å¤´åƒâ€ æŒ‰é’®ï¼Œå¯æ¢å¤ç³»ç»Ÿé»˜è®¤å¤´åƒã€‚
- æä¾› â€œé€€å‡ºç™»å½•â€ æŒ‰é’®ï¼Œä¸ç³»ç»Ÿæ çš„å¤´åƒç‚¹å‡»ä¸‹æ‹‰æ¡†æ³¨é”€åŠŸèƒ½ç›¸åŒï¼Œåˆ é™¤ token åé€€å‡ºç™»å½•ã€‚

#### 3. æˆ‘çš„åˆ†äº«

- æ˜¾ç¤ºåˆ†äº«è®°å½•ï¼Œæ”¯æŒæ‡’åŠ è½½æ•°æ®ï¼Œé»˜è®¤è¯·æ±‚ 10 æ¡æ•°æ®ï¼Œä¸‹æ‹‰æ¡†è§¦å‘æ›´å¤šæ•°æ®åŠ è½½ã€‚
- æ˜¾ç¤ºåˆ†äº«æ–‡ä»¶åã€åˆ†äº«ç±»å‹ï¼ˆæ–‡ä»¶å¤¹ / æ–‡ä»¶ã€æœ‰æ•ˆæœŸï¼‰ã€åˆ†äº«é“¾æ¥ä¸å¯†ç ã€æœ‰æ•ˆæœŸå’Œåˆ†äº«æ—¶é—´ã€‚
- æä¾› â€œä¸€é”®å¤åˆ¶â€ æŒ‰é’®ï¼Œå¯å°† â€œé“¾æ¥ & å¯†ç â€ å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼›æä¾› â€œå–æ¶ˆåˆ†äº«â€ æŒ‰é’®ã€‚

#### 4. ä¸“æ³¨è®°å½•

- æ˜¾ç¤ºä¸“æ³¨è®°å½•ï¼Œæ”¯æŒåŸå­æ€§å’Œæ‡’åŠ è½½ï¼Œé»˜è®¤è¯·æ±‚ 10 æ¡æ•°æ®ï¼Œä¸‹æ‹‰æ¡†è§¦å‘æ›´å¤šæ•°æ®åŠ è½½ã€‚
- æ˜¾ç¤ºæ—¶é—´å’Œä¸“æ³¨æ—¶é•¿ã€‚

#### 5. å…³äº

æ˜¾ç¤ºåº”ç”¨çš„ç‰ˆæœ¬å·ã€‚

## ä¸‰ã€SQLæ–‡ä»¶

```sql
CREATE DATABASE IF NOT EXISTS `liteisle_db`
    CHARACTER SET utf8mb4
    COLLATE utf8mb4_general_ci;

USE `liteisle_db`;

-- =================================================================
-- ç”¨æˆ·æ ¸å¿ƒæ¨¡å— (User Core Module)
-- ä½œç”¨: ç®¡ç†æ‰€æœ‰ä¸ç”¨æˆ·è´¦æˆ·ã€èº«ä»½ã€é…ç½®å’Œæ¸¸æˆåŒ–æ¿€åŠ±ç›¸å…³çš„æ•°æ®ã€‚
-- =================================================================

-- ----------------------------
-- 1. ç”¨æˆ·è¡¨ (users)
-- æè¿°: å­˜å‚¨ç”¨æˆ·çš„æ ¸å¿ƒè´¦æˆ·ä¿¡æ¯ã€è®¤è¯å‡­æ®å’Œäº‘ç›˜ç©ºé—´é…é¢ã€‚
-- ----------------------------
CREATE TABLE `users` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT 'ç”¨æˆ·å”¯ä¸€æ ‡è¯†ID (ä¸»é”®)',
  `username` varchar(50) NOT NULL COMMENT 'ç”¨æˆ·åï¼Œç”¨äºç™»å½•ï¼Œå…¨ç³»ç»Ÿå”¯ä¸€',
  `email` varchar(100) NOT NULL COMMENT 'ç”¨æˆ·é‚®ç®±ï¼Œç”¨äºç™»å½•å’Œæ¥æ”¶é€šçŸ¥ï¼Œå…¨ç³»ç»Ÿå”¯ä¸€',
  `password` varchar(255) NOT NULL COMMENT 'åŠ å¯†åçš„ç”¨æˆ·å¯†ç  (ä¾‹å¦‚ä½¿ç”¨BCrypt)',
  `avatar` varchar(512) DEFAULT NULL COMMENT 'ç”¨æˆ·å¤´åƒçš„URLåœ°å€',
  `storage_quota` bigint DEFAULT 5368709120 COMMENT 'ç”¨æˆ·æ€»å­˜å‚¨ç©ºé—´é…é¢ï¼Œå•ä½ï¼šå­—èŠ‚ (Bytes)ï¼Œé»˜è®¤5GB',
  `storage_used` bigint DEFAULT 0 COMMENT 'ç”¨æˆ·å·²ä½¿ç”¨çš„å­˜å‚¨ç©ºé—´ï¼Œå•ä½ï¼šå­—èŠ‚ (Bytes)ï¼Œé€šè¿‡å¼‚æ­¥æ¶ˆæ¯é˜Ÿåˆ—åœ¨æ–‡ä»¶æ“ä½œåæ›´æ–°',
  `create_time` timestamp DEFAULT CURRENT_TIMESTAMP COMMENT 'è´¦æˆ·åˆ›å»ºæ—¶é—´',
  `update_time` timestamp DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'è´¦æˆ·ä¿¡æ¯æœ€åæ›´æ–°æ—¶é—´',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_username` (`username`),
  UNIQUE KEY `uk_email` (`email`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='ç”¨æˆ·è´¦æˆ·ä¸åŸºæœ¬ä¿¡æ¯è¡¨';

-- ----------------------------
-- 2. ç”¨æˆ·ä¸“æ³¨è®°å½•è¡¨ (user_focus_records)
-- æè¿°: è®°å½•ç”¨æˆ·çš„æ¯ä¸€æ¬¡ä¸“æ³¨ä¼šè¯ã€‚
-- ----------------------------
CREATE TABLE `user_focus_records` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT 'ä¸“æ³¨è®°å½•å”¯ä¸€ID (ä¸»é”®)',
  `user_id` bigint NOT NULL COMMENT 'å¤–é”®ï¼Œå…³è”åˆ° users.idï¼Œæ ‡è¯†è¯¥è®°å½•æ‰€å±çš„ç”¨æˆ·',
  `focus_minutes` int DEFAULT 0 COMMENT 'å•æ¬¡å®Œæ•´ä¸“æ³¨ä¼šè¯çš„æ—¶é•¿ï¼ˆå•ä½ï¼šåˆ†é’Ÿï¼‰',
  `create_time` timestamp DEFAULT CURRENT_TIMESTAMP COMMENT 'ä¸“æ³¨å®Œæˆå¹¶è®°å½•çš„æ—¶é—´ç‚¹',
  PRIMARY KEY (`id`),
  KEY `idx_user_focus_time` (`user_id`, `create_time` DESC),
  CONSTRAINT `fk_focus_user` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='ç”¨æˆ·å•æ¬¡ä¸“æ³¨ä¼šè¯è®°å½•è¡¨';

-- ----------------------------
-- 3. ç”¨æˆ·å²›å±¿æ”¶é›†è¡¨ (user_islands)
-- æè¿°: è®°å½•ç”¨æˆ·é€šè¿‡ä¸“æ³¨ç­‰è¡Œä¸ºè§£é”æ”¶é›†åˆ°çš„æ‰€æœ‰å²›å±¿ã€‚
-- ----------------------------
CREATE TABLE `user_islands` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT 'æ”¶é›†è®°å½•çš„å”¯ä¸€ID (ä¸»é”®)',
  `user_id` bigint NOT NULL COMMENT 'å¤–é”®ï¼Œå…³è”åˆ° users.idï¼Œæ ‡è¯†è¯¥å²›å±¿çš„æ‹¥æœ‰è€…',
  `island_url` varchar(255) NOT NULL COMMENT 'å²›å±¿çš„å”¯ä¸€ä¸šåŠ¡ä»£ç ï¼Œä¸åç«¯ä»£ç ä¸­çš„å²›å±¿é…ç½®ç›¸å¯¹åº”',
  `create_time` timestamp DEFAULT CURRENT_TIMESTAMP COMMENT 'å²›å±¿çš„è·å–æ—¶é—´',
  PRIMARY KEY (`id`),
  CONSTRAINT `fk_user_islands_user` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='è®°å½•ç”¨æˆ·å·²è§£é”çš„å²›å±¿è¡¨';



-- =================================================================
-- æ–‡ä»¶ç³»ç»Ÿæ¨¡å— (File System Module)
-- ä½œç”¨: ç®¡ç†æ‰€æœ‰ä¸æ–‡ä»¶ã€æ–‡ä»¶å¤¹ç›¸å…³çš„ç‰©ç†å­˜å‚¨å’Œé€»è¾‘ç»“æ„ã€‚
-- =================================================================

-- ----------------------------
-- 4. ç‰©ç†æ–‡ä»¶å­˜å‚¨è¡¨ (storages)
-- æè¿°: å­˜å‚¨ç‰©ç†æ–‡ä»¶çš„å”¯ä¸€å®ä½“ä¿¡æ¯ã€‚é€šè¿‡æ–‡ä»¶å“ˆå¸Œå®ç°ç§’ä¼ å’Œå­˜å‚¨å»é‡ã€‚
-- ----------------------------
CREATE TABLE `storages` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT 'ç‰©ç†å­˜å‚¨è®°å½•ID (ä¸»é”®)',
  `file_hash` varchar(64) NOT NULL COMMENT 'æ–‡ä»¶å†…å®¹çš„å“ˆå¸Œå€¼ (SHA-256)ï¼Œç”¨äºç§’ä¼ åŠŸèƒ½çš„æ ¸å¿ƒæ ¡éªŒ',
  `file_size` bigint NOT NULL COMMENT 'æ–‡ä»¶å¤§å°ï¼Œå•ä½ï¼šå­—èŠ‚ (Bytes)',
  `mime_type` varchar(100) NOT NULL COMMENT 'æ–‡ä»¶çš„MIMEç±»å‹ï¼Œä¾‹å¦‚ "audio/mpeg", "application/pdf"',
  `storage_path` varchar(512) NOT NULL COMMENT 'æ–‡ä»¶åœ¨å¯¹è±¡å­˜å‚¨æœåŠ¡(å¦‚R2)ä¸­çš„å”¯ä¸€è·¯å¾„æˆ–Key',
  `reference_count` int DEFAULT 1 COMMENT 'å¼•ç”¨è®¡æ•°ã€‚å½“è®¡æ•°å€¼ä¸º0æ—¶ï¼Œå¯ç”±åå°åƒåœ¾å›æ”¶ä»»åŠ¡å®‰å…¨åˆ é™¤ç‰©ç†æ–‡ä»¶',
  `create_time` timestamp DEFAULT CURRENT_TIMESTAMP COMMENT 'è¯¥ç‰©ç†æ–‡ä»¶é¦–æ¬¡è¢«ä¸Šä¼ åˆ°ç³»ç»Ÿçš„æ—¶é—´',
  `update_time` timestamp DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'è®°å½•çš„æœ€åæ›´æ–°æ—¶é—´',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_file_hash` (`file_hash`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='å­˜å‚¨å”¯ä¸€æ–‡ä»¶å®ä½“ï¼Œå®ç°ç§’ä¼ åŠŸèƒ½';

-- ----------------------------
-- 5. æ–‡ä»¶å¤¹è¡¨ (folders)
-- æè¿°: å­˜å‚¨ç”¨æˆ·å¯è§çš„é€»è¾‘æ–‡ä»¶å¤¹ç»“æ„ã€‚
-- ----------------------------
CREATE TABLE `folders` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT 'æ–‡ä»¶å¤¹å”¯ä¸€ID (ä¸»é”®)',
  `user_id` bigint NOT NULL COMMENT 'å¤–é”®ï¼Œå…³è”åˆ° users.idï¼Œæ ‡è¯†æ­¤æ–‡ä»¶å¤¹çš„æ‹¥æœ‰è€…',
  `parent_id` bigint DEFAULT 0 COMMENT 'çˆ¶æ–‡ä»¶å¤¹IDã€‚å€¼ä¸º0è¡¨ç¤ºæ ¹ç›®å½•ä¸‹çš„æ–‡ä»¶å¤¹',
  `folder_name` varchar(255) NOT NULL COMMENT 'æ–‡ä»¶å¤¹åœ¨UIä¸Šæ˜¾ç¤ºçš„åç§°',
  `folder_type` enum('system', 'playlist', 'booklist') NOT NULL COMMENT 'åªæœ‰ system, playlist, booklist ä¸‰ç±»ã€‚',
  `sorted_order` decimal(30, 10) DEFAULT 0 COMMENT 'ç”¨äºç”¨æˆ·è‡ªå®šä¹‰æ’åºçš„æµ®ç‚¹æ•°å€¼',
  `delete_time` timestamp NULL DEFAULT NULL COMMENT 'è½¯åˆ é™¤æ ‡è®°ã€‚éNULLè¡¨ç¤ºå·²ç§»å…¥å›æ”¶ç«™',
  `create_time` timestamp DEFAULT CURRENT_TIMESTAMP COMMENT 'æ–‡ä»¶å¤¹åˆ›å»ºæ—¶é—´',
  `update_time` timestamp DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ–‡ä»¶å¤¹æœ€åæ›´æ–°æ—¶é—´ï¼ˆå¦‚é‡å‘½åï¼‰',
  PRIMARY KEY (`id`),
  KEY `idx_user_parent` (`user_id`, `parent_id`),
  CONSTRAINT `fk_folders_user` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='ç”¨æˆ·é€»è¾‘æ–‡ä»¶å¤¹ç»“æ„è¡¨';

-- ----------------------------
-- 6. æ–‡ä»¶åŸºç¡€ä¿¡æ¯è¡¨ (files)
-- æè¿°: å­˜å‚¨æ‰€æœ‰æ–‡ä»¶çš„é€šç”¨åŸºç¡€ä¿¡æ¯ï¼Œä½œä¸ºæ–‡ä»¶å®ä½“çš„æ ¸å¿ƒã€‚
-- ----------------------------
CREATE TABLE `files` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT 'æ–‡ä»¶å”¯ä¸€ID (ä¸»é”®)',
  `user_id` bigint NOT NULL COMMENT 'å¤–é”®ï¼Œå…³è”åˆ° users.idï¼Œæ ‡è¯†æ­¤æ–‡ä»¶çš„æ‹¥æœ‰è€…',
  `folder_id` bigint NOT NULL COMMENT 'å¤–é”®ï¼Œå…³è”åˆ° folders.idï¼Œæ ‡è¯†æ–‡ä»¶æ‰€åœ¨çš„æ–‡ä»¶å¤¹',
  `storage_id` bigint DEFAULT NULL COMMENT 'å¤–é”®ï¼Œå…³è”åˆ° storages.idï¼Œæ–‡ä»¶å¤„ç†æˆåŠŸåå¡«å……',
  `file_name` varchar(255) NOT NULL COMMENT 'æ–‡ä»¶åï¼ˆé€šå¸¸åŒ…å«æ‰©å±•åï¼‰',
  `file_extension` varchar(20) DEFAULT NULL COMMENT 'æ–‡ä»¶æ‰©å±•åï¼Œå¦‚ "mp3", "pdf", ç”¨äºå‰ç«¯æ˜¾ç¤º',
  `file_type` enum('music', 'document') NOT NULL COMMENT 'æ–‡ä»¶çš„ä¸šåŠ¡å¤§ç±»ï¼Œç”¨äºç”„åˆ«åº”å…³è”å“ªä¸ªå…ƒæ•°æ®è¡¨',
  `file_status` enum('processing', 'available', 'failed') NOT NULL DEFAULT 'processing' COMMENT 'æ–‡ä»¶çŠ¶æ€ã€‚processing:åå°å¤„ç†ä¸­; available:å®Œå…¨å¯ç”¨; failed:å¤„ç†å¤±è´¥',
  `sorted_order` decimal(30, 10) DEFAULT 0 COMMENT 'ç”¨äºç”¨æˆ·è‡ªå®šä¹‰æ’åºçš„æµ®ç‚¹æ•°å€¼',
  `delete_time` timestamp NULL DEFAULT NULL COMMENT 'è½¯åˆ é™¤æ ‡è®°ã€‚éNULLè¡¨ç¤ºå·²ç§»å…¥å›æ”¶ç«™',
  `create_time` timestamp DEFAULT CURRENT_TIMESTAMP COMMENT 'æ–‡ä»¶é€»è¾‘è®°å½•çš„åˆ›å»ºæ—¶é—´',
  `update_time` timestamp DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ–‡ä»¶å…ƒæ•°æ®çš„æœ€åæ›´æ–°æ—¶é—´',
  PRIMARY KEY (`id`),
  KEY `idx_user_folder_status` (`user_id`, `folder_id`, `file_status`),
  CONSTRAINT `fk_files_user` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE,
  CONSTRAINT `fk_files_folder` FOREIGN KEY (`folder_id`) REFERENCES `folders` (`id`) ON DELETE CASCADE,
  CONSTRAINT `fk_files_storage` FOREIGN KEY (`storage_id`) REFERENCES `storages` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='æ–‡ä»¶é€šç”¨åŸºç¡€ä¿¡æ¯è¡¨';

-- ----------------------------
-- 7. éŸ³ä¹æ–‡ä»¶å…ƒæ•°æ®è¡¨ (music_metadata)
-- æè¿°: å­˜å‚¨éŸ³ä¹æ–‡ä»¶ä¸“å±çš„å…ƒæ•°æ®ã€‚
-- ----------------------------
CREATE TABLE `music_metadata` (
  `file_id` bigint NOT NULL COMMENT 'ä¸»é”®ï¼ŒåŒæ—¶ä¹Ÿæ˜¯å¤–é”®ï¼Œå…³è”åˆ° files.id',
  `artist` varchar(255) DEFAULT NULL COMMENT 'æ­Œæ‰‹åï¼Œç”±åå°FFmpegç­‰å·¥å…·è§£æå¡«å……',
  `album` varchar(255) DEFAULT NULL COMMENT 'ä¸“è¾‘å',
  `duration` int NOT NULL COMMENT 'æ—¶é•¿ï¼Œå•ä½ï¼šç§’',
  CONSTRAINT `fk_music_file` FOREIGN KEY (`file_id`) REFERENCES `files` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='éŸ³ä¹æ–‡ä»¶ä¸“å±å…ƒæ•°æ®è¡¨';

-- ----------------------------
-- 8. æ–‡æ¡£æ–‡ä»¶å…ƒæ•°æ®è¡¨ (document_metadata)
-- æè¿°: å­˜å‚¨æ–‡æ¡£æ–‡ä»¶ä¸“å±çš„å…ƒæ•°æ®ã€‚
-- ----------------------------
CREATE TABLE `document_metadata` (
  `file_id` bigint NOT NULL COMMENT 'ä¸»é”®ï¼ŒåŒæ—¶ä¹Ÿæ˜¯å¤–é”®ï¼Œå…³è”åˆ° files.id',
  `content` longtext COMMENT 'Markdownæ–‡ä»¶çš„çº¯æ–‡æœ¬å†…å®¹ï¼Œç”¨äºå…¨æ–‡æœç´¢',
  `version` bigint NOT NULL DEFAULT 1 COMMENT 'ç”¨äºMarkdownæ–‡ä»¶çš„ä¹è§‚é”ç‰ˆæœ¬å·',
  PRIMARY KEY (`file_id`),
  CONSTRAINT `fk_document_file` FOREIGN KEY (`file_id`) REFERENCES `files` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='æ–‡æ¡£æ–‡ä»¶ä¸“å±å…ƒæ•°æ®è¡¨';

-- =================================================================
-- åˆ†äº«ä¸ä¼ è¾“æ¨¡å— (Sharing & Transfer Module)
-- ä½œç”¨: ç®¡ç†æ‰€æœ‰ä¸æ–‡ä»¶åˆ†äº«ã€ä¸Šä¼ ä¸‹è½½ä»»åŠ¡ç›¸å…³çš„ä¸šåŠ¡æ•°æ®å’Œæ—¥å¿—ã€‚
-- =================================================================

-- ----------------------------
-- 9. åˆ†äº«è¡¨ (share_links)
-- æè¿°: ç®¡ç†ç”¨æˆ·åˆ›å»ºçš„æ‰€æœ‰å…¬å¼€åˆ†äº«é“¾æ¥ã€‚
-- ----------------------------
CREATE TABLE `share_links` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT 'åˆ†äº«è®°å½•å”¯ä¸€ID (ä¸»é”®)',
  `owner_id` bigint NOT NULL COMMENT 'å¤–é”®ï¼Œå…³è”åˆ° users.idï¼Œæ ‡è¯†åˆ†äº«çš„åˆ›å»ºè€…',
  `share_token` varchar(64) NOT NULL COMMENT 'åˆ†äº«é“¾æ¥çš„å”¯ä¸€å…¬å¼€å‡­è¯ï¼Œæ˜¯URLçš„ä¸€éƒ¨åˆ†',
  `share_password` varchar(255) DEFAULT NULL COMMENT 'åŠ å¯†åçš„åˆ†äº«æå–ç ï¼ˆå¦‚æœåˆ†äº«æ˜¯åŠ å¯†çš„ï¼‰',
  `file_id` bigint DEFAULT NULL COMMENT 'å¤–é”®ï¼Œå…³è”åˆ° files.idï¼Œå½“åˆ†äº«ç›®æ ‡æ˜¯å•ä¸ªæ–‡ä»¶æ—¶å¡«å……',
  `folder_id` bigint DEFAULT NULL COMMENT 'å¤–é”®ï¼Œå…³è”åˆ° folders.idï¼Œå½“åˆ†äº«ç›®æ ‡æ˜¯æ–‡ä»¶å¤¹æ—¶å¡«å……',
  `expire_time` timestamp NULL DEFAULT NULL COMMENT 'åˆ†äº«é“¾æ¥çš„è¿‡æœŸæ—¶é—´ï¼ŒNULLè¡¨ç¤ºæ°¸ä¹…æœ‰æ•ˆ',
  `create_time` timestamp DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ†äº«åˆ›å»ºæ—¶é—´',
  `update_time` timestamp DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'åˆ†äº«ä¿¡æ¯æ›´æ–°æ—¶é—´',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_share_token` (`share_token`),
  CONSTRAINT `fk_share_user` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE,
  CONSTRAINT `chk_share_target` CHECK ((`file_id` IS NOT NULL AND `folder_id` IS NULL) OR (`file_id` IS NULL AND `folder_id` IS NOT NULL))
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='ç®¡ç†å…¬å¼€åˆ†äº«é“¾æ¥';

-- ----------------------------
-- 10. ä¼ è¾“æ—¥å¿—è¡¨ (transfer_log)
-- æè¿°: è®°å½•æ¯ä¸€æ¬¡ä¸Šä¼ å’Œä¸‹è½½æ“ä½œï¼Œä¸ºâ€œä¼ è¾“åˆ—è¡¨â€é¡µé¢æä¾›æ•°æ®ã€‚
-- ----------------------------
CREATE TABLE `transfer_log` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT 'ä¼ è¾“æ—¥å¿—å”¯ä¸€ID (ä¸»é”®)',
  `user_id` bigint NOT NULL COMMENT 'å¤–é”®ï¼Œå…³è”åˆ° users.idï¼Œæ ‡è¯†æ“ä½œç”¨æˆ·',
  `transfer_type` enum('upload', 'download') NOT NULL COMMENT 'ä¼ è¾“ç±»å‹ï¼šä¸Šä¼ æˆ–ä¸‹è½½',
  `file_id` bigint DEFAULT NULL COMMENT 'å¤–é”®ï¼Œå…³è”åˆ° files.id (å¦‚æœä¼ è¾“å¯¹è±¡æ˜¯å•ä¸ªæ–‡ä»¶)',
  `folder_id` bigint DEFAULT NULL COMMENT 'å¤–é”®ï¼Œå…³è”åˆ° folders.id (å¦‚æœä¼ è¾“å¯¹è±¡æ˜¯æ–‡ä»¶å¤¹)',
  `item_name` varchar(255) NOT NULL COMMENT 'è¢«ä¼ è¾“é¡¹ç›®ï¼ˆæ–‡ä»¶/æ–‡ä»¶å¤¹ï¼‰çš„åç§°ï¼Œåšå†—ä½™ä»¥å¤‡æŸ¥è¯¢',
  `item_size` bigint NOT NULL COMMENT 'è¢«ä¼ è¾“é¡¹ç›®çš„æ€»å¤§å°ï¼Œå•ä½ï¼šå­—èŠ‚ (Bytes)',
  `log_status` enum('processing','paused', 'success', 'failed', 'canceled') NOT NULL DEFAULT 'processing' COMMENT 'ä¼ è¾“è¡Œä¸ºçŠ¶æ€: å¤„ç†ä¸­, æš‚åœï¼ŒæˆåŠŸ, å¤±è´¥, å·²å–æ¶ˆ',
  `error_message` varchar(512) DEFAULT NULL COMMENT 'å½“statusä¸ºfailedæˆ–canceledæ—¶ï¼Œè®°å½•ç›¸å…³ä¿¡æ¯',
  `transfer_duration_ms` bigint DEFAULT NULL COMMENT 'ä¼ è¾“æ€»è€—æ—¶ï¼Œå•ä½ï¼šæ¯«ç§’ (ms)',
  `client_ip` varchar(45) DEFAULT NULL COMMENT 'å‘èµ·ä¼ è¾“çš„å®¢æˆ·ç«¯IPåœ°å€ï¼Œç”¨äºå®‰å…¨å®¡è®¡',
  `delete_time` timestamp NULL DEFAULT NULL COMMENT 'è½¯åˆ é™¤æ ‡è®°ï¼ŒéNULLè¡¨ç¤ºå·²å¯¹ç”¨æˆ·éšè—',
  `create_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'ä¼ è¾“ä»»åŠ¡åˆ›å»ºæ—¶é—´',
  `update_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'ä¼ è¾“ä»»åŠ¡çŠ¶æ€çš„æœ€åæ›´æ–°æ—¶é—´',
  PRIMARY KEY (`id`),
  KEY `idx_user_status_time` (`user_id`, `log_status`, `create_time` DESC),
  CONSTRAINT `fk_tlog_user` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE,
  CONSTRAINT `fk_tlog_file` FOREIGN KEY (`file_id`) REFERENCES `files` (`id`) ON DELETE SET NULL,
  CONSTRAINT `fk_tlog_folder` FOREIGN KEY (`folder_id`) REFERENCES `folders` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='æ–‡ä»¶ä¸Šä¼ ä¸‹è½½è¡Œä¸ºæ—¥å¿—è¡¨';
```

# APIæ–‡æ¡£

### **1. é€šç”¨è§„èŒƒ**

#### **1.1. åŸºç¡€ URL**

æ‰€æœ‰APIçš„æ ¹è·¯å¾„ä¸º `https://api.liteisle.com/v1` (ç¤ºä¾‹)ã€‚

#### **1.2. JSON å‘½åè§„èŒƒ**

- **API å±‚é¢**: æ‰€æœ‰é€šè¿‡ API ä¼ è¾“çš„ JSON å¯¹è±¡çš„é”®ï¼ˆkeyï¼‰å‡é‡‡ç”¨**è›‡å½¢å‘½åæ³• (snake_case)**ã€‚
- **åç«¯å®ç°**: åç«¯ Spring Boot åº”ç”¨é€šè¿‡ Jackson é…ç½®ï¼Œè‡ªåŠ¨å°† API æ¥å£çš„ `snake_case` ä¸ Java ä»£ç ä¸­çš„ `camelCase` è¿›è¡Œè½¬æ¢ï¼Œåç«¯å¼€å‘è€…åœ¨ä»£ç ä¸­åº”ä½¿ç”¨é©¼å³°å‘½åæ³•ã€‚

#### **1.3. ç»Ÿä¸€å“åº”æ ¼å¼**

æ‰€æœ‰APIåœ¨æˆåŠŸæˆ–å¤±è´¥æ—¶å‡è¿”å›ä»¥ä¸‹ç»“æ„çš„JSONå¯¹è±¡ã€‚

```json
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": {}
}
```

| å­—æ®µ      | ç±»å‹                  | æè¿°                                                         |
| :-------- | :-------------------- | :----------------------------------------------------------- |
| `code`    | Integer               | ä¸šåŠ¡çŠ¶æ€ç ã€‚200: æˆåŠŸ, 202: å·²æ¥æ”¶(ç”¨äºå¼‚æ­¥), 400: å®¢æˆ·ç«¯é”™è¯¯, 401: æœªè®¤è¯, 403: æ— æƒé™, 500: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ã€‚ |
| `message` | String                | å¯¹æ“ä½œç»“æœçš„æ–‡å­—æè¿°ï¼Œç”¨äºè°ƒè¯•æˆ–å‰ç«¯æç¤ºã€‚                   |
| `data`    | Object / Array / null | æ¥å£è¿”å›çš„æ ¸å¿ƒä¸šåŠ¡æ•°æ®ã€‚                                     |

**é€šç”¨æˆåŠŸå“åº”ç¤ºä¾‹**

å½“æ¥å£æ²¡æœ‰ç‰¹å®šä¸šåŠ¡æ•°æ®è¿”å›æ—¶ï¼ˆå¦‚åˆ é™¤ã€æ›´æ–°æ“ä½œï¼‰ï¼Œ`data` å­—æ®µä¸º `null`ã€‚

```json
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": null
}
```

#### **1.4. å®æ—¶é€šä¿¡ (WebSocket)**

æœ¬åº”ç”¨é‡‡ç”¨ WebSocket è¿›è¡Œå®æ—¶åŒå‘é€šä¿¡ï¼Œä»¥æä¾›å³æ—¶çš„æ•°æ®æ›´æ–°å’Œé€šçŸ¥ã€‚

**è¿æ¥ç«¯ç‚¹:** `WS /ws`

**æ¶ˆæ¯æ ¼å¼:**

```json
{ 
    "event": "event_name", 
 	"payload": { ... } 
}
```

**æ ¸å¿ƒæœåŠ¡ç«¯æ¨é€äº‹ä»¶ (S2C - Server to Client):**

*   `file.status.updated`: æ–‡ä»¶åå°å¤„ç†çŠ¶æ€æ›´æ–°ã€‚å½“æ–‡ä»¶ä» `processing` å˜ä¸º `available` æ—¶æ¨é€ã€‚
*   `transfer.log.updated`: ä¼ è¾“æ—¥å¿—çŠ¶æ€æ›´æ–°ã€‚
*   `notification.new`: æ–°é€šçŸ¥ã€‚

#### 1.5 é¡¹ç›®è¦ç‚¹

- æ¡Œé¢ç«¯åº”ç”¨ï¼Œä½¿ç”¨electronæ‰“åŒ…ã€‚
- æ¶‰åŠåˆ°ä¸‹è½½ã€ä¸Šä¼ éƒ½ä¼šåœ¨ä¼ è¾“é¡µé¢åˆ›å»ºä»»åŠ¡ã€‚
- ShareLinks å’Œ å–æ¶ˆä¸Šä¼ ä»»åŠ¡éƒ½æ˜¯ç¡¬åˆ é™¤ã€‚
- mdæ–‡ä»¶ä¸å ç”¨æˆ·ç©ºé—´ mdé‡Œçš„å›¾ç‰‡ä¿å­˜åœ¨å®¢æˆ·ç«¯

---

### **2. è®¤è¯ (Authentication)**

#### **2.1. ç”¨æˆ·ç™»å½•**

`POST /auth/login`

**æè¿°:** ç”¨æˆ·é€šè¿‡ç”¨æˆ·åå’Œå¯†ç è¿›è¡Œç™»å½•ï¼ŒæˆåŠŸåè¿”å›ç”¨æˆ·ä¿¡æ¯å’ŒTokenã€‚

**è¯·æ±‚ä½“:** `@RequestBody AuthLoginReq`

```json
{
  "username": "john_doe",
  "password": "your_strong_password"
}
```

**å“åº”:** `AuthInfoResp`

```json
{
  "code": 200,
  "message": "ç™»å½•æˆåŠŸ",
  "data": {
    "username": "john_doe",
    "email": "john@example.com",
    "avatar": "https://r2.liteisle.com/pictures/default.png",
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c"
  }
}
```

#### **2.2. ç”¨æˆ·æ³¨å†Œ**

`POST /auth/register`

**æè¿°:** ç”¨æˆ·æ³¨å†Œæ–°è´¦å·ï¼Œæ³¨å†ŒæˆåŠŸåå³ä¸ºç™»å½•çŠ¶æ€ã€‚

**è¯·æ±‚ä½“:** `@RequestBody AuthRegisterReq`

```json
{
  "username": "new_user",
  "email": "new_user@example.com",
  "password": "your_strong_password",
  "vcode": "123456"
}
```

**å“åº”:** `AuthInfoResp` (ä¸ç™»å½•æˆåŠŸå“åº”ç»“æ„ç›¸åŒ)

```json
{
  "code": 200,
  "message": "æ³¨å†ŒæˆåŠŸ",
  "data": {
    "username": "new_user",
    "email": "new_user@example.com",
    "picture": "https://r2.liteisle.com/pictures/default.png",
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6Ik5ldyBVc2VyIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c"
  }
}
```

#### **2.3. å‘é€éªŒè¯ç **

`POST /auth/send-vcode`

**æè¿°:** å‘æŒ‡å®šé‚®ç®±å‘é€éªŒè¯ç ï¼Œç”¨äºæ³¨å†Œæˆ–å¿˜è®°å¯†ç ã€‚

**æŸ¥è¯¢å‚æ•°:**

| å‚æ•°    | ç±»å‹   | æ˜¯å¦å¿…é¡» | æè¿°                   |
| :------ | :----- | :------- | :--------------------- |
| `email` | String | æ˜¯       | æ¥æ”¶éªŒè¯ç çš„é‚®ç®±åœ°å€ã€‚ |

**å“åº”:**

```json
{
  "code": 200,
  "message": "éªŒè¯ç å·²å‘é€ï¼Œè¯·æ³¨æ„æŸ¥æ”¶",
  "data": null
}
```

#### **2.4. å¿˜è®°å¯†ç **

`POST /auth/forgot-password`

**æè¿°:** ç”¨æˆ·é€šè¿‡é‚®ç®±éªŒè¯ç é‡ç½®å¯†ç ã€‚

**è¯·æ±‚ä½“:** `@RequestBody AuthForgotPasswordReq`

```json
{
  "username": "john_doe",
  "email": "john@example.com",
  "vcode": "123456",
  "new_password": "new_secure_password",
  "confirm_password": "new_secure_password"
}
```

**å“åº”:**

```json
{
  "code": 200,
  "message": "å¯†ç é‡ç½®æˆåŠŸ",
  "data": null
}
```

#### **2.5. è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯**

`GET /auth/me`

**æè¿°:** è·å–å½“å‰ç™»å½•ç”¨æˆ·çš„ä¿¡æ¯ï¼Œç”¨äºâ€œè®¾ç½®â€é¡µé¢å±•ç¤ºã€‚

**å“åº”:** `AuthCurrentUserResp`

```json
{
  "code": 200,
  "message": "è·å–ç”¨æˆ·ä¿¡æ¯æˆåŠŸ",
  "data": {
    "username": "john_doe",
    "email": "john@example.com",
    "avatar": "https://r2.liteisle.com/pictures/12345.jpg",
    "storage_used": 2147483648,
    "storage_quota": 5368709120
  }
}
```

> **å¤‡æ³¨:** `storage_used` å’Œ `storage_quota` å•ä½ä¸ºå­—èŠ‚ (bytes)ã€‚

#### **2.6. ä¿®æ”¹å½“å‰ç”¨æˆ·å¯†ç **

`POST /auth/me/reset-password`

**æè¿°:** ç™»å½•çŠ¶æ€ä¸‹ï¼Œç”¨æˆ·é€šè¿‡æ—§å¯†ç ä¿®æ”¹æ–°å¯†ç ã€‚

**è¯·æ±‚ä½“:** `@RequestBody AuthResetPasswordReq`

```json
{
  "old_password": "your_strong_password",
  "new_password": "new_secure_password",
  "confirm_password": "new_secure_password"
}
```

**å“åº”:**

```json
{
  "code": 200,
  "message": "å¯†ç ä¿®æ”¹æˆåŠŸ",
  "data": null
}
```

#### **2.7. ä¸Šä¼ å½“å‰ç”¨æˆ·å¤´åƒ**

`POST /auth/me/picture`

**æè¿°:** ä¸Šä¼ å¹¶æ›´æ–°å½“å‰ç”¨æˆ·çš„å¤´åƒã€‚

**è¯·æ±‚ä½“:** `multipart/form-data`

| å­—æ®µå | ç±»å‹ | æè¿°                     |
| :----- | :--- | :----------------------- |
| `file` | File | ç”¨æˆ·é€‰æ‹©çš„å¤´åƒå›¾ç‰‡æ–‡ä»¶ã€‚ |

**å“åº”:** 

```json
{
  "code": 200,
  "message": "å¤´åƒä¸Šä¼ æˆåŠŸ",
  "data": "https://r2.liteisle.com/pictures/67890.jpg"
}
```

#### **2.8. é‡ç½®å½“å‰ç”¨æˆ·å¤´åƒ**

`PUT /auth/me/reset-picture`

**æè¿°:** å°†å½“å‰ç”¨æˆ·çš„å¤´åƒé‡ç½®ä¸ºç³»ç»Ÿé»˜è®¤å¤´åƒã€‚

**è¯·æ±‚ä½“:** æ— 

**å“åº”:** 

```json
{
  "code": 200,
  "message": "å¤´åƒå·²é‡ç½®",
  "data": "https://r2.liteisle.com/pictures/default.png"
}
```

#### **2.9. é€€å‡ºç™»å½•**

`POST /auth/logout`

**æè¿°:** åç«¯æ¸…é™¤ç”¨æˆ·è®¤è¯å‡­è¯ã€‚å‰ç«¯åº”é…åˆåˆ é™¤æœ¬åœ°å­˜å‚¨çš„Tokenã€‚

**è¯·æ±‚ä½“:** æ— 

**å“åº”:**

```json
{
  "code": 200,
  "message": "å·²æˆåŠŸé€€å‡ºç™»å½•",
  "data": null
}
```

---

### **3. æ–‡ä»¶ä¸æ–‡ä»¶å¤¹ (File & Folder)**

#### **3.1. è·å–æŒ‡å®šæ–‡ä»¶å¤¹å†…å®¹**

`GET /folders/{folder_id}`

**æè¿°:** è·å–æŒ‡å®šæ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å¤¹å’Œæ–‡ä»¶åˆ—è¡¨ã€‚è¿™æ˜¯äº‘ç›˜ä¸»ç•Œé¢çš„æ ¸å¿ƒæ¥å£ã€‚

**è·¯å¾„å‚æ•°:**

| å‚æ•°        | ç±»å‹ | æè¿°                                   |
| :---------- | :--- | :------------------------------------- |
| `folder_id` | Long | æ–‡ä»¶å¤¹IDã€‚**ç‰¹åˆ«åœ°ï¼Œ`0` ä»£è¡¨æ ¹ç›®å½•**ã€‚ |

**æŸ¥è¯¢å‚æ•°:**

| å‚æ•°         | ç±»å‹   | æ˜¯å¦å¿…é¡» | æè¿°                                                         |
| :----------- | :----- | :------- | :----------------------------------------------------------- |
| `sort_by`    | String | å¦       | æ’åºå­—æ®µï¼Œå¯é€‰å€¼: `name`, `file_size`, `create_time`, `update_time`, `sorted_order` (é»˜è®¤) |
| `sort_order` | String | å¦       | æ’åºé€‰é¡¹ï¼Œå¯é€‰`ASC`,`DEC`é»˜è®¤`DEC`                           |
| `content`    | String | å¦       | åŒ¹é…æ–‡ä»¶/æ–‡ä»¶å¤¹åå­—å­—æ®µ                                      |

**å“åº”:** `FolderContentResp`

```json
{
  "code": 200,
  "message": "è·å–åˆ—è¡¨æˆåŠŸ",
  "data": {
      "breadcrumb": [
  	{ 
        "id": 1, 
        "name": "æ–‡æ¡£" 
    }
	],
    "folders": [
      {
        "id": 101,
        "folder_name": "æˆ‘çš„æ–‡æ¡£",
        "folder_type": "booklist",//æšä¸¾ FolderTypeEnum
        "sub_count": 3,
        "sorted_order": 1704186000000.123124124124,
        "create_time": "2024-01-02T09:00:00Z",
        "update_time": "2024-01-02T10:30:00Z"
      }
    ],
    "files": [
      {
        "id": 201,
        "file_name": "é¡¹ç›®æŠ¥å‘Š.pdf",
        "file_type": "document",//æšä¸¾ FileTypeEnum
        "file_size": 2097152,
        "file_status": "available",//æšä¸¾ FileStatusEnum
        "sorted_order": 1704186000321000.123124124124,
        "create_time": "2024-01-02T09:00:00Z",
        "update_time": "2024-01-02T09:00:00Z"
      },
      {
        "id": 202,
        "file_name": "ä¸´æ—¶å½•éŸ³.mp3",
        "file_type": "music",
        "file_size": 0,
        "file_status": "processing",
        "sorted_order": 1704186002140000.123124124124,
        "create_time": "2024-01-02T09:10:00Z",
        "update_time": "2024-01-02T09:10:00Z"
      }
    ]
  }
}
```

> **å¤‡æ³¨:**
>
> * `folder_type`: æšä¸¾ `system`(ç³»ç»Ÿ), `playlist`(æ­Œå•), `booklist`(ç¬”è®°æœ¬)ã€‚
> * `file_type`: æšä¸¾ `music`, `document` ç­‰ã€‚
> * `status`: æ–‡ä»¶çŠ¶æ€ï¼Œ`available` (å¯ç”¨), `processing` (å¤„ç†ä¸­)ã€‚å‰ç«¯åº”æ ¹æ®æ­¤çŠ¶æ€æ˜¾ç¤ºä¸åŒUIã€‚
> * `sub_item_count`: æ–‡ä»¶å¤¹ä¸‹å­é¡¹ç›®çš„æ•°é‡ï¼ˆæ–‡ä»¶+æ–‡ä»¶å¤¹ï¼‰ã€‚
> * **WebSocket äº¤äº’**: å½“ `status` ä¸º `processing` çš„æ–‡ä»¶å¤„ç†å®Œæˆæ—¶ï¼ŒæœåŠ¡å™¨å°†é€šè¿‡WebSocketæ¨é€ `file.status.updated` äº‹ä»¶ï¼Œå‰ç«¯åº”ç›‘å¬æ­¤äº‹ä»¶å¹¶æ›´æ–°å¯¹åº”æ–‡ä»¶çš„UIï¼Œæ— éœ€é‡æ–°æ‹‰å–æ•´ä¸ªåˆ—è¡¨ã€‚

#### **3.2. åˆ›å»ºæ–‡ä»¶å¤¹**

`POST /folders`

**æè¿°:** åœ¨æŒ‡å®šçš„çˆ¶æ–‡ä»¶å¤¹ä¸‹åˆ›å»ºæ–°æ–‡ä»¶å¤¹ã€‚

**è¯·æ±‚ä½“:** `@RequestBody FolderCreateReq`

```json
{
  "name": "æ–°å»ºæ–‡ä»¶å¤¹",
  "parent_id": 101,
  "folder_type": "playlist" // æ˜ç¡®æŒ‡å®šç±»å‹ FolderTypeEnum
}
```

> **æ³¨æ„:** `parent_id` ä¸èƒ½ä¸º `0`ï¼Œæ ¹ç›®å½•ä¸‹ä¸å…è®¸ç”¨æˆ·ç›´æ¥åˆ›å»ºæ–‡ä»¶å¤¹ï¼Œç³»ç»Ÿæ–‡ä»¶å¤¹ç”±ç³»ç»Ÿç®¡ç†ã€‚

**å“åº”:** 

```json
{
  "code": 200,
  "message": "æ–‡ä»¶å¤¹åˆ›å»ºæˆåŠŸ",
  "data": null
}
```

#### **3.3. é‡å‘½åé¡¹ç›® (æ–‡ä»¶/æ–‡ä»¶å¤¹)**

`PUT /items/rename`

**æè¿°:**
é‡å‘½åä¸€ä¸ªæŒ‡å®šç±»å‹ï¼ˆæ–‡ä»¶æˆ–æ–‡ä»¶å¤¹ï¼‰çš„é¡¹ç›®ã€‚

**è¯·æ±‚ä½“:** `@RequestBody ItemsRenameReq`

```json
{
  //å‰ç«¯å‘é€id
  "file_id": null,
  "folder_id": 3,
  "new_name": "æ–°çš„é¡¹ç›®åç§°.mp3" 
}
```

**å“åº”:**

```json
{
  "code": 200,
  "message": "é‡å‘½åæˆåŠŸ",
  "data": null
}
```

#### **3.4. ç§»åŠ¨é¡¹ç›® (æ–‡ä»¶/æ–‡ä»¶å¤¹)**

`PUT /items/move`

**æè¿°:** å°†ä¸€ä¸ªæˆ–å¤šä¸ªæ–‡ä»¶/æ–‡ä»¶å¤¹ç§»åŠ¨åˆ°æ–°çš„ç›®æ ‡æ–‡ä»¶å¤¹ã€‚

**è¯·æ±‚ä½“:** `@RequestBody ItemsOperationReq`

```json
{
  "file_ids": [201],
  "folder_ids": [102],
  "target_folder_id": 3
}
```

**å“åº”:**

```json
{
  "code": 200,
  "message": "ç§»åŠ¨æˆåŠŸ",
  "data": null
}
```

#### **3.5. åˆ é™¤é¡¹ç›® (ç§»å…¥å›æ”¶ç«™)**

`DELETE /items`

**æè¿°:** å°†ä¸€ä¸ªæˆ–å¤šä¸ªæ–‡ä»¶/æ–‡ä»¶å¤¹ç§»å…¥å›æ”¶ç«™ï¼ˆè½¯åˆ é™¤ ä¸å½±å“ç”¨æˆ·é¢åº¦ï¼‰ã€‚

**è¯·æ±‚ä½“:** `@RequestBody ItemsDeleteReq `

```json
{
  "file_ids": [201],
  "folder_ids": [102]
}
```

**å“åº”:**

```json
{
  "code": 200,
  "message": "å·²å°† 2 ä¸ªé¡¹ç›®ç§»å…¥å›æ”¶ç«™",
  "data": null
}
```

#### **3.6. è·å–é¡¹ç›®è¯¦æƒ… (æ–‡ä»¶/æ–‡ä»¶å¤¹)**

`GET /items/{item_id}/detail`

**æè¿°:** è·å–å•ä¸ªæ–‡ä»¶æˆ–æ–‡ä»¶å¤¹çš„è¯¦ç»†ä¿¡æ¯ã€‚

**è·¯å¾„å‚æ•°:**

| å‚æ•°    | ç±»å‹ | æè¿°                |
| ------- | ---- | ------------------- |
| item_id | Long | æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹çš„ IDã€‚ |

è¯·æ±‚å‚æ•°:

| å‚æ•°      | ç±»å‹   | æè¿°           |
| --------- | ------ | -------------- |
| item_type | String | fileæˆ–è€…folder |

**å“åº”:** `ItemDetailResp` (è¿”å›ç»Ÿä¸€ç»“æ„ï¼Œé€šè¿‡ item_type åŒºåˆ†)

```json
{
  "code": 200,
  "message": "è·å–è¯¦æƒ…æˆåŠŸ",
  "data": {
    "id": 201,
    "name": "é¡¹ç›®æŠ¥å‘Š.pdf",
    "item_type": "file", // "file" æˆ– "folder" ItemTypeæšä¸¾ç±»
    "size": 2097152, // æ–‡ä»¶å¤¹æ­¤é¡¹ä¸º 0 æˆ–å…¶å†…å®¹ä¸ªæ•°
    "path": "/æˆ‘çš„æ–‡æ¡£/é¡¹ç›®æŠ¥å‘Š.pdf",
    "create_time": "2024-01-02T09:00:00Z",
    "update_time": "2024-01-02T09:00:00Z"
  }
}
```

#### **3.7. è·å–æ‰€æœ‰æ–‡ä»¶å¤¹å±‚çº§ (ç”¨äºç§»åŠ¨å¯¹è¯æ¡†)**

`GET /folders/hierarchy`

**æè¿°:** è·å–ç”¨æˆ·æ‰€æœ‰æ–‡ä»¶å¤¹çš„æ ‘çŠ¶å±‚çº§ç»“æ„ï¼Œç”¨äºâ€œç§»åŠ¨åˆ°...â€åŠŸèƒ½çš„å¯¹è¯æ¡†ã€‚

**å“åº”:** `List<FolderHierarchyResp>`

```json
{
  "code": 200,
  "message": "è·å–æ–‡ä»¶å¤¹å±‚çº§æˆåŠŸ",
  "data": [
    {
      "id": 1,
      "folder_name": "éŸ³ä¹",
      "folder_type": "system", //FolderTypeEnum
      "parent_id": 0
    },
    {
      "id": 3,
      "folder_name": "æˆ‘å–œæ¬¢çš„éŸ³ä¹",
      "folder_type": "playlist",
      "parent_id": 1
    },
    {
      "id": 101,
      "folder_name": "æˆ‘çš„æ–‡æ¡£",
      "folder_type": "booklist",
      "parent_id": 0
    }
  ]
}
```

> **å¤‡æ³¨:** `parent_id` ä¸º `0` ä»£è¡¨æ ¹ç›®å½•ä¸‹çš„æ–‡ä»¶å¤¹ã€‚

#### **3.8. å¤åˆ¶é¡¹ç›® (æ–‡ä»¶/æ–‡ä»¶å¤¹)**

`POST /items/copy`

**æè¿°:** å°†ä¸€ä¸ªæˆ–å¤šä¸ªæ–‡ä»¶/æ–‡ä»¶å¤¹å¤åˆ¶åˆ°æ–°çš„ç›®æ ‡æ–‡ä»¶å¤¹ï¼ˆå½±å“ç”¨æˆ·é¢åº¦ï¼‰ã€‚

**è¯·æ±‚ä½“:** `@RequestBody ItemsOperationReq`

```json
{
  "file_ids": [201],
  "folder_ids": [102],
  "target_folder_id": 3
}
```

**å“åº”:**

```Json
{
  "code": 200,
  "message": "å¤åˆ¶æˆåŠŸ",
  "data": null
}
```

#### **3.9. è‡ªå®šä¹‰æ’åº (æ–‡ä»¶/æ–‡ä»¶å¤¹)**

`PUT /items/{item_id}/set-order` 

**æè¿°:** åœ¨ç‰¹å®šè§†å›¾ï¼ˆå¦‚éŸ³ä¹é¡µé¢ã€æ–‡æ¡£é¡µé¢ï¼‰ä¸­æ‹–æ‹½é¡¹ç›®ï¼ˆæ­Œæ›²ã€æ–‡æ¡£ã€æ­Œå•ã€ç¬”è®°æœ¬ï¼‰è¿›è¡Œæ’åºã€‚

è¯·æ±‚å‚æ•°:

| å‚æ•°      | ç±»å‹   | æè¿°           |
| --------- | ------ | -------------- |
| item_type | String | fileæˆ–è€…folder |

**è·¯å¾„å‚æ•°:**

| å‚æ•°    | ç±»å‹ | æè¿°                        |
| ------- | ---- | --------------------------- |
| item_id | Long | è¦ç§»åŠ¨çš„æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹çš„ IDã€‚ |

**è¯·æ±‚ä½“:** `@RequestBody SetOrderReq`

```Json
{
  // æä¾›è¢«ç§»åŠ¨åˆ°çš„ä½ç½®ï¼Œå…¶å‰ä¸€ä¸ªå’Œåä¸€ä¸ªé¡¹ç›®çš„sorted_orderå€¼
  // å¦‚æœç§»åˆ°æœ€å‰ï¼Œafter_orderä¸ºnullï¼›å¦‚æœç§»åˆ°æœ€åï¼Œbefore_orderä¸ºnull
  "before_id": 3,
  "after_id": 6
}
```

**å“åº”:**

```Json
{
  "code": 200,
  "message": "æ’åºå·²æ›´æ–°",
  "data": null
}
```

---

### 4. æ–‡ä»¶ä¸Šä¼ ä¸ä¸‹è½½

#### 4.1. ä¸Šä¼ æ–‡ä»¶ (å¼‚æ­¥å¤„ç†)

`POST /upload`

> **è¯´æ˜**: å¦‚æœfolder_idä¸º0åˆ™æ˜¯ä¸ºä¼ è¾“é¡µé¢çš„ä¸Šä¼ ä»»åŠ¡ï¼Œåç«¯è‡ªåŠ¨è·å–å½“å‰ç”¨æˆ·çš„ä¸Šä¼ ç³»ç»Ÿæ–‡ä»¶å¤¹idå­˜å…¥

**æè¿°:** æ¥æ”¶æ–‡ä»¶å¹¶ç«‹å³è¿”å›ï¼Œå°†è€—æ—¶çš„æ–‡ä»¶å¤„ç†ï¼ˆå¦‚å…ƒæ•°æ®æå–ï¼‰äº¤ç”±åå°å¼‚æ­¥å®Œæˆã€‚.md æ–‡æ¡£å°†ç›´æ¥å­˜å‚¨æ–‡æœ¬å†…å®¹åˆ°æ•°æ®åº“ï¼Œæ— éœ€ä¸Šä¼ åˆ°å¯¹è±¡å­˜å‚¨ï¼ˆå½±å“ç”¨æˆ·é¢åº¦ï¼‰ã€‚

**è¯·æ±‚ä½“:** `multipart/form-data`

| å­—æ®µå | ç±»å‹ | æ˜¯å¦å¿…é¡» | æè¿°           |
| :----- | :--- | :------- | :------------- |
| `file` | File | æ˜¯       | è¦ä¸Šä¼ çš„æ–‡ä»¶ã€‚ |

è¯·æ±‚å‚æ•°

| å­—æ®µå      | ç±»å‹ | æ˜¯å¦å¿…é¡» | æè¿°                           |
| :---------- | :--- | :------- | :----------------------------- |
| `folder_id` | Long | æ˜¯       | ç”¨æˆ·è‡ªå®šä¹‰è¦ä¸Šä¼ åˆ°çš„æ–‡ä»¶å¤¹idã€‚ |

**å“åº” (å¿«é€Ÿè¿”å›):** `FileUploadAsyncResp`

```json
{
  "code": 202,
  "message": "æ–‡ä»¶å·²æ¥æ”¶ï¼Œæ­£åœ¨åå°å¤„ç†",
  "data": {
    "log_id": 123, // âœ¨ æ–°å¢
    "file_id": 203,
    "log_status": "processing",//æšä¸¾ logçŠ¶æ€TransferStatusEnum
    "initial_file_data": {
        "id": 203,
        "name": "æ™´å¤©.mp3",
        "file_type": "music",//æšä¸¾ æ–‡ä»¶ç±»å‹ 
        "file_status": "processing",  //
        "sorted_order": 1704186900000.19712414,
        "create_time": "2024-01-02T09:15:00Z",
        "update_time": "2024-01-02T09:15:00Z"
    }
  }
}
```

> **æµç¨‹è¯´æ˜:**
>
> 1. å‰ç«¯æ”¶åˆ°æ­¤ `202 Accepted` å“åº”åï¼Œåº”ç«‹å³ä½¿ç”¨ `initial_file_data` åœ¨UIä¸­æ¸²æŸ“å‡ºæ–‡ä»¶æ¡ç›®ï¼Œå¹¶æ˜¾ç¤ºä¸ºâ€œå¤„ç†ä¸­â€çŠ¶æ€ã€‚
> 2. åç«¯Workerå¤„ç†å®Œæ¯•åï¼Œä¼šé€šè¿‡ WebSocket æ¨é€ä¸€ä¸ª `file.status.updated` äº‹ä»¶ã€‚
> 3. å‰ç«¯ç›‘å¬æ­¤äº‹ä»¶ï¼Œæ ¹æ® `file_id` æ‰¾åˆ°å¯¹åº”çš„UIå…ƒç´ ï¼Œå¹¶ä½¿ç”¨äº‹ä»¶ `payload` ä¸­çš„å®Œæ•´æ•°æ®æ›´æ–°è¯¥æ–‡ä»¶ï¼Œå°†å…¶çŠ¶æ€æ›´æ–°ä¸º `available`ã€‚
> 4. **åç«¯èŒè´£è¯´æ˜**:
>    æœåŠ¡å™¨åœ¨æ–‡ä»¶å¤„ç†å®Œæ¯•åï¼ˆå¦‚å…ƒæ•°æ®æå–å®Œæˆï¼‰ï¼Œåº”**è‡ªåŠ¨æ›´æ–°**å…³è”çš„ä¼ è¾“æ—¥å¿—(transfer_log)çŠ¶æ€ä» processing åˆ° success æˆ– failedã€‚å‰ç«¯æ— éœ€å†æ¬¡è°ƒç”¨æ¥å£æ¥æ›´æ–°ä¸Šä¼ ä»»åŠ¡çš„çŠ¶æ€ã€‚çŠ¶æ€å˜æ›´ä¼šé€šè¿‡ WebSocket (transfer.log.updated) æ¨é€ç»™å®¢æˆ·ç«¯ã€‚

#### **4.2. ä¸‹è½½æ–‡ä»¶ (å…¨æ–°ç®€åŒ–æµç¨‹)**

`POST /download/create`

> æ³¨æ„ï¼šä¸‹è½½æ ¹ç›®å½•æ–‡ä»¶å¤¹å¦‚æ­Œå•ï¼Œéœ€è¦å‰ç«¯æä¾›å¤šä¸ªå­æ–‡ä»¶å¤¹ï¼Œåç«¯å®ç°ï¼šä¸€çº§æ–‡ä»¶å¤¹/äºŒçº§æ–‡ä»¶å¦‚ï¼šæ­Œå•/æˆ‘å–œæ¬¢çš„ ä»¥åŠ æ­Œå•/æˆ‘å–œæ¬¢çš„/ä¸œé£ç ´.mp3 

**æè¿°:** æ‰€æœ‰**ä¸‹è½½åˆ°æœ¬åœ°**æ“ä½œçš„**å”¯ä¸€å…¥å£**ã€‚å®¢æˆ·ç«¯æäº¤è¦ä¸‹è½½çš„é¡¹ç›®ï¼Œåç«¯è´Ÿè´£ï¼š

1. é€’å½’è§£ææ‰€æœ‰æ–‡ä»¶ã€‚
2. ä¸ºæ¯ä¸ªä¸‹è½½ä»»åŠ¡**è‡ªåŠ¨åˆ›å»ºä¼ è¾“æ—¥å¿—è®°å½•**ã€‚
3. ä¸ºæ¯ä¸ªæ–‡ä»¶ç”Ÿæˆå¸¦ç­¾åçš„ä¸‹è½½URLã€‚
4. å°†åŒ…å«æ‰€æœ‰å¿…è¦ä¿¡æ¯çš„å®Œæ•´æ¸…å•ä¸€æ¬¡æ€§è¿”å›ç»™å®¢æˆ·ç«¯ã€‚

**è¯·æ±‚ä½“:** `@RequestBody ItemsSelectionReq`

```json
// ä¸‹è½½å•ä¸ªæ–‡ä»¶ã€å¤šä¸ªæ–‡ä»¶ã€ä¸€ä¸ªæ–‡ä»¶å¤¹
// ä¾‹ï¼šå‰ç«¯æ¡†é€‰ æ–‡ä»¶å¤¹3ã€æ–‡ä»¶å¤¹4ã€æ–‡ä»¶6ï¼Œè§¦å‘ä¸‰æ¬¡è¯·æ±‚åˆ†åˆ«ä¸ºæ–‡ä»¶å¤¹3ã€æ–‡ä»¶å¤¹4ã€æ–‡ä»¶6.
//  å¦‚æœå‰ç«¯é€‰æ‹© æ–‡ä»¶456åˆ™è§¦å‘ä¸€æ¬¡è¯·æ±‚
{
  "file_ids": [201, 202, 203],
  "folder_id": null  // å•ä¸ªæ–‡ä»¶å¤¹ID
}
```

**å“åº”:** `DownloadSessionResp`

```json
{
  "code": 200,
  "message": "ä¸‹è½½ä¼šè¯åˆ›å»ºæˆåŠŸ",
  "data": {
    "total_size": 31457280,
    "total_files": 5,
    "folder_d": {
        "folder_id": 3,
        "folder_name": "æ–‡æ¡£",
        "relative_path": "æˆ‘çš„é¡¹ç›®/æ–‡æ¡£" 
    },
    "files_d": [
      {
        "log_id": 123, // âœ¨ åç«¯åˆ›å»ºçš„æ—¥å¿—ID
        "file_id": 202,
        "file_name": "ä¼šè®®è®°å½•.docx",
        "relative_path": "æˆ‘çš„é¡¹ç›®/æ–‡æ¡£/ä¼šè®®è®°å½•.docx",
        "size": 20480,
        "download_url": "https://r2.liteisle.com/downloads/a1b2...?token=..." // âœ¨ ç›´æ¥è¿”å›URL
      },
      {
        "log_id": 124,
        "file_id": 201,
        "file_name": "å°é¢å›¾.pdf",
        "relative_path": "æˆ‘çš„é¡¹ç›®/æ–‡æ¡£/å°é¢å›¾.pdf",
        "size": 512000,
        "download_url": "https://r2.liteisle.com/downloads/b2c3...?token=..."
      }
      // ...æ›´å¤šæ–‡ä»¶
    ]
  }
}
```

```json
{
  "code": 200,
  "message": "ä¸‹è½½ä¼šè¯åˆ›å»ºæˆåŠŸ",
  "data": {
    "total_size": 512000,
    "total_files": 1,
    "folder_d": null,  // å•ä¸ªæ–‡ä»¶ä¸‹è½½æ—¶æ— æ–‡ä»¶å¤¹ä¿¡æ¯
    "files_d": [
      {
        "log_id": 124,
        "file_id": 201,
        "relative_path": "å°é¢å›¾.jpg",  // æ— çˆ¶æ–‡ä»¶å¤¹ï¼Œç›´æ¥ä¸ºæ–‡ä»¶å
        "size": 512000,
        "download_url": "https://r2.liteisle.com/downloads/b2c3...?token=..."
      }
    ]
  }
}
```

1. å‰ç«¯è¯·æ±‚ï¼šåˆ†ä¸ºå•ä¸ªæ–‡ä»¶å¤¹/æ–‡ä»¶è¯·æ±‚ã€‚
2. **æ‰§è¡Œä¸‹è½½**ï¼šå®¢æˆ·ç«¯æ”¶åˆ° DownloadSessionResp åï¼Œéå† items æ•°ç»„ã€‚
   - å¦‚æœ type æ˜¯ directoryï¼Œåˆ™åœ¨æœ¬åœ°åˆ›å»ºå¯¹åº”ç›®å½•ã€‚
   - å¦‚æœ type æ˜¯ fileï¼Œåˆ™ä½¿ç”¨æä¾›çš„ download_url ä¸‹è½½æ–‡ä»¶åˆ° relative_pathã€‚
3. **æ›´æ–°çŠ¶æ€**ï¼šåœ¨æ¯ä¸ªæ–‡ä»¶ä¸‹è½½ç»“æŸæ—¶ï¼ˆæˆåŠŸã€å¤±è´¥ã€å–æ¶ˆï¼‰ï¼Œå®¢æˆ·ç«¯è°ƒç”¨ PUT /transfers/{log_id}/status (è§ 5.5 èŠ‚) æ¥æ›´æ–°è¯¥ä»»åŠ¡çš„æœ€ç»ˆçŠ¶æ€ã€‚

### **5. ä¼ è¾“ç®¡ç† (Transfer Management)**

#### **5.1. è·å–ä¼ è¾“ä»»åŠ¡æ‘˜è¦**

`GET /transfers/summary`

**æè¿°:** è·å–æ­£åœ¨è¿›è¡Œä¸­çš„ä¸Šä¼ å’Œä¸‹è½½ä»»åŠ¡æ€»æ•°ï¼Œç”¨äºä¾§è¾¹æ è§’æ ‡æ˜¾ç¤ºã€‚

**å“åº”:** `TransferSummaryResp`

```json
{
  "code": 200,
  "message": "è·å–æ‘˜è¦æˆåŠŸ",
  "data": {
    "upload_count": 2,
    "download_count": 1
  }
}
```

#### **5.2. è·å–ä¼ è¾“å†å²è®°å½•**

`GET /transfers`

**æè¿°:** åˆ†é¡µè·å–ä¼ è¾“è®°å½•ï¼Œç”¨äºâ€œä¼ è¾“åˆ—è¡¨â€é¡µé¢ã€‚

**æŸ¥è¯¢å‚æ•°:**

| å‚æ•°     | ç±»å‹    | æ˜¯å¦å¿…é¡» | æè¿°                                                         |
| :------- | :------ | :------- | :----------------------------------------------------------- |
| `status` | String  | æ˜¯       | `processing`: è¿›è¡Œä¸­, `completed`: å·²å®Œæˆ(å«æˆåŠŸå’Œå¤±è´¥)å¯¹åº”ä¸¤ä¸ªé¡µé¢ï¼ˆè¿›è¡Œä¸­å’Œå·²å®Œæˆï¼‰ã€‚ |
| `page`   | Integer | å¦       | é¡µç ï¼Œé»˜è®¤ 1ã€‚                                               |
| `size`   | Integer | å¦       | æ¯é¡µæ•°é‡ï¼Œé»˜è®¤ 20ã€‚                                          |

**å“åº”:** `TransferLogPageResp`

```json
{
  "code": 200,
  "message": "è·å–ä¼ è¾“è®°å½•æˆåŠŸ",
  "data": {
    "total": 25,
    "current_page": 1,
    "page_size": 20,
    "records": [
      {
        "log_id": 1,
        "item_name": "é¡¹ç›®æŠ¥å‘Š.pdf",
        "item_size": 2097152,
        "transfer_type": "upload", //TransferTypeEnum
        "create_time": "2024-07-25T10:00:00Z"
      },
      {
        "log_id": 2,
        "item_name": "æ™´å¤©.mp3",
        "item_size": 5242880,
        "transfer_type": "upload",//TransferTypeEnum
        "create_time": "2024-07-25T09:55:00Z"
      }
    ]
  }
}
```

#### 5.3. åˆ é™¤å·²å®Œæˆçš„å•æ¡ä¼ è¾“è®°å½•

`DELETE /transfers/{log_id}`

**æè¿°:** ä»ä¼ è¾“åˆ—è¡¨ä¸­åˆ é™¤ä¸€æ¡è®°å½•ï¼ˆå¦‚æœé€‰æ‹©åˆ é™¤æ–‡ä»¶ä¹Ÿæ˜¯è½¯åˆ é™¤ ä¸å½±å“ç”¨æˆ·é¢åº¦ï¼‰ã€‚

**è·¯å¾„å‚æ•°:**

| å‚æ•°     | ç±»å‹ | æè¿°                 |
| :------- | :--- | :------------------- |
| `log_id` | Long | è¦åˆ é™¤çš„ä¼ è¾“è®°å½•IDã€‚ |

**æŸ¥è¯¢å‚æ•°:**

| å‚æ•°          | ç±»å‹    | æ˜¯å¦å¿…é¡» | æè¿°                                                 |
| :------------ | :------ | :------- | :--------------------------------------------------- |
| `delete_file` | Boolean | å¦       | æ˜¯å¦åŒæ—¶å°†å…³è”çš„æ–‡ä»¶ç§»å…¥å›æ”¶ç«™ã€‚**é»˜è®¤ä¸º `false`**ã€‚ |

**å“åº”:**

```json
{
  "code": 200,
  "message": "ä¼ è¾“è®°å½•å·²åˆ é™¤",
  "data": null
}
```

#### 5.4. æ¸…ç©ºå·²å®Œæˆçš„ä¼ è¾“è®°å½•

`DELETE /transfers/completed`

**æè¿°:** æ¸…ç©ºæ‰€æœ‰å·²å®Œæˆï¼ˆæˆåŠŸæˆ–å¤±è´¥ï¼‰çš„ä¼ è¾“è®°å½•ã€‚**æ­¤æ“ä½œä»…åˆ é™¤æ—¥å¿—ï¼Œä¸å½±å“å®é™…æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰**ã€‚æ³¨æ„å¯¹äºä¸‹è½½è®°å½•åªåˆ é™¤è®°å½•ï¼ˆå¦‚æœé€‰æ‹©åˆ é™¤æ–‡ä»¶ä¹Ÿæ˜¯è½¯åˆ é™¤ ä¸å½±å“ç”¨æˆ·é¢åº¦ï¼‰ã€‚

**æŸ¥è¯¢å‚æ•°:**

| å‚æ•°          | ç±»å‹    | æ˜¯å¦å¿…é¡» | æè¿°                                                 |
| :------------ | :------ | :------- | :--------------------------------------------------- |
| `delete_file` | Boolean | å¦       | æ˜¯å¦åŒæ—¶å°†å…³è”çš„æ–‡ä»¶ç§»å…¥å›æ”¶ç«™ã€‚**é»˜è®¤ä¸º `false`**ã€‚ |

**å“åº”:**

```json
{
  "code": 200,
  "message": "å·²æ¸…ç©º23æ¡å·²å®Œæˆçš„è®°å½•",
  "data": null
}
```

#### ï¼5.5. å–æ¶ˆä¸Šä¼ ä»»åŠ¡

`POST /transfers/upload/{log_id}/cancel`

**æè¿°:** å–æ¶ˆä¸€ä¸ªæ­£åœ¨è¿›è¡Œçš„ä¸Šä¼ ä»»åŠ¡ã€‚æ­¤æ“ä½œä¼šä¸­æ–­æ–‡ä»¶ä¼ è¾“ï¼Œå¹¶æ¸…ç†æœåŠ¡å™¨ä¸Šå·²æ¥æ”¶çš„è¯¥æ–‡ä»¶çš„ä¸´æ—¶æ•°æ®ï¼ˆæ¢å¤ç”¨æˆ·é¢åº¦ï¼‰ã€‚

**è·¯å¾„å‚æ•°:**

| å‚æ•°     | ç±»å‹ | æè¿°                                                         |
| -------- | ---- | ------------------------------------------------------------ |
| `log_id` | Long | è¦å–æ¶ˆçš„ä¸Šä¼ ä»»åŠ¡çš„ä¼ è¾“æ—¥å¿—IDã€‚è¿™ä¸ªIDåœ¨è°ƒç”¨POST /uploadæˆ–POST /shares/saveæ—¶ï¼Œå¯ä»¥éšinitial_file_dataä¸€èµ·è¿”å›ï¼Œæˆ–è€…é€šè¿‡æŸ¥è¯¢ä¼ è¾“åˆ—è¡¨GET /transfersè·å–ã€‚ |

**å“åº”:**

```JSON
{
  "code": 200,
  "message": "ä¸Šä¼ ä»»åŠ¡å·²å–æ¶ˆ",
  "data": null
}
```

#### **5.6. æ›´æ–°ä¸‹è½½ä»»åŠ¡çŠ¶æ€ (èŒè´£æ˜ç¡®)**

`PUT /transfers/{log_id}/status`

**æè¿°:** ç”±**å®¢æˆ·ç«¯**åœ¨**ä¸‹è½½**ä»»åŠ¡ç»“æŸï¼ˆæˆåŠŸã€å¤±è´¥ã€å–æ¶ˆï¼‰åï¼Œæˆ–**ä»»ä½•ç”±å®¢æˆ·ç«¯å‘èµ·çš„å–æ¶ˆæ“ä½œ**åè°ƒç”¨ï¼Œä»¥æ›´æ–°å…¶åœ¨åç«¯çš„æ—¥å¿—çŠ¶æ€ã€‚

**è·¯å¾„å‚æ•°:**

| å‚æ•°   | ç±»å‹ | æè¿°             |
| ------ | ---- | ---------------- |
| log_id | Long | è¦æ›´æ–°çš„æ—¥å¿—IDã€‚ |

**è¯·æ±‚ä½“:** `@RequestBody TransferStatusUpdateReq`

```Json
{
  "log_status": "success", // "success", "failed", "canceled"
  "error_message": null,
  "transfer_duration_ms": 15000
}
```

**å“åº”:**

```Json
{ 
    "code": 200, 
    "message": "çŠ¶æ€æ›´æ–°æˆåŠŸ", 
    "data": null 
}
```

---

### **6. ç‰¹å®šè§†å›¾ (Special Views)**

æ­¤éƒ¨åˆ†APIä¸“ä¸ºç‰¹å®šçš„å‰ç«¯è§†å›¾ï¼ˆå¦‚éŸ³ä¹æ’­æ”¾å™¨ã€æ–‡æ¡£ç®¡ç†å™¨ï¼‰æä¾›èšåˆæ•°æ®ï¼Œä»¥ä¼˜åŒ–æ€§èƒ½å’Œç®€åŒ–å‰ç«¯é€»è¾‘ã€‚

#### **6.1. éŸ³ä¹è§†å›¾ (Music View)**

##### **6.1.1. è·å–éŸ³ä¹é¡µé¢ä¿¡æ¯**

`GET /music`

**æè¿°:** è·å–éŸ³ä¹é¡µé¢æ‰€éœ€çš„æ‰€æœ‰æ•°æ®ï¼ŒåŒ…æ‹¬æ‰€æœ‰æ’­æ”¾åˆ—è¡¨ï¼ˆPlaylistï¼‰å’Œå¯¹åº”æ’­æ”¾åˆ—è¡¨çš„éŸ³ä¹æ–‡ä»¶ã€‚æ­¤æ¥å£ç”¨äºé¡µé¢åˆå§‹åŒ–ï¼Œå‰ç«¯å¯å°†æ•°æ®å­˜å…¥çŠ¶æ€ç®¡ç†åº“ï¼ˆStoreï¼‰ã€‚

**æŸ¥è¯¢å‚æ•°:**

| å‚æ•°      | ç±»å‹   | æ˜¯å¦å¿…é¡» | æè¿°                                                       |
| :-------- | :----- | :------- | :--------------------------------------------------------- |
| `content` | String | å¦       | æœç´¢å…³é”®è¯ã€‚å¦‚æœæä¾›ï¼Œå°†è¿”å›ä¸å…³é”®è¯åŒ¹é…çš„æ’­æ”¾åˆ—è¡¨å’Œæ­Œæ›²ã€‚ |

**å“åº”:** `MusicViewResp`

```json
{
  "code": 200,
  "message": "è·å–éŸ³ä¹åˆ—è¡¨æˆåŠŸ",
  "data": {
    "playlists": [
      {
        "id": 101,
        "name": "æˆ‘å–œæ¬¢çš„éŸ³ä¹",
        "folder_type": "playlist",//enum
        "sorted_order": 1704186000000,
        "sub_count": 2
      }
    ],
    "files": [
      {
        "id": 205,
        "folder_id": 101,
        "file_name": "æ™´å¤©.mp3",
        "file_type": "music",//enum
        "sorted_order": 1704186100000,
        "artist": "å‘¨æ°ä¼¦",
        "album": "å¶æƒ ç¾",
        "duration": 269,
        "cover_art_url": "https://r2.liteisle.com/covers/yehuimei.jpg"
      },
      {
        "id": 206,
        "folder_id": 101,
        "file_name": "ç¨»é¦™.mp3",
        "file_type": "music",
        "sorted_order": 1704186200000,
        "artist": "å‘¨æ°ä¼¦",
        "album": "é­”æ°åº§",
        "duration": 223,
        "cover_art_url": "https://r2.liteisle.com/covers/mojiezuo.jpg"
      }
    ]
  }
}
```

> **å¤‡æ³¨:** `duration` å•ä½ä¸ºç§’ (seconds)ã€‚

##### **6.1.2. è·å–éŸ³ä¹æ’­æ”¾é“¾æ¥**

`GET /music/{file_id}/play`

**æè¿°:** è·å–æŒ‡å®šéŸ³ä¹æ–‡ä»¶çš„ä¸´æ—¶ã€å®‰å…¨çš„æ’­æ”¾æµé“¾æ¥ã€‚

**è·¯å¾„å‚æ•°:**

| å‚æ•°      | ç±»å‹ | æè¿°           |
| :-------- | :--- | :------------- |
| `file_id` | Long | éŸ³ä¹æ–‡ä»¶çš„IDã€‚ |

**å“åº”:** 

```json
{
  "code": 200,
  "message": "è·å–éŸ³ä¹é“¾æ¥æˆåŠŸ",
  "data": "https://r2.liteisle.com/music/asdqwd.mp3?token=..."
}
```

#### **6.2. æ–‡æ¡£è§†å›¾ (Document View)**

##### **6.2.1. è·å–æ–‡æ¡£é¡µé¢ä¿¡æ¯**

`GET /documents`

**æè¿°:** è·å–æ–‡æ¡£é¡µé¢æ‰€éœ€çš„æ‰€æœ‰æ•°æ®ï¼ŒåŒ…æ‹¬æ‰€æœ‰ç¬”è®°æœ¬ï¼ˆbooklistï¼‰å’Œæ‰€æœ‰æ–‡æ¡£æ–‡ä»¶ã€‚

**æŸ¥è¯¢å‚æ•°:**

| å‚æ•°      | ç±»å‹   | æ˜¯å¦å¿…é¡» | æè¿°                                                     |
| :-------- | :----- | :------- | :------------------------------------------------------- |
| `content` | String | å¦       | æœç´¢å…³é”®è¯ã€‚å¦‚æœæä¾›ï¼Œå°†è¿”å›ä¸å…³é”®è¯åŒ¹é…çš„ç¬”è®°æœ¬å’Œæ–‡æ¡£ã€‚ |

**å“åº”:** `DocumentViewResp`

```json
{
  "code": 200,
  "message": "è·å–æ–‡æ¡£åˆ—è¡¨æˆåŠŸ",
  "data": {
    "booklists": [
      {
        "id": 301,
        "folder_name": "ä¼šè®®çºªè¦",
        "folder_type": "booklist",//enum
        "sorted_order": 1704187000000.83278441,
        "sub_count": 1
      }
    ],
    "files": [
      {
        "id": 401,
        "folder_id": 301,
        "file_name": "3-18å‘¨ä¼š.md",
        "file_type": "document",//enum
        "sorted_order": 1704187100000.8712367812412
      },
      {
        "id": 402,
        "folder_id": 301,
        "file_name": "äº§å“éœ€æ±‚æ–‡æ¡£.pdf",
        "file_type": "document",
        "sorted_order": 170134187200000.123124
      }
    ]
  }
}
```

##### **6.2.2. è·å–é MD æ–‡æ¡£é¢„è§ˆ/ä¸‹è½½é“¾æ¥**

`GET /documents/{file_id}/view`

**æè¿°:** è·å–é Markdown æ–‡æ¡£ï¼ˆå¦‚ PDF, DOCXï¼‰çš„é¢„è§ˆæˆ–ä¸‹è½½é“¾æ¥ã€‚

**è·¯å¾„å‚æ•°:**

| å‚æ•°      | ç±»å‹ | æè¿°         |
| :-------- | :--- | :----------- |
| `file_id` | Long | æ–‡æ¡£æ–‡ä»¶çš„ID |

**å“åº”:** 

```json
{
  "code": 200,
  "message": "è·å–æ–‡æ¡£é“¾æ¥æˆåŠŸ",
  "data": "https://r2.liteisle.com/docs/asdqwd.pdf?token=..."
}
```

##### **6.2.3. è·å– MD æ–‡æ¡£å†…å®¹**

`GET /documents/md/{file_id}`

**æè¿°:** è·å–æŒ‡å®š Markdown æ–‡ä»¶çš„åŸå§‹å†…å®¹ï¼Œç”¨äºåœ¨çº¿ç¼–è¾‘å™¨åŠ è½½ã€‚

**è·¯å¾„å‚æ•°:**

| å‚æ•°      | ç±»å‹ | æè¿°                |
| :-------- | :--- | :------------------ |
| `file_id` | Long | Markdown æ–‡ä»¶çš„IDã€‚ |

**å“åº”:** `MarkdownContentResp`

```json
{
  "code": 200,
  "message": "è·å–Markdownæ–‡æ¡£æˆåŠŸ",
  "data": {
    "content": "# å‘¨ä¼šçºªè¦\n\n- è®¨è®ºäº†Q2å­£åº¦ç›®æ ‡ã€‚\n- åˆ†é…äº†æ–°åŠŸèƒ½å¼€å‘ä»»åŠ¡ã€‚",
    "version": 5 // ç‰ˆæœ¬å·
  }
}
```

##### **6.2.4. æ›´æ–°å¹¶ä¿å­˜ MD æ–‡æ¡£**

`PUT /documents/md/{file_id}`

**æè¿°:** æ›´æ–°å¹¶ä¿å­˜åœ¨çº¿ç¼–è¾‘å™¨ä¸­ä¿®æ”¹åçš„ Markdown æ–‡æ¡£å†…å®¹ï¼ˆmdæ–‡ä»¶ä¸å½±å“ç”¨æˆ·é¢åº¦ï¼‰ã€‚

**è·¯å¾„å‚æ•°:**

| å‚æ•°      | ç±»å‹ | æè¿°                         |
| :-------- | :--- | :--------------------------- |
| `file_id` | Long | è¦ä¿å­˜çš„ Markdown æ–‡ä»¶çš„IDã€‚ |

**è¯·æ±‚ä½“:** `@RequestBody MarkdownUpdateReq`

```json
{
    "content": "# å‘¨ä¼šçºªè¦ (æ›´æ–°)\n\n- è®¨è®ºäº†Q2å­£åº¦ç›®æ ‡ã€‚\n- åˆ†é…äº†æ–°åŠŸèƒ½å¼€å‘ä»»åŠ¡ã€‚\n- **è¡¥å……ï¼š** ä¸‹å‘¨ä¸‰è¿›è¡Œæ¼”ç¤ºã€‚",
    "version": 5 // âœ¨ å‰ç«¯ä»GETè¯·æ±‚ä¸­è·å–å¹¶å›ä¼ çš„ç‰ˆæœ¬å·
}
```

**å“åº”:**

```json
{
  "code": 200,
  "message": "æ–‡æ¡£ä¿å­˜æˆåŠŸ",
  "data": null
}
```

##### **6.2.5. æ–°å»º MD æ–‡æ¡£**

`POST /documents/md`

**æè¿°:** åœ¨æŒ‡å®šçš„ç¬”è®°æœ¬ä¸‹åˆ›å»ºä¸€ä¸ªæ–°çš„ã€ç©ºçš„ Markdown æ–‡æ¡£ï¼ˆmdæ–‡ä»¶ä¸å½±å“ç”¨æˆ·é¢åº¦ï¼‰ã€‚

**è¯·æ±‚ä½“:** `@RequestBody MarkdownCreateReq`

```json
{
  "name": "æœªå‘½åæ–‡æ¡£.md",
  "folder_id": 301 // è¦æ”¾å…¥çš„ç¬”è®°æœ¬ID
}
```

**å“åº”:**

```json
{
  "code": 200,
  "message": "æ–‡æ¡£æ–°å»ºæˆåŠŸ",
  "data": 31
}
```

> **å¤‡æ³¨:** è¿”å›å‚æ•°ä¸ºæ–°åˆ›å»ºæ–‡æ¡£çš„idã€‚

---

### **7. å›æ”¶ç«™ (Recycle Bin)**

#### **7.1. è·å–å›æ”¶ç«™å†…å®¹**

`GET /recycle-bin`

**æè¿°:** è·å–å½“å‰ç”¨æˆ·å›æ”¶ç«™ä¸­çš„æ‰€æœ‰æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ã€‚

è¯·æ±‚å‚æ•°ï¼š

| å‚æ•°      | ç±»å‹   | æè¿° |
| :-------- | :----- | :--- |
| `content` | String | å­—æ®µ |

**å“åº”:** `RecycleBinContentResp`

```json
{
  "code": 200,
  "message": "è·å–å›æ”¶ç«™åˆ—è¡¨æˆåŠŸ",
  "data": {
    "folders": [
      {
        "original_id": 102,
        "original_name": "æ—§é¡¹ç›®",
        "original_type": "playlist", //FolderTypeEnum
        "sub_count": 3,
        "delete_time": "2024-07-20T11:00:00Z",
        "expire_time": "2024-08-19T11:00:00Z"
      }
    ],
    "files": [
      {
        "original_id": 208,
        "original_name": "è‰ç¨¿.txt",
        "original_type": "document", //FileTypeEnum
        "file_size": 1024,
        "delete_time": "2024-07-21T15:30:00Z",
        "expire_time": "2024-08-20T15:30:00Z"
      }
    ]
  }
}
```

> **å¤‡æ³¨:** `expire_time` è¡¨ç¤ºé¡¹ç›®å°†è¢«ç³»ç»Ÿè‡ªåŠ¨æ°¸ä¹…åˆ é™¤çš„æ—¶é—´ã€‚

#### **7.2. è¿˜åŸé¡¹ç›®**

`POST /recycle-bin/restore`

**æè¿°:** å°†å›æ”¶ç«™ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªé¡¹ç›®è¿˜åŸåˆ°å…¶åŸå§‹ä½ç½®ï¼ˆä¸å½±å“ç”¨æˆ·é¢åº¦ï¼‰ã€‚

**è¯·æ±‚ä½“:** `@RequestBody RecycleBinReq`

```json
{
  "file_ids": [208],
  "folder_ids": [102]
}
```

**å¤‡æ³¨:** è¯·æ±‚ä½“ä¸­æ˜ç¡®åŒºåˆ† file_ids å’Œ folder_ids æ•°ç»„ï¼Œä¸¤è€…è‡³å°‘æä¾›ä¸€ä¸ªã€‚

**å“åº”:**

```json
{
  "code": 200,
  "message": "å·²æˆåŠŸè¿˜åŸ 2 ä¸ªé¡¹ç›®",
  "data": null
}
```

#### **7.3. å½»åº•åˆ é™¤é¡¹ç›®**

`DELETE /recycle-bin/items`

**æè¿°:** ä»å›æ”¶ç«™ä¸­æ°¸ä¹…åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªé¡¹ç›®ã€‚æ­¤æ“ä½œä¸å¯æ¢å¤ï¼ˆæ¢å¤ç”¨æˆ·é¢åº¦ï¼‰ã€‚

**è¯·æ±‚ä½“:** `@RequestBody RecycleBinReq`

```json
{
  "file_ids": [208],
  "folder_ids": [102]
}
```

**å“åº”:**

```json
{
  "code": 200,
  "message": "å·²å½»åº•åˆ é™¤ 2 ä¸ªé¡¹ç›®",
  "data": null
}
```

#### **7.4. æ¸…ç©ºå›æ”¶ç«™**

`DELETE /recycle-bin/all`

**æè¿°:** æ°¸ä¹…åˆ é™¤å›æ”¶ç«™ä¸­çš„æ‰€æœ‰é¡¹ç›®ã€‚æ­¤æ“ä½œä¸å¯æ¢å¤ï¼ˆæ¢å¤ç”¨æˆ·é¢åº¦ï¼‰ã€‚

**å“åº”:**

```json
{
  "code": 200,
  "message": "å›æ”¶ç«™å·²æ¸…ç©º",
  "data": null
}
```

---

### **8. åˆ†äº« (Share)**

#### **8.1. åˆ›å»ºåˆ†äº«é“¾æ¥**

`POST /shares`

**æè¿°:** ä¸ºæŒ‡å®šçš„æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹åˆ›å»ºå…¬å¼€çš„åˆ†äº«é“¾æ¥ã€‚

**è¯·æ±‚ä½“:** `@RequestBody ShareCreateReq`

```json
{
  "file_id": 201,
  "folder_id": null,
  "is_encrypted": true,
  "expires_in_days": 7 //1 7 30 æ°¸ä¹…(0)
}
```

| å­—æ®µ              | ç±»å‹    | æè¿°                             |
| :---------------- | :------ | :------------------------------- |
| `file_id`         | Long    | (å¯é€‰) è¦åˆ†äº«çš„æ–‡ä»¶IDã€‚          |
| `folder_id`       | Long    | (å¯é€‰) è¦åˆ†äº«çš„æ–‡ä»¶å¤¹IDã€‚        |
| `is_encrypted`    | Boolean | æ˜¯å¦åŠ å¯†ã€‚`true`åˆ™ä¼šç”Ÿæˆæå–ç ã€‚ |
| `expires_in_days` | Integer | æœ‰æ•ˆæœŸå¤©æ•°ã€‚`0` è¡¨ç¤ºæ°¸ä¹…æœ‰æ•ˆã€‚   |

**å¤‡æ³¨:**  file_id å’Œ folder_id å¿…é¡»ä¸”åªèƒ½æä¾›ä¸€ä¸ªã€‚

**å“åº”:** `ShareCreateResp`

```json
{
  "code": 200,
  "message": "åˆ›å»ºåˆ†äº«æˆåŠŸ",
  "data": {
    "share_token": "a1b2c3d4e5",
    "share_password": "abcd"
  }
}
```

#### **8.2. è·å–æˆ‘çš„åˆ†äº«è®°å½•**

`GET /shares/me`

**æè¿°:** åˆ†é¡µè·å–å½“å‰ç”¨æˆ·åˆ›å»ºçš„æ‰€æœ‰åˆ†äº«è®°å½•ã€‚

**æŸ¥è¯¢å‚æ•°:**

| å‚æ•°   | ç±»å‹    | æ˜¯å¦å¿…é¡» | æè¿°                |
| :----- | :------ | :------- | :------------------ |
| `page` | Integer | å¦       | é¡µç ï¼Œé»˜è®¤ 1ã€‚      |
| `size` | Integer | å¦       | æ¯é¡µæ•°é‡ï¼Œé»˜è®¤ 10ã€‚ |

**å“åº”:** `ShareRecordPageResp`

```json
{
  "code": 200,
  "message": "è·å–æˆ‘çš„åˆ†äº«åˆ—è¡¨æˆåŠŸ",
  "data": {
    "total": 1,
    "current_page": 1,
    "page_size": 10,
    "records": [
      {
        "id": 15,
        "file_id": 201,
        "folder_id": null,
        "share_item_name": "é¡¹ç›®æŠ¥å‘Š.pdf",
        "share_token": "a1b2c3d4e5",
        "share_password": "abcd",
        "create_time": "2024-07-25T12:00:00Z",
        "expire_time": "2024-08-01T12:00:00Z"
      }
    ]
  }
}
```

#### **8.3. å–æ¶ˆåˆ†äº«**

`DELETE /shares/{share_id}`

**æè¿°:** å–æ¶ˆä¸€ä¸ªåˆ†äº«ï¼Œä½¿å…¶é“¾æ¥å’Œæå–ç å¤±æ•ˆã€‚

**è·¯å¾„å‚æ•°:**

| å‚æ•°       | ç±»å‹ | æè¿°                                           |
| :--------- | :--- | :--------------------------------------------- |
| `share_id` | Long | åˆ†äº«è®°å½•çš„ID (æ¥è‡ªè·å–åˆ†äº«è®°å½•åˆ—è¡¨ä¸­çš„ `id`)ã€‚ |

**å“åº”:**

```json
{
  "code": 200,
  "message": "åˆ†äº«å·²å–æ¶ˆ",
  "data": null
}
```

#### **8.4. éªŒè¯åˆ†äº«ä¿¡æ¯ (ç”¨äºè½¬å­˜å‰ç¡®è®¤)**

`POST /shares/verify`

**æè¿°:** åœ¨ç”¨æˆ·æ‰§è¡Œâ€œè½¬å­˜åˆ°æˆ‘çš„ç½‘ç›˜â€æ“ä½œä¹‹å‰ï¼Œé€šè¿‡ share_token å’Œå¯é€‰çš„å¯†ç æ¥éªŒè¯åˆ†äº«é“¾æ¥ï¼Œå¹¶è·å–åˆ†äº«é¡¹ç›®çš„åŸºæœ¬ä¿¡æ¯ã€‚è¿™ç”¨äºå‘ç”¨æˆ·å±•ç¤ºä¸€ä¸ªç¡®è®¤ç•Œé¢ï¼ˆä¾‹å¦‚ï¼šâ€œæ‚¨è¦ä¿å­˜æ–‡ä»¶ â€˜xxx.pdfâ€™ (15MB) å—ï¼Ÿâ€ï¼‰ã€‚

**è¯·æ±‚ä½“:** `@RequestBody ShareVerifyReq`

```json
{
  "share_token": "a1b2c3d4e5",
  "share_password": "abcd"
}
```

**å“åº”:** `ShareInfoResp`

```json
{
  "code": 200,
  "message": "éªŒè¯æˆåŠŸ",
  "data": {
    "item_type": "file", // "file" æˆ– "folder" ItemTypeæšä¸¾ç±»
    "item_name": "é¡¹ç›®æŠ¥å‘Š.pdf",
    "item_size": 15728640, // å¦‚æœæ˜¯æ–‡ä»¶ï¼Œä¸ºæ–‡ä»¶å¤§å°ï¼›å¦‚æœæ˜¯æ–‡ä»¶å¤¹ï¼Œä¸ºæ–‡ä»¶å¤¹æ€»å¤§å°
    "total_files": 1 // å¦‚æœæ˜¯æ–‡ä»¶å¤¹ï¼Œä¸ºåŒ…å«çš„æ–‡ä»¶æ€»æ•°
  }
}
```

> **å‰ç«¯æµç¨‹:**
>
> 1. ç”¨æˆ·è¾“å…¥åˆ†äº«é“¾æ¥ï¼Œå‰ç«¯è§£æå‡º share_token å’Œ share_passwordã€‚
> 2. è°ƒç”¨æœ¬æ¥å£ã€‚
> 3. è‹¥æˆåŠŸï¼Œæ ¹æ®è¿”å›çš„ data å¼¹å‡ºç¡®è®¤æ¡†ï¼Œå¹¶è®©ç”¨æˆ·é€‰æ‹©è¦ä¿å­˜åˆ°çš„ç›®æ ‡æ–‡ä»¶å¤¹ã€‚

#### ï¼8.5. è½¬å­˜åˆ†äº«å†…å®¹åˆ°æˆ‘çš„ç½‘ç›˜ (å¼‚æ­¥)

`POST /shares/save`

**æè¿°:** å°†ä¸€ä¸ªåˆ†äº«é“¾æ¥ä¸­çš„æ‰€æœ‰æ–‡ä»¶å¼‚æ­¥åœ°â€œå¤åˆ¶â€åˆ°å½“å‰ç”¨æˆ·çš„æŒ‡å®šæ–‡ä»¶å¤¹ä¸­ã€‚ç”±äºæ˜¯æœåŠ¡ç«¯æ“ä½œï¼Œæ­¤æ¥å£ä¼šç«‹å³è¿”å›ï¼Œå¹¶åœ¨åå°å¤„ç†ã€‚

**è¯·æ±‚ä½“:** `@RequestBody ShareSaveReq`

```json
{
  "share_token": "a1b2c3d4e5",
  "share_password": "abcd",
  "target_folder_id": 41
}
```

**å“åº” (å¿«é€Ÿè¿”å›):** `ShareSaveAsyncResp`

```json
{
  "code": 202,
  "message": "è½¬å­˜ä»»åŠ¡å·²åˆ›å»ºï¼Œæ­£åœ¨åå°å¤„ç† 3 ä¸ªæ–‡ä»¶",
  "data": {
    "total_files_to_save": 3,
    "initial_file_data_list": [ // è¿”å›ä¸€ä¸ªåˆå§‹æ–‡ä»¶å¯¹è±¡åˆ—è¡¨ï¼
      {
        "id": 210, // åœ¨ç”¨æˆ·æ–‡ä»¶è¡¨ä¸­ä¸ºâ€œæ–‡ä»¶Aâ€æ–°åˆ›å»ºçš„æ¡ç›®ID
        "name": "æ–‡ä»¶A.pdf", 
        "file_type": "document", //FileTypeEnum
        "status": "processing", //FileStatusEnum
        "create_time": "...",
        "update_time": "..."
      },
      {
        "id": 211, // åœ¨ç”¨æˆ·æ–‡ä»¶è¡¨ä¸­ä¸ºâ€œæ–‡ä»¶B.mp3â€æ–°åˆ›å»ºçš„æ¡ç›®ID
        "name": "æ–‡ä»¶B.mp3",
        "file_type": "music",
        "status": "processing",
        "create_time": "...",
        "update_time": "..."
      },
      {
        "id": 212, 
        "name": "æ–‡ä»¶C.mp3",
        "file_type": "music",
        "status": "processing",
        "create_time": "...",
        "update_time": "..."
      }
    ]
  }
}
```

---

### **9. ä¸“æ³¨ (Focus)**

#### **9.1. è®°å½•ä¸“æ³¨æ—¶é•¿**

`POST /focus/records`

**æè¿°:** è®°å½•ä¸€æ¬¡å®Œæˆçš„ä¸“æ³¨ä¼šè¯ã€‚

**æŸ¥è¯¢å‚æ•°:**

| å‚æ•°            | ç±»å‹    | æ˜¯å¦å¿…é¡» | æè¿°             |
| :-------------- | :------ | :------- | :--------------- |
| `focus_minutes` | Integer | æ˜¯       | ä¸“æ³¨æ—¶é•¿ï¼Œæ•´åˆ†é’Ÿ |

**å“åº”:** 

```json
{
  "code": 200,
  "message": "ä¸“æ³¨è®°å½•å·²ä¿å­˜ï¼Œæ­å–œæ‚¨è·å¾—æ–°å²›å±¿ï¼",
  "data": "https://r2.liteisle.com/islands/island_05.png"
}
```

> **å¤‡æ³¨:** å¦‚æœæœ¬æ¬¡ä¸“æ³¨æ²¡æœ‰è·å¾—æ–°å²›å±¿ï¼Œ`data` å­—æ®µå°†ä¸º `null`ï¼Œ`message` ä¹Ÿä¼šç›¸åº”å˜åŒ–ã€‚

#### **9.2. è·å–ä¸“æ³¨æ€»æ¬¡æ•°**

`GET /focus/stats/total-count`

**æè¿°:** è·å–ç”¨æˆ·ç´¯è®¡çš„ä¸“æ³¨æ€»æ¬¡æ•°ï¼Œç”¨äºä»ªè¡¨ç›˜å¡ç‰‡å±•ç¤ºã€‚

**å“åº”:** 

```json
{
  "code": 200,
  "message": "è·å–æˆåŠŸ",
  "data": 32
}
```

#### **9.3. è·å–ä¸“æ³¨è®°å½•**

`GET /focus/stats/records`

**æè¿°:** åˆ†é¡µè·å–ç”¨æˆ·çš„ä¸“æ³¨å†å²è®°å½•ã€‚

**æŸ¥è¯¢å‚æ•°:**

| å‚æ•°   | ç±»å‹    | æ˜¯å¦å¿…é¡» | æè¿°                |
| :----- | :------ | :------- | :------------------ |
| `page` | Integer | å¦       | é¡µç ï¼Œé»˜è®¤ 1ã€‚      |
| `size` | Integer | å¦       | æ¯é¡µæ•°é‡ï¼Œé»˜è®¤ 10ã€‚ |

**å“åº”:** `FocusStatsPageResp`

```json
{
  "code": 200,
  "message": "è·å–ä¸“æ³¨ç»Ÿè®¡æˆåŠŸ",
  "data": {
    "total": 32,
    "current_page": 1,
    "page_size": 10,
    "records": [
      {
        "id": 105, // è®°å½•çš„ID
        "focus_minutes": 50,
        "create_time": "...."
      },
      {
        "id": 106, // è®°å½•çš„ID
        "focus_minutes": 75,
        "create_time": "...."
      }
    ]
  }
}
```

#### **9.4. è·å–ä¸“æ³¨æ—¥å†æ•°æ®**

`GET /focus/stats/calendar`

**æè¿°:** è·å–æŒ‡å®šæœˆä»½çš„ä¸“æ³¨æ—¥å†æ•°æ®ï¼Œç”¨äºæ¸²æŸ“ç±»ä¼¼ GitHub çš„è´¡çŒ®å›¾ã€‚

**æŸ¥è¯¢å‚æ•°:**

| å‚æ•°    | ç±»å‹    | æ˜¯å¦å¿…é¡» | æè¿°              |
| :------ | :------ | :------- | :---------------- |
| `year`  | Integer | æ˜¯       | å¹´ä»½ï¼Œä¾‹å¦‚ 2024ã€‚ |
| `month` | Integer | æ˜¯       | æœˆä»½ï¼Œä¾‹å¦‚ 7ã€‚    |

**å“åº”:** `FocusCalendarResp`

```json
{
  "code": 200,
  "message": "è·å–ä¸“æ³¨æ—¥å†æˆåŠŸ",
  "data": {
    "year_month": "2024-7",
    "check_in_days": [1, 3, 5, 7, 24, 25],
    "total_check_in_count": 6,
    "total_focus_minutes": 480
  }
}
```

> **å¤‡æ³¨:** `total_focus_minutes` æ˜¯å½“æœˆçš„æ€»ä¸“æ³¨åˆ†é’Ÿæ•°ã€‚

---

### **10. å²›å±¿ (Island)**

#### **10.1. è·å–ç”¨æˆ·å²›å±¿æ”¶é›†æƒ…å†µ**

`GET /islands/me`

**æè¿°:** è·å–å½“å‰ç”¨æˆ·å·²ç»æ”¶é›†åˆ°çš„æ‰€æœ‰å²›å±¿ä¿¡æ¯ï¼Œç”¨äºä»ªè¡¨ç›˜å±•ç¤ºã€‚

**å“åº”:** 

```json
{
  "code": 200,
  "message": "è·å–å²›å±¿æ”¶é›†æƒ…å†µæˆåŠŸ",
  "data": ["https://r2.liteisle.com/islands/island_01.png",
"https://r2.liteisle.com/islands/island_02.png"]
}
```

> **å¤‡æ³¨:**
>
> * `data` æ•°ç»„ä¸­å¯èƒ½åŒ…å«é‡å¤çš„å²›å±¿ã€‚

### **11. å®ç”¨å·¥å…· (Utilities)**

æ­¤éƒ¨åˆ†APIæä¾›è·¨æ¨¡å—çš„é€šç”¨è¾…åŠ©åŠŸèƒ½ï¼Œä»¥å¢å¼ºæ ¸å¿ƒç”¨æˆ·ä½“éªŒã€‚

#### **11.1. åˆ’è¯ç¿»è¯‘**

`POST /translate`

**æè¿°:** æ¥æ”¶ä¸€æ®µæ–‡æœ¬åŠå…¶æ–‡æ¡£idï¼Œå¹¶è¿”å›å…¶ç¿»è¯‘ç»“æœã€‚ä¸Šä¸‹æ–‡çš„æä¾›å¯ä»¥æ˜¾è‘—æå‡ç¿»è¯‘çš„å‡†ç¡®æ€§å’Œä¸“ä¸šæ€§ã€‚

**è¯·æ±‚ä½“:** `@RequestBody TranslateReq`

```json
{
  "text": "The framework uses a stack to manage states.",
  "target_lang": "zh-CN",
  "file_name": "401.pdf"
}
```

| å­—æ®µ        | ç±»å‹   | æ˜¯å¦å¿…é¡» | æè¿°                         |
| ----------- | ------ | -------- | ---------------------------- |
| text        | String | æ˜¯       | ç”¨æˆ·åˆ’è¯é€‰ä¸­çš„æ ¸å¿ƒæ–‡æœ¬ã€‚     |
| target_lang | String | å¦       | ç›®æ ‡è¯­è¨€ä»£ç  é»˜è®¤ä¸­æ–‡ã€‚      |
| file_name   | String | **æ˜¯**   | å½“å‰æ­£åœ¨é˜…è¯»æˆ–ç¼–è¾‘çš„æ–‡ä»¶åã€‚ |

**å“åº”:** `TranslateResp`

```json
{
  "code": 200,
  "message": "ç¿»è¯‘æˆåŠŸ",
  "data": {
    "original_text": "Hello, this is a sentence to be translated.",
    "translated_text": "ä½ å¥½ï¼Œè¿™æ˜¯ä¸€ä¸ªéœ€è¦è¢«ç¿»è¯‘çš„å¥å­ã€‚"
  }
}
```

| å­—æ®µ            | ç±»å‹   | æè¿°                           |
| --------------- | ------ | ------------------------------ |
| original_text   | String | åŸå§‹è¯·æ±‚çš„æ–‡æœ¬ï¼Œä¾¿äºå‰ç«¯æ ¸å¯¹ã€‚ |
| translated_text | String | ç¿»è¯‘åçš„æ–‡æœ¬ã€‚                 |

---

# LiteIsle å‰åç«¯æ¥å£æ“ä½œå¯¹åº”è¡¨æ ¼

## æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†è®°å½•äº†LiteIsleé¡¹ç›®ä¸­æ‰€æœ‰å‰åç«¯æ¥å£çš„æ“ä½œå¯¹åº”å…³ç³»ï¼ŒåŒ…æ‹¬APIç«¯ç‚¹ã€HTTPæ–¹æ³•ã€åŠŸèƒ½æè¿°ã€æ¶‰åŠçš„æ•°æ®åº“è¡¨æ“ä½œã€ä¸šåŠ¡é€»è¾‘ç­‰è¯¦ç»†ä¿¡æ¯ã€‚

## æ•°æ®åº“è¡¨è¯´æ˜

### æ ¸å¿ƒä¸šåŠ¡è¡¨

- **users**: ç”¨æˆ·è´¦æˆ·ä¸åŸºæœ¬ä¿¡æ¯è¡¨
- **folders**: ç”¨æˆ·é€»è¾‘æ–‡ä»¶å¤¹ç»“æ„è¡¨
- **files**: ç”¨æˆ·æ–‡ä»¶é€»è¾‘è®°å½•è¡¨
- **storages**: å­˜å‚¨å”¯ä¸€æ–‡ä»¶å®ä½“è¡¨ï¼ˆå®ç°ç§’ä¼ åŠŸèƒ½ï¼‰

### å…ƒæ•°æ®è¡¨

- **document_metadata**: æ–‡æ¡£æ–‡ä»¶ä¸“å±å…ƒæ•°æ®è¡¨
- **music_metadata**: éŸ³ä¹æ–‡ä»¶ä¸“å±å…ƒæ•°æ®è¡¨

### åŠŸèƒ½æ‰©å±•è¡¨

- **share_links**: ç®¡ç†å…¬å¼€åˆ†äº«é“¾æ¥è¡¨
- **user_focus_records**: ç”¨æˆ·å•æ¬¡ä¸“æ³¨ä¼šè¯è®°å½•è¡¨
- **user_islands**: è®°å½•ç”¨æˆ·å·²è§£é”çš„å²›å±¿è¡¨
- **transfer_log**: æ–‡ä»¶ä¸Šä¼ ä¸‹è½½è¡Œä¸ºæ—¥å¿—è¡¨

### ç¼“å­˜å­˜å‚¨

- **Redis**: ç­¾åˆ°åŠŸèƒ½Bitmapã€éªŒè¯ç ç¼“å­˜ã€JWT tokenç¼“å­˜

---

## æ¥å£æ“ä½œå¯¹åº”è¡¨æ ¼

### 1. ç”¨æˆ·è®¤è¯æ¨¡å— (AuthController)

| æ¥å£è·¯å¾„                | HTTPæ–¹æ³• | åŠŸèƒ½æè¿°         | æ•°æ®åº“æ“ä½œ                     | æ¶‰åŠè¡¨         | ä¸šåŠ¡é€»è¾‘                                                     |
| ----------------------- | -------- | ---------------- | ------------------------------ | -------------- | ------------------------------------------------------------ |
| `/auth/login`           | POST     | ç”¨æˆ·ç™»å½•         | æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ï¼ŒéªŒè¯å¯†ç          | users          | 1. æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢ç”¨æˆ·<br>2. éªŒè¯å¯†ç <br>3. ç”ŸæˆJWT token<br>4. è¿”å›ç”¨æˆ·ä¿¡æ¯å’Œtoken |
| `/auth/register`        | POST     | ç”¨æˆ·æ³¨å†Œ         | æ’å…¥æ–°ç”¨æˆ·è®°å½•ï¼Œåˆ›å»ºé»˜è®¤æ–‡ä»¶å¤¹ | users, folders | 1. éªŒè¯é‚®ç®±æ ¼å¼å’ŒéªŒè¯ç <br>2. æ£€æŸ¥ç”¨æˆ·åå”¯ä¸€æ€§<br>3. åˆ›å»ºç”¨æˆ·è®°å½•<br>4. åˆ›å»ºé»˜è®¤ç³»ç»Ÿæ–‡ä»¶å¤¹<br>5. ç”ŸæˆJWT token |
| `/auth/send-vcode`      | POST     | å‘é€éªŒè¯ç        | Redisç¼“å­˜éªŒè¯ç                 | Redis          | 1. ç”Ÿæˆ6ä½éšæœºéªŒè¯ç <br>2. å­˜å‚¨åˆ°Redisï¼ˆ5åˆ†é’Ÿè¿‡æœŸï¼‰<br>3. å‘é€é‚®ä»¶ |
| `/auth/forgot-password` | POST     | å¿˜è®°å¯†ç          | æ›´æ–°ç”¨æˆ·å¯†ç                    | users          | 1. éªŒè¯ç”¨æˆ·åã€é‚®ç®±ã€éªŒè¯ç <br>2. åŠ å¯†æ–°å¯†ç <br>3. æ›´æ–°ç”¨æˆ·å¯†ç å­—æ®µ |
| `/auth/current-user`    | GET      | è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯ | æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯                   | users          | æ ¹æ®JWT tokenä¸­çš„ç”¨æˆ·IDæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯                          |
| `/auth/reset-password`  | PUT      | ä¿®æ”¹å¯†ç          | æ›´æ–°ç”¨æˆ·å¯†ç                    | users          | 1. éªŒè¯æ—§å¯†ç <br>2. åŠ å¯†æ–°å¯†ç <br>3. æ›´æ–°å¯†ç å­—æ®µ            |
| `/auth/upload-picture`  | POST     | ä¸Šä¼ å¤´åƒ         | æ›´æ–°ç”¨æˆ·å¤´åƒURL                | users          | 1. ä¸Šä¼ å›¾ç‰‡åˆ°MinIO<br>2. æ›´æ–°ç”¨æˆ·avatarå­—æ®µ                  |
| `/auth/reset-picture`   | DELETE   | é‡ç½®å¤´åƒ         | æ›´æ–°ç”¨æˆ·å¤´åƒä¸ºé»˜è®¤å€¼           | users          | å°†ç”¨æˆ·avatarå­—æ®µè®¾ä¸ºé»˜è®¤å¤´åƒURL                              |
| `/auth/logout`          | POST     | é€€å‡ºç™»å½•         | Redisåˆ é™¤token                 | Redis          | å°†JWT tokenåŠ å…¥é»‘åå•                                        |

### 2. æ–‡ä»¶å¤¹ç®¡ç†æ¨¡å— (ItemController)

| æ¥å£è·¯å¾„                     | HTTPæ–¹æ³• | åŠŸèƒ½æè¿°       | æ•°æ®åº“æ“ä½œ             | æ¶‰åŠè¡¨                          | ä¸šåŠ¡é€»è¾‘                                                     |
| ---------------------------- | -------- | -------------- | ---------------------- | ------------------------------- | ------------------------------------------------------------ |
| `/items/folders`             | POST     | åˆ›å»ºæ–‡ä»¶å¤¹     | æ’å…¥æ–‡ä»¶å¤¹è®°å½•         | folders                         | 1. éªŒè¯çˆ¶æ–‡ä»¶å¤¹å­˜åœ¨æ€§<br>2. éªŒè¯æ–‡ä»¶å¤¹ç±»å‹å…¼å®¹æ€§<br>3. æ’å…¥æ–°æ–‡ä»¶å¤¹è®°å½• |
| `/items/folders/{folder_id}` | GET      | è·å–æ–‡ä»¶å¤¹å†…å®¹ | æŸ¥è¯¢æ–‡ä»¶å¤¹å’Œæ–‡ä»¶ä¿¡æ¯   | folders, files, storages        | 1. å¼‚æ­¥æŸ¥è¯¢æ–‡ä»¶å¤¹ä¿¡æ¯<br>2. å¼‚æ­¥æŸ¥è¯¢æ–‡ä»¶åˆ—è¡¨<br>3. å…³è”å­˜å‚¨ä¿¡æ¯è·å–æ–‡ä»¶å¤§å°<br>4. æ”¯æŒæ’åºå’Œæœç´¢ |
| `/items/folders/{folder_id}` | PUT      | é‡å‘½åæ–‡ä»¶å¤¹   | æ›´æ–°æ–‡ä»¶å¤¹åç§°         | folders                         | 1. éªŒè¯æ–‡ä»¶å¤¹æ‰€æœ‰æƒ<br>2. æ›´æ–°folder_nameå­—æ®µ                |
| `/items/folders/{folder_id}` | DELETE   | åˆ é™¤æ–‡ä»¶å¤¹     | è½¯åˆ é™¤æ–‡ä»¶å¤¹å’Œå…¶ä¸­æ–‡ä»¶ | folders, files                  | 1. è®¾ç½®æ–‡ä»¶å¤¹delete_time<br>2. è®¾ç½®æ–‡ä»¶å¤¹å†…æ‰€æœ‰æ–‡ä»¶delete_time |
| `/items/files/{file_id}`     | PUT      | é‡å‘½åæ–‡ä»¶     | æ›´æ–°æ–‡ä»¶åç§°           | files                           | 1. éªŒè¯æ–‡ä»¶æ‰€æœ‰æƒ<br>2. æ›´æ–°file_nameå­—æ®µ                    |
| `/items/files/{file_id}`     | DELETE   | åˆ é™¤æ–‡ä»¶       | è½¯åˆ é™¤æ–‡ä»¶             | files                           | è®¾ç½®æ–‡ä»¶delete_timeå­—æ®µ                                      |
| `/items/set-order`           | POST     | è®¾ç½®æ’åº       | æ›´æ–°æ’åºå­—æ®µ           | folders, files                  | 1. è®¡ç®—æ–°çš„sorted_orderå€¼<br>2. æ›´æ–°å¯¹åº”è®°å½•çš„æ’åºå­—æ®µ       |
| `/items/copy`                | POST     | å¤åˆ¶é¡¹ç›®       | å¤åˆ¶æ–‡ä»¶/æ–‡ä»¶å¤¹è®°å½•    | files, folders, storages, users | 1. éªŒè¯å¤åˆ¶è§„åˆ™<br>2. åˆ›å»ºæ–°çš„æ–‡ä»¶/æ–‡ä»¶å¤¹è®°å½•<br>3. æ›´æ–°å­˜å‚¨å¼•ç”¨è®¡æ•°<br>4. æ›´æ–°ç”¨æˆ·å­˜å‚¨ä½¿ç”¨é‡ |

### 3. éŸ³ä¹æ¨¡å— (MusicController)

| æ¥å£è·¯å¾„                | HTTPæ–¹æ³• | åŠŸèƒ½æè¿°         | æ•°æ®åº“æ“ä½œ             | æ¶‰åŠè¡¨                         | ä¸šåŠ¡é€»è¾‘                                                     |
| ----------------------- | -------- | ---------------- | ---------------------- | ------------------------------ | ------------------------------------------------------------ |
| `/music`                | GET      | è·å–éŸ³ä¹é¡µé¢ä¿¡æ¯ | æŸ¥è¯¢æ’­æ”¾åˆ—è¡¨å’ŒéŸ³ä¹æ–‡ä»¶ | folders, files, music_metadata | 1. å¼‚æ­¥æŸ¥è¯¢playlistç±»å‹æ–‡ä»¶å¤¹<br>2. å¼‚æ­¥æŸ¥è¯¢éŸ³ä¹æ–‡ä»¶<br>3. å…³è”éŸ³ä¹å…ƒæ•°æ®<br>4. æ”¯æŒæœç´¢åŠŸèƒ½ |
| `/music/{file_id}/play` | GET      | è·å–éŸ³ä¹æ’­æ”¾URL  | æŸ¥è¯¢æ–‡ä»¶å’Œå­˜å‚¨ä¿¡æ¯     | files, storages                | 1. éªŒè¯æ–‡ä»¶æ‰€æœ‰æƒ<br>2. è·å–å­˜å‚¨è·¯å¾„<br>3. ç”Ÿæˆé¢„ç­¾åURL     |

### 4. æ–‡æ¡£æ¨¡å— (DocumentController)

| æ¥å£è·¯å¾„                    | HTTPæ–¹æ³• | åŠŸèƒ½æè¿°         | æ•°æ®åº“æ“ä½œ           | æ¶‰åŠè¡¨                   | ä¸šåŠ¡é€»è¾‘                                                     |
| --------------------------- | -------- | ---------------- | -------------------- | ------------------------ | ------------------------------------------------------------ |
| `/documents`                | GET      | è·å–æ–‡æ¡£é¡µé¢ä¿¡æ¯ | æŸ¥è¯¢ä¹¦å•å’Œæ–‡æ¡£æ–‡ä»¶   | folders, files           | 1. å¼‚æ­¥æŸ¥è¯¢booklistç±»å‹æ–‡ä»¶å¤¹<br>2. å¼‚æ­¥æŸ¥è¯¢æ–‡æ¡£æ–‡ä»¶<br>3. æ”¯æŒæœç´¢åŠŸèƒ½ |
| `/documents/{file_id}/view` | GET      | è·å–æ–‡æ¡£é¢„è§ˆé“¾æ¥ | æŸ¥è¯¢æ–‡ä»¶å’Œå­˜å‚¨ä¿¡æ¯   | files, storages          | 1. éªŒè¯æ–‡ä»¶æ‰€æœ‰æƒ<br>2. è·å–å­˜å‚¨è·¯å¾„<br>3. ç”Ÿæˆé¢„ç­¾åURL     |
| `/documents/md`             | POST     | åˆ›å»ºMarkdownæ–‡æ¡£ | æ’å…¥æ–‡ä»¶å’Œæ–‡æ¡£å…ƒæ•°æ® | files, document_metadata | 1. åˆ›å»ºæ–‡ä»¶è®°å½•<br>2. åˆ›å»ºæ–‡æ¡£å…ƒæ•°æ®è®°å½•<br>3. è®¾ç½®åˆå§‹ç‰ˆæœ¬å· |
| `/documents/md/{file_id}`   | GET      | è·å–Markdownå†…å®¹ | æŸ¥è¯¢æ–‡æ¡£å…ƒæ•°æ®       | document_metadata        | æ ¹æ®æ–‡ä»¶IDæŸ¥è¯¢Markdownå†…å®¹å’Œç‰ˆæœ¬                             |
| `/documents/md/{file_id}`   | PUT      | æ›´æ–°Markdownå†…å®¹ | æ›´æ–°æ–‡æ¡£å…ƒæ•°æ®       | document_metadata        | 1. éªŒè¯ç‰ˆæœ¬å·ï¼ˆä¹è§‚é”ï¼‰<br>2. æ›´æ–°å†…å®¹å’Œç‰ˆæœ¬å·               |

### 5. å›æ”¶ç«™æ¨¡å— (RecycleBinController)

| æ¥å£è·¯å¾„               | HTTPæ–¹æ³• | åŠŸèƒ½æè¿°         | æ•°æ®åº“æ“ä½œ                 | æ¶‰åŠè¡¨                          | ä¸šåŠ¡é€»è¾‘                                                     |
| ---------------------- | -------- | ---------------- | -------------------------- | ------------------------------- | ------------------------------------------------------------ |
| `/recycle-bin`         | GET      | è·å–å›æ”¶ç«™å†…å®¹   | æŸ¥è¯¢å·²åˆ é™¤çš„æ–‡ä»¶å’Œæ–‡ä»¶å¤¹   | files, folders                  | 1. å¼‚æ­¥æŸ¥è¯¢è½¯åˆ é™¤çš„æ–‡ä»¶<br>2. å¼‚æ­¥æŸ¥è¯¢è½¯åˆ é™¤çš„æ–‡ä»¶å¤¹<br>3. æ”¯æŒæœç´¢åŠŸèƒ½ |
| `/recycle-bin/restore` | POST     | æ¢å¤é¡¹ç›®         | æ¸…ç©ºåˆ é™¤æ—¶é—´               | files, folders                  | 1. æ¢å¤é€‰ä¸­çš„æ–‡ä»¶å’Œæ–‡ä»¶å¤¹<br>2. æ¢å¤æ–‡ä»¶å¤¹å†…çš„æ‰€æœ‰æ–‡ä»¶<br>3. æ¸…ç©ºdelete_timeå­—æ®µ |
| `/recycle-bin/items`   | DELETE   | æ°¸ä¹…åˆ é™¤é€‰ä¸­é¡¹ç›® | ç‰©ç†åˆ é™¤è®°å½•ï¼Œæ›´æ–°å¼•ç”¨è®¡æ•° | files, folders, storages, users | 1. è®¡ç®—é‡Šæ”¾çš„å­˜å‚¨ç©ºé—´<br>2. ç‰©ç†åˆ é™¤æ–‡ä»¶å’Œæ–‡ä»¶å¤¹è®°å½•<br>3. å‡å°‘å­˜å‚¨å¼•ç”¨è®¡æ•°<br>4. æ›´æ–°ç”¨æˆ·å­˜å‚¨ä½¿ç”¨é‡ |
| `/recycle-bin/all`     | DELETE   | æ¸…ç©ºå›æ”¶ç«™       | ç‰©ç†åˆ é™¤æ‰€æœ‰å·²åˆ é™¤é¡¹ç›®     | files, folders, storages, users | 1. æŸ¥è¯¢ç”¨æˆ·æ‰€æœ‰å·²åˆ é™¤é¡¹ç›®<br>2. æ‰¹é‡ç‰©ç†åˆ é™¤<br>3. æ›´æ–°å­˜å‚¨å¼•ç”¨è®¡æ•°<br>4. æ›´æ–°ç”¨æˆ·å­˜å‚¨ä½¿ç”¨é‡ |

### 6. æ–‡ä»¶ä¸Šä¼ æ¨¡å— (UploadController)

| æ¥å£è·¯å¾„  | HTTPæ–¹æ³• | åŠŸèƒ½æè¿°     | æ•°æ®åº“æ“ä½œ         | æ¶‰åŠè¡¨                               | ä¸šåŠ¡é€»è¾‘                                                     |
| --------- | -------- | ------------ | ------------------ | ------------------------------------ | ------------------------------------------------------------ |
| `/upload` | POST     | å¼‚æ­¥æ–‡ä»¶ä¸Šä¼  | æ’å…¥æ–‡ä»¶å’Œå­˜å‚¨è®°å½• | files, storages, users, transfer_log | 1. è®¡ç®—æ–‡ä»¶å“ˆå¸Œå€¼<br>2. æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨ï¼ˆç§’ä¼ ï¼‰<br>3. ä¸Šä¼ åˆ°MinIO<br>4. åˆ›å»ºæ–‡ä»¶å’Œå­˜å‚¨è®°å½•<br>5. æ›´æ–°ç”¨æˆ·å­˜å‚¨ä½¿ç”¨é‡<br>6. è®°å½•ä¼ è¾“æ—¥å¿— |

### 7. åˆ†äº«æ¨¡å— (ShareController)

| æ¥å£è·¯å¾„             | HTTPæ–¹æ³• | åŠŸèƒ½æè¿°         | æ•°æ®åº“æ“ä½œ         | æ¶‰åŠè¡¨                      | ä¸šåŠ¡é€»è¾‘                                                     |
| -------------------- | -------- | ---------------- | ------------------ | --------------------------- | ------------------------------------------------------------ |
| `/shares`            | POST     | åˆ›å»ºåˆ†äº«é“¾æ¥     | æ’å…¥åˆ†äº«è®°å½•       | share_links                 | 1. ç”Ÿæˆå”¯ä¸€åˆ†äº«token<br>2. åŠ å¯†åˆ†äº«å¯†ç <br>3. åˆ›å»ºåˆ†äº«è®°å½•   |
| `/shares/verify`     | POST     | éªŒè¯åˆ†äº«é“¾æ¥     | æŸ¥è¯¢åˆ†äº«ä¿¡æ¯       | share_links, files, folders | 1. éªŒè¯åˆ†äº«token<br>2. éªŒè¯åˆ†äº«å¯†ç <br>3. æ£€æŸ¥è¿‡æœŸæ—¶é—´<br>4. è¿”å›åˆ†äº«å†…å®¹ |
| `/shares/save`       | POST     | ä¿å­˜åˆ†äº«å†…å®¹     | å¤åˆ¶æ–‡ä»¶åˆ°ç”¨æˆ·ç©ºé—´ | files, storages, users      | 1. å¤åˆ¶åˆ†äº«çš„æ–‡ä»¶<br>2. æ›´æ–°å­˜å‚¨å¼•ç”¨è®¡æ•°<br>3. æ›´æ–°ç”¨æˆ·å­˜å‚¨ä½¿ç”¨é‡ |
| `/shares/me`         | GET      | è·å–æˆ‘çš„åˆ†äº«è®°å½• | æŸ¥è¯¢ç”¨æˆ·åˆ†äº«è®°å½•   | share_links, files, folders | åˆ†é¡µæŸ¥è¯¢ç”¨æˆ·åˆ›å»ºçš„åˆ†äº«è®°å½•                                   |
| `/shares/{share_id}` | DELETE   | åˆ é™¤åˆ†äº«é“¾æ¥     | åˆ é™¤åˆ†äº«è®°å½•       | share_links                 | ç‰©ç†åˆ é™¤åˆ†äº«è®°å½•                                             |

### 8. ä¸“æ³¨æ¨¡å— (FocusController)

| æ¥å£è·¯å¾„                   | HTTPæ–¹æ³• | åŠŸèƒ½æè¿°         | æ•°æ®åº“æ“ä½œ                 | æ¶‰åŠè¡¨                                  | ä¸šåŠ¡é€»è¾‘                                                     |
| -------------------------- | -------- | ---------------- | -------------------------- | --------------------------------------- | ------------------------------------------------------------ |
| `/focus/records`           | POST     | åˆ›å»ºä¸“æ³¨è®°å½•     | æ’å…¥ä¸“æ³¨è®°å½•ï¼Œå¯èƒ½å¥–åŠ±å²›å±¿ | user_focus_records, user_islands, Redis | 1. åˆ›å»ºä¸“æ³¨è®°å½•<br>2. æ‰§è¡Œç­¾åˆ°é€»è¾‘ï¼ˆRedis Bitmapï¼‰<br>3. æ‰§è¡Œå¥–åŠ±è´£ä»»é“¾<br>4. å¯èƒ½è·å¾—å²›å±¿å¥–åŠ± |
| `/focus/stats/total-count` | GET      | è·å–æ€»ä¸“æ³¨æ¬¡æ•°   | æŸ¥è¯¢ä¸“æ³¨è®°å½•æ€»æ•°           | user_focus_records                      | ç»Ÿè®¡ç”¨æˆ·ä¸“æ³¨è®°å½•æ€»æ•°                                         |
| `/focus/stats/records`     | GET      | è·å–ä¸“æ³¨è®°å½•åˆ—è¡¨ | åˆ†é¡µæŸ¥è¯¢ä¸“æ³¨è®°å½•           | user_focus_records                      | åˆ†é¡µæŸ¥è¯¢ç”¨æˆ·ä¸“æ³¨è®°å½•                                         |
| `/focus/stats/calendar`    | GET      | è·å–ä¸“æ³¨æ—¥å†æ•°æ® | æŸ¥è¯¢æœˆåº¦ä¸“æ³¨æ•°æ®           | user_focus_records, Redis               | 1. æŸ¥è¯¢æœˆåº¦ä¸“æ³¨æ—¶é•¿<br>2. è·å–ç­¾åˆ°æ—¥æœŸï¼ˆRedis Bitmapï¼‰<br>3. è¿”å›æ—¥å†æ•°æ® |

### 9. å²›å±¿æ¨¡å— (IslandController)

| æ¥å£è·¯å¾„      | HTTPæ–¹æ³• | åŠŸèƒ½æè¿°         | æ•°æ®åº“æ“ä½œ       | æ¶‰åŠè¡¨       | ä¸šåŠ¡é€»è¾‘                    |
| ------------- | -------- | ---------------- | ---------------- | ------------ | --------------------------- |
| `/islands/me` | GET      | è·å–æˆ‘çš„å²›å±¿æ”¶è— | æŸ¥è¯¢ç”¨æˆ·å²›å±¿è®°å½• | user_islands | æŸ¥è¯¢ç”¨æˆ·å·²è·å¾—çš„å²›å±¿URLåˆ—è¡¨ |

### 10. ç¿»è¯‘æ¨¡å— (TranslateController)

| æ¥å£è·¯å¾„     | HTTPæ–¹æ³• | åŠŸèƒ½æè¿° | æ•°æ®åº“æ“ä½œ   | æ¶‰åŠè¡¨ | ä¸šåŠ¡é€»è¾‘               |
| ------------ | -------- | -------- | ------------ | ------ | ---------------------- |
| `/translate` | POST     | æ–‡æœ¬ç¿»è¯‘ | æ— æ•°æ®åº“æ“ä½œ | æ—      | è°ƒç”¨AIæœåŠ¡è¿›è¡Œæ–‡æœ¬ç¿»è¯‘ |

### 11. ä¼ è¾“æ—¥å¿—æ¨¡å— (TransferController)

| æ¥å£è·¯å¾„                    | HTTPæ–¹æ³• | åŠŸèƒ½æè¿°         | æ•°æ®åº“æ“ä½œ         | æ¶‰åŠè¡¨                       | ä¸šåŠ¡é€»è¾‘                                        |
| --------------------------- | -------- | ---------------- | ------------------ | ---------------------------- | ----------------------------------------------- |
| `/transfer`                 | GET      | è·å–ä¼ è¾“å†å²è®°å½• | æŸ¥è¯¢ä¼ è¾“æ—¥å¿—       | transfer_log                 | åˆ†é¡µæŸ¥è¯¢ç”¨æˆ·ä¼ è¾“è®°å½•                            |
| `/transfer/summary`         | GET      | è·å–ä¼ è¾“ç»Ÿè®¡æ‘˜è¦ | ç»Ÿè®¡ä¼ è¾“æ•°æ®       | transfer_log                 | ç»Ÿè®¡ä¸Šä¼ ä¸‹è½½æ¬¡æ•°                                |
| `/transfer/{log_id}/status` | PUT      | æ›´æ–°ä¼ è¾“çŠ¶æ€     | æ›´æ–°ä¼ è¾“æ—¥å¿—çŠ¶æ€   | transfer_log                 | æ›´æ–°ä¼ è¾“ä»»åŠ¡çŠ¶æ€å’Œé”™è¯¯ä¿¡æ¯                      |
| `/transfer/{log_id}`        | DELETE   | åˆ é™¤ä¼ è¾“è®°å½•     | è½¯åˆ é™¤ä¼ è¾“è®°å½•     | transfer_log, files, folders | 1. è½¯åˆ é™¤ä¼ è¾“è®°å½•<br>2. å¯é€‰åˆ é™¤å…³è”æ–‡ä»¶/æ–‡ä»¶å¤¹ |
| `/transfer/completed/clean` | DELETE   | æ¸…ç©ºå·²å®Œæˆä¼ è¾“   | æ‰¹é‡åˆ é™¤ä¼ è¾“è®°å½•   | transfer_log, files, folders | æ‰¹é‡æ¸…ç†å·²å®Œæˆçš„ä¼ è¾“è®°å½•                        |
| `/transfer/{log_id}/cancel` | POST     | å–æ¶ˆä¸Šä¼ ä»»åŠ¡     | æ›´æ–°ä¼ è¾“çŠ¶æ€ä¸ºå–æ¶ˆ | transfer_log                 | å°†ä¸Šä¼ ä»»åŠ¡çŠ¶æ€è®¾ä¸ºå·²å–æ¶ˆ                        |

---

## æŠ€æœ¯æ¶æ„ç‰¹ç‚¹

### 1. æ•°æ®åº“è®¾è®¡ç‰¹æ€§

- **è½¯åˆ é™¤æœºåˆ¶**: ä½¿ç”¨delete_timeå­—æ®µå®ç°è½¯åˆ é™¤ï¼Œæ”¯æŒå›æ”¶ç«™åŠŸèƒ½
- **å¼•ç”¨è®¡æ•°**: storagesè¡¨ä½¿ç”¨reference_countå®ç°æ–‡ä»¶å»é‡å’Œåƒåœ¾å›æ”¶
- **å­˜å‚¨é…é¢ç®¡ç†**: usersè¡¨ç®¡ç†ç”¨æˆ·å­˜å‚¨ç©ºé—´é…é¢å’Œä½¿ç”¨é‡
- **ç‰ˆæœ¬æ§åˆ¶**: document_metadataè¡¨å®ç°Markdownæ–‡æ¡£çš„ä¹è§‚é”ç‰ˆæœ¬æ§åˆ¶
- **å±‚çº§ç»“æ„**: foldersè¡¨æ”¯æŒæ–‡ä»¶å¤¹å±‚çº§å…³ç³»
- **è‡ªå®šä¹‰æ’åº**: æ”¯æŒç”¨æˆ·è‡ªå®šä¹‰æ–‡ä»¶å’Œæ–‡ä»¶å¤¹æ’åº

### 2. æ€§èƒ½ä¼˜åŒ–

- **å¼‚æ­¥å¤„ç†**: ä½¿ç”¨CompletableFutureå®ç°å¼‚æ­¥æŸ¥è¯¢
- **æ‰¹é‡æ“ä½œ**: æ”¯æŒæ‰¹é‡æ–‡ä»¶å¤åˆ¶ã€åˆ é™¤ç­‰æ“ä½œ
- **Redisç¼“å­˜**: ä½¿ç”¨Redisè¿›è¡ŒéªŒè¯ç ç¼“å­˜ã€ç­¾åˆ°æ•°æ®å­˜å‚¨
- **è™šæ‹Ÿçº¿ç¨‹æ± **: ä½¿ç”¨è™šæ‹Ÿçº¿ç¨‹æé«˜å¹¶å‘æ€§èƒ½

### 3. å®‰å…¨ç‰¹æ€§

- **JWTè®¤è¯**: ä½¿ç”¨JWT tokenè¿›è¡Œç”¨æˆ·è®¤è¯
- **å¯†ç åŠ å¯†**: ä½¿ç”¨BCryptåŠ å¯†ç”¨æˆ·å¯†ç 
- **æƒé™éªŒè¯**: æ‰€æœ‰æ“ä½œéƒ½éªŒè¯ç”¨æˆ·æƒé™
- **é¢„ç­¾åURL**: ä½¿ç”¨MinIOé¢„ç­¾åURLå®‰å…¨è®¿é—®æ–‡ä»¶

### 4. ä¸šåŠ¡ç‰¹è‰²

- **ç§’ä¼ åŠŸèƒ½**: åŸºäºæ–‡ä»¶å“ˆå¸Œå€¼å®ç°ç§’ä¼ 
- **ä¸“æ³¨å¥–åŠ±**: ä¸“æ³¨åŠŸèƒ½ç»“åˆå²›å±¿å¥–åŠ±æœºåˆ¶
- **åˆ†äº«åŠŸèƒ½**: æ”¯æŒæ–‡ä»¶å’Œæ–‡ä»¶å¤¹çš„å…¬å¼€åˆ†äº«
- **ä¼ è¾“æ—¥å¿—**: è¯¦ç»†è®°å½•æ–‡ä»¶ä¸Šä¼ ä¸‹è½½è¡Œä¸º

æœ¬æ–‡æ¡£æ¶µç›–äº†LiteIsleé¡¹ç›®çš„æ‰€æœ‰å‰åç«¯æ¥å£æ“ä½œå¯¹åº”å…³ç³»ï¼Œä¸ºå¼€å‘å’Œç»´æŠ¤æä¾›äº†å®Œæ•´çš„å‚è€ƒèµ„æ–™ã€‚